(()=>{var e,t={3478:function(e,t,n){!function(e,t){"use strict";try{(function(){var r,i=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(e);function s(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t}const a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_;const r=[];for(let t=0;t<e.length;t+=3){var i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,u=o?e[t+2]:0;let c=(15&a)<<2|u>>6,h=63&u;o||(h=64,s||(c=64)),r.push(n[i>>2],n[(3&i)<<4|a>>4],n[c],n[h])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var i,s,a=e[n++];a<128?t[r++]=String.fromCharCode(a):191<a&&a<224?(i=e[n++],t[r++]=String.fromCharCode((31&a)<<6|63&i)):239<a&&a<365?(s=((7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))):(i=e[n++],s=e[n++],t[r++]=String.fromCharCode((15&a)<<12|(63&i)<<6|63&s))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let t=0;t<e.length;){var i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;var a=t<e.length?n[e.charAt(t)]:64;++t;var u=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==u)throw new o;r.push(i<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==u&&r.push(a<<6&192|u))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const u=function(e){return t=s(e),a.encodeByteArray(t,!0).replace(/\./g,"");var t},c=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"!=typeof process){var e="MISSING_ENV_VAR".__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0}})()||(()=>{if("undefined"!=typeof document){let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}var e=t&&function(e){try{return a.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(t[1]);return e&&JSON.parse(e)}})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}};function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function l(){return!function(){var e=null===(e=c())||void 0===e?void 0:e.forceEnvironment;if("node"===e)return 1;if("browser"!==e)try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class d extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,d.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,f.prototype.create)}}class f{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r=t[0]||{},i=`${this.service}/${e}`,s=(s=this.errors[e])?(n=r,s.replace(g,((e,t)=>{var r=n[t];return null!=r?String(r):`<${t}?>`}))):"Error";return s=`${this.serviceName}: ${s} (${i}).`,new d(i,s,r)}}const g=/\{\$([^}]+)}/g;function m(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const a of n){if(!r.includes(a))return!1;var i=e[a],s=t[a];if(p(i)&&p(s)){if(!m(i,s))return!1}else if(i!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function p(e){return null!==e&&"object"==typeof e}function y(e){return e&&e._delegate?e._delegate:e}class v{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}(ic=r=r||{})[ic.DEBUG=0]="DEBUG",ic[ic.VERBOSE=1]="VERBOSE",ic[ic.INFO=2]="INFO",ic[ic.WARN=3]="WARN",ic[ic.ERROR=4]="ERROR",ic[ic.SILENT=5]="SILENT";const w={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},_=r.INFO,b={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},I=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),i=b[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)}};var T,E,S="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{};(function(){var e,t,n;function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(){}function s(e,t,n){n=n||0;var r=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+((a=t+(s^n&(i^s))+r[0]+3614090360&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((s=(t=n+((a=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=s+((a=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+r[9]+3951481745&4294967295;e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function a(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}t=r,i.prototype=(n=function(){this.blockSize=-1}).prototype,t.D=n.prototype,t.prototype=new i,(t.prototype.constructor=t).C=function(e,t,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return n.prototype[t].apply(e,i)},r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},r.prototype.u=function(e,t){for(var n=(t=void 0===t?e.length:t)-this.blockSize,r=this.B,i=this.h,a=0;a<t;){if(0==i)for(;a<=n;)s(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(r[i++]=e.charCodeAt(a++),i==this.blockSize){s(this,r),i=0;break}}else for(;a<t;)if(r[i++]=e[a++],i==this.blockSize){s(this,r),i=0;break}}this.h=i,this.o+=t},r.prototype.v=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;t<4;++t)for(var r=0;r<32;r+=8)e[n++]=this.g[t]>>>r&255;return e};var o={};function u(e){return-128<=e&&e<128?(t=e,n=function(e){return new a([0|e],e<0?-1:0)},r=o,Object.prototype.hasOwnProperty.call(r,t)?r[t]:r[t]=n(t)):new a([0|e],e<0?-1:0);var t,n,r}function c(e){if(isNaN(e)||!isFinite(e))return h;if(e<0)return m(c(-e));for(var t=[],n=1,r=0;n<=e;r++)t[r]=e/n|0,n*=4294967296;return new a(t,0)}var h=u(0),l=u(1),d=u(16777216);function f(e){if(0==e.h){for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return;return 1}}function g(e){return-1==e.h}function m(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new a(n,~e.h).add(l)}function p(e,t){return e.add(m(t))}function y(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function w(e,t){if(f(t))throw Error("division by zero");if(f(e))return new v(h,h);if(g(e))return t=w(m(e),t),new v(m(t.g),m(t.h));if(g(t))return t=w(e,m(t)),new v(m(t.g),t.h);if(30<e.g.length){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var n=l,r=t;r.l(e)<=0;)n=_(n),r=_(r);var i=b(n,1),s=b(r,1);for(r=b(r,2),n=b(n,2);!f(r);){var a=s.add(r);a.l(e)<=0&&(i=i.add(n),s=a),r=b(r,1),n=b(n,1)}return t=p(e,i.j(t)),new v(i,t)}for(i=h;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=(r=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,r-48),a=(s=c(n)).j(t);g(a)||0<a.l(e);)a=(s=c(n-=r)).j(t);f(s)&&(s=l),i=i.add(s),e=p(e,a)}return new v(i,e)}function _(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new a(n,e.h)}function b(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new a(i,e.h)}(e=a.prototype).m=function(){if(g(this))return-m(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(f(this))return"0";if(g(this))return"-"+m(this).toString(e);for(var t=c(Math.pow(e,6)),n=this,r="";;){var i=w(n,t).g,s=((0<(n=p(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(f(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return g(e=p(this,e))?-1:f(e)?0:1},e.abs=function(){return g(this)?m(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.i(i))+(65535&e.i(i)),o=(s>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new a(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(f(this)||f(e))return h;if(g(this))return g(e)?m(this).j(m(e)):m(m(this).j(e));if(g(e))return m(this.j(m(e)));if(this.l(d)<0&&e.l(d)<0)return c(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.i(r)>>>16,o=65535&this.i(r),u=e.i(i)>>>16,l=65535&e.i(i);n[2*r+2*i]+=o*l,y(n,2*r+2*i),n[2*r+2*i+1]+=s*l,y(n,2*r+2*i+1),n[2*r+2*i+1]+=o*u,y(n,2*r+2*i+1),n[2*r+2*i+2]+=s*u,y(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new a(n,0)},e.A=function(e){return w(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new a(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new a(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new a(n,this.h^e.h)},r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,E=r,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.getBits=a.prototype.i,a.fromNumber=c,a.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return m(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=c(Math.pow(n,8)),i=h,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n);i=a<8?(a=c(Math.pow(n,a)),i.j(a).add(c(o))):(i=i.j(r)).add(c(o))}return i},T=a}).apply(void 0!==S?S:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var x,D,A,C,N,k,R,O,M,L,F="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof F&&F];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(r=r(s=i[e=e[e.length-1]]))!=s&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(0,e[i]),done:!1}}return{done:r=!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return t}))}}));var r=r||{},i=this||self;function s(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,n){return e.call.apply(e.bind,arguments)}function u(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function c(e,t,n){return(c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?o:u).apply(null,arguments)}function h(e){var t=Array.prototype.slice.call(arguments,1);return function(){var n=t.slice();return n.push.apply(n,arguments),e.apply(this,n)}}function l(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,(e.prototype.constructor=e).Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function d(e){var t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function f(e){for(let i=1;i<arguments.length;i++){var t=arguments[i];if(s(t)){var n=e.length||0,r=t.length||0;e.length=n+r;for(let i=0;i<r;i++)e[n+i]=t[i]}else e.push(t)}}function g(e){return/^[\s\xa0]*$/.test(e)}function m(){var e=i.navigator;return(e=e&&e.userAgent)?e:""}function p(e){return p[" "](e),e}p[" "]=function(){};var y=!(-1==m().indexOf("Gecko")||-1!=m().toLowerCase().indexOf("webkit")&&-1==m().indexOf("Edge")||-1!=m().indexOf("Trident")||-1!=m().indexOf("MSIE")||-1!=m().indexOf("Edge"));function v(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function w(e){const t={};for(const n in e)t[n]=e[n];return t}const _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function b(e){let t,n;for(let r=1;r<arguments.length;r++){for(t in n=arguments[r])e[t]=n[t];for(let r=0;r<_.length;r++)t=_[r],Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}}var I=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new T),(e=>e.reset()));class T{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let E,S=!1,M=new class{constructor(){this.h=this.g=null}add(e,t){const n=I.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},L=()=>{const e=i.Promise.resolve(void 0);E=()=>{e.then(V)}};var V=()=>{for(var e;e=function(){var e=M;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){i.setTimeout((()=>{throw e}),0)}(e)}var t=I;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}S=!1};function P(){this.s=this.s,this.C=this.C}function U(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}P.prototype.s=!1,P.prototype.ma=function(){this.s||(this.s=!0,this.N())},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},U.prototype.h=function(){this.defaultPrevented=!0};var B=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{var n=()=>{};i.addEventListener("test",n,t),i.removeEventListener("test",n,t)}catch(e){}return e}();function q(e,t){if(U.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(y){e:{try{p(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:j[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&q.aa.h.call(this)}}l(q,U);var j={2:"touch",3:"pen",4:"mouse"};q.prototype.h=function(){q.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var K="closure_listenable_"+(1e6*Math.random()|0),G=0;function z(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++G,this.da=this.fa=!1}function $(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Q(e){this.src=e,this.g={},this.h=0}function H(e,t){var n,r,i,s=t.type;s in e.g&&(n=e.g[s],(i=0<=(r=Array.prototype.indexOf.call(n,t,void 0)))&&Array.prototype.splice.call(n,r,1),i&&($(t),0==e.g[s].length&&(delete e.g[s],e.h--)))}function W(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}Q.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=W(e,t,r,i);return-1<a?(t=e[a],n||(t.fa=!1)):((t=new z(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var J="closure_lm_"+(1e6*Math.random()|0),Y={};function X(e,t,n,r,i){if(r&&r.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=se(r),t&&t[K]?t.L(n,r,a(i)?!!i.capture:!!i,s):Z(t,n,r,!0,i,s)}(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)X(e,t[s],n,r,i);return null}return n=se(n),e&&e[K]?e.K(t,n,a(r)?!!r.capture:!!r,i):Z(e,t,n,!1,r,i)}function Z(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=a(i)?!!i.capture:!!i,u=re(e);if(u||(e[J]=u=new Q(e)),(n=u.add(t,n,r,o,s)).proxy)return n;if(r=function(){const e=ne;return function t(n){return e.call(t.src,t.listener,n)}}(),(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(i=B?i:o)&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(te(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ee(e){var t,n,r;"number"!=typeof e&&e&&!e.da&&((t=e.src)&&t[K]?H(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(te(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=re(t))?(H(n,e),0==n.h&&(n.src=null,t[J]=null)):$(e)))}function te(e){return e in Y?Y[e]:Y[e]="on"+e}function ne(e,t){var n,r;return!!e.da||(t=new q(t,this),n=e.listener,r=e.ha||e.src,e.fa&&ee(e),n.call(r,t))}function re(e){return(e=e[J])instanceof Q?e:null}var ie="__closure_events_fn_"+(1e9*Math.random()>>>0);function se(e){return"function"==typeof e?e:(e[ie]||(e[ie]=function(t){return e.handleEvent(t)}),e[ie])}function ae(){P.call(this),this.i=new Q(this),(this.M=this).F=null}function oe(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t?t=new U(t,e):t instanceof U?t.target=t.target||e:(a=t,b(t=new U(r,e),a)),a=!0,n)for(var i=n.length-1;0<=i;i--)var s=t.g=n[i],a=ue(s,r,!0,t)&&a;if(a=ue(s=t.g=e,r,!0,t)&&a,a=ue(s,r,!1,t)&&a,n)for(i=0;i<n.length;i++)a=ue(s=t.g=n[i],r,!1,t)&&a}function ue(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a,o,u=t[s];u&&!u.da&&u.capture==n&&(a=u.listener,o=u.ha||u.src,u.fa&&H(e.i,u),i=!1!==a.call(o,r)&&i)}return i&&!r.defaultPrevented}function ce(e,t,n){if("function"==typeof e)n&&(e=c(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}l(ae,P),ae.prototype[K]=!0,ae.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);else i=a(i)?!!i.capture:!!i,r=se(r),t&&t[K]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=W(o=t.g[n],r,i,s))&&($(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete t.g[n],t.h--))):(t=t&&re(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?W(n,r,i,s):t)?n[t]:null)&&ee(r))}(this,e,t,n,r)},ae.prototype.N=function(){if(ae.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)$(n[r]);delete t.g[e],t.h--}}this.F=null},ae.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ae.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class he extends P{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=ce((()=>{t.g=null,t.i&&(t.i=!1,e(t))}),t.l);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function le(e){P.call(this),this.h=e,this.g={}}l(le,P);var de=[];function fe(e){v(e.g,(function(e,t){this.g.hasOwnProperty(t)&&ee(e)}),e),e.g={}}le.prototype.N=function(){le.aa.N.call(this),fe(this)},le.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ge=i.JSON.stringify,me=i.JSON.parse;function pe(){}function ye(e){return e.h||(e.h=e.i())}function ve(){}pe.prototype.h=null;var we={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function _e(){U.call(this,"d")}function be(){U.call(this,"c")}l(_e,U),l(be,U);var Ie={},Te=null;function Ee(){return Te=Te||new ae}function Se(e){U.call(this,Ie.La,e)}function xe(){var e=Ee();oe(e,new Se(e))}function De(e,t){U.call(this,Ie.STAT_EVENT,e),this.stat=t}function Ae(e){var t=Ee();oe(t,new De(t,e))}function Ce(e,t){U.call(this,Ie.Ma,e),this.size=t}function Ne(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){e()}),t)}function ke(){this.g=!0}function Re(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return ge(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Ie.La="serverreachability",l(Se,U),Ie.STAT_EVENT="statevent",l(De,U),Ie.Ma="timingevent",l(Ce,U),ke.prototype.xa=function(){this.g=!1},ke.prototype.info=function(){};var Oe={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Me={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Le(){}function Fe(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new le(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ve}function Ve(){this.i=null,this.g="",this.h=!1}l(Le,pe),Le.prototype.g=function(){return new XMLHttpRequest},Le.prototype.i=function(){return{}};var Pe=new Le,Ue={},Be={};function qe(e,t,n){e.L=1,e.v=lt(at(t)),e.m=n,e.P=!0,je(e,null)}function je(e,t){e.F=Date.now(),Ge(e),e.A=at(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),St(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Ve,e.g=dn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new he(c(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(de[0]=i.toString()),i=de);for(var s,a,o,u,h,l,d=0;d<i.length;d++){var f=X(n,i[d],r||t.handleEvent,!1,t.h||t);if(!f)break;t.g[f.key]=f}t=e.H?w(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),xe(),s=e.i,a=e.u,o=e.A,u=e.l,h=e.R,l=e.m,s.info((function(){if(s.g)if(l)for(var e="",t=l.split("&"),n=0;n<t.length;n++){var r,i,c=t[n].split("=");1<c.length&&(r=c[0],c=c[1],e=2<=(i=r.split("_")).length&&"type"==i[1]?e+(r+"=")+c+"&":e+(r+"=redacted&"))}else e=null;else e=l;return"XMLHTTP REQ ("+u+") [attempt "+h+"]: "+a+"\n"+o+"\n"+e}))}function Ke(e){return e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function Ge(e){e.S=Date.now()+e.I,ze(e,e.I)}function ze(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ne(c(e.ba,e),t)}function $e(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function Qe(e){0==e.j.G||e.J||on(e.j,e)}function He(e){$e(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,fe(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function We(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||Ze(n.h,e)))if(!e.K&&Ze(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;an(n),Wt(n)}nn(n),Ae(18)}}else n.za=i[1],0<n.za-n.T&&i[2]<37500&&n.F&&0==n.v&&!n.C&&(n.C=Ne(c(n.Za,n),6e3));if(Xe(n.h)<=1&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else cn(n,11)}else if(!e.K&&n.g!=e||an(n),!g(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){var s=i[t];if(n.T=s[0],s=s[1],2==n.G)if("c"==s[0]){n.K=s[1],n.ia=s[2];var a=s[3];null!=a&&(n.la=a,n.j.info("VER="+n.la));var o=s[4];null!=o&&(n.Aa=o,n.j.info("SVER="+n.Aa));var u,h,l=s[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const t=e.g;if(t){const e=t.g?t.g.getResponseHeader("X-Client-Wire-Protocol"):null;e&&((u=r.h).g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(u.j=u.l,u.g=new Set,u.h&&(et(u,u.h),u.h=null))),!r.D||(h=t.g?t.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.ya=h,ht(r.I,r.D,h))}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var d,f,m=e;(r=n).qa=ln(r,r.J?r.ia:null,r.W),m.K?(tt(r.h,m),d=m,(f=r.L)&&(d.I=f),d.B&&($e(d),Ge(d)),r.g=m):tn(r),0<n.i.length&&Yt(n)}else"stop"!=s[0]&&"close"!=s[0]||cn(n,7);else 3==n.G&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?cn(n,7):Ht(n):"noop"!=s[0]&&n.l&&n.l.ta(s),n.v=0)}xe()}catch(e){}}Fe.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Gt(e)?t.j():this.Y(e)},Fe.prototype.Y=function(e){try{if(e==this.g)e:{var t=Gt(this.g),n=this.g.Ba();if(this.g.Z(),!(t<3)&&(3!=t||this.g&&(this.h.h||this.g.oa()||zt(this.g)))){this.J||4!=t||7==n||xe(),$e(this);var r=this.g.Z();this.X=r;t:if(Ke(this)){var s=zt(this.g);e="";var a=s.length,o=4==Gt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){He(this),Qe(this);var u="";break t}this.h.i=new i.TextDecoder}for(n=0;n<a;n++)this.h.h=!0,e+=this.h.i.decode(s[n],{stream:!(o&&n==a-1)});s.length=0,this.h.g+=e,this.C=0,u=this.h.g}else u=this.g.oa();if(this.o=200==r,v=this.i,w=this.u,_=this.A,b=this.l,I=this.R,T=t,E=r,v.info((function(){return"XMLHTTP RESP ("+b+") [ attempt "+I+"]: "+w+"\n"+_+"\n"+T+" "+E})),this.o){if(this.T&&!this.K){t:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(c)){var l=c;break t}}l=null}if(!(r=l)){this.o=!1,this.s=3,Ae(12),He(this),Qe(this);break e}Re(this.i,this.l,r,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,We(this,r)}if(this.P){var d,f;for(r=!0;!this.J&&this.C<u.length;){if(m=u,y=p=void 0,p=this.C,(d=-1==(y=m.indexOf("\n",p))?Be:(p=Number(m.substring(p,y)),isNaN(p)?Ue:(y+=1)+p>m.length?Be:(m=m.slice(y,y+p),this.C=y+p,m)))==Be){4==t&&(this.s=4,Ae(14),r=!1),Re(this.i,this.l,null,"[Incomplete Response]");break}if(d==Ue){this.s=4,Ae(15),Re(this.i,this.l,u,"[Invalid Chunk]"),r=!1;break}Re(this.i,this.l,d,null),We(this,d)}Ke(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=t||0!=u.length||this.h.h||(this.s=1,Ae(16),r=!1),this.o=this.o&&r,r?0<u.length&&!this.W&&(this.W=!0,(f=this.j).g==this&&f.ba&&!f.M&&(f.j.info("Great, no buffering proxy detected. Bytes received: "+u.length),rn(f),f.M=!0,Ae(11))):(Re(this.i,this.l,u,"[Invalid Chunked Response]"),He(this),Qe(this))}else Re(this.i,this.l,u,null),We(this,u);4==t&&He(this),this.o&&!this.J&&(4==t?on(this.j,this):(this.o=!1,Ge(this)))}else(function(e){const t={};e=(e.g&&2<=Gt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++)if(!g(e[i])){var n=function(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[i]),r=n[0];if("string"==typeof(n=n[1])){n=n.trim();const e=t[r]||[];t[r]=e,e.push(n)}}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==r&&0<u.indexOf("Unknown SID")?(this.s=3,Ae(12)):(this.s=0,Ae(13)),He(this),Qe(this)}}}catch(e){}var m,p,y,v,w,_,b,I,T,E},Fe.prototype.cancel=function(){this.J=!0,He(this)},Fe.prototype.ba=function(){this.B=null;var e,t,n=Date.now();0<=n-this.S?(e=this.i,t=this.A,e.info((function(){return"TIMEOUT: "+t})),2!=this.L&&(xe(),Ae(17)),He(this),this.s=2,Qe(this)):ze(this,this.S-n)};function Je(e){this.l=e||10,e=i.PerformanceNavigationTiming?0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ye(e){return e.h||e.g&&e.g.size>=e.j}function Xe(e){return e.h?1:e.g?e.g.size:0}function Ze(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function et(e,t){e.g?e.g.add(t):e.h=t}function tt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function nt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null==e.g||0===e.g.size)return d(e.i);{let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}}function rt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(s(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(s(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(s(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,a=0;a<i;a++)t.call(void 0,r[a],n&&n[a],e)}Je.prototype.cancel=function(){if(this.i=nt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var it=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function st(e){var t,n;this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof st?(this.h=e.h,ot(this,e.j),this.o=e.o,this.g=e.g,ut(this,e.s),this.l=e.l,t=e.i,(n=new bt).i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),ct(this,n),this.m=e.m):e&&(t=String(e).match(it))?(this.h=!1,ot(this,t[1]||"",!0),this.o=dt(t[2]||""),this.g=dt(t[3]||"",!0),ut(this,t[4]),this.l=dt(t[5]||"",!0),ct(this,t[6]||"",!0),this.m=dt(t[7]||"")):(this.h=!1,this.i=new bt(null,this.h))}function at(e){return new st(e)}function ot(e,t,n){e.j=n?dt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ut(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.s=t}else e.s=null}function ct(e,t,n){var r,i;t instanceof bt?(e.i=t,r=e.i,(i=e.h)&&!r.j&&(It(r),r.i=null,r.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Tt(this,t),St(this,n,e))}),r)),r.j=i):(n||(t=ft(t,wt)),e.i=new bt(t,e.h))}function ht(e,t,n){e.i.set(t,n)}function lt(e){return ht(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function dt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function ft(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,gt),e=n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function gt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}st.prototype.toString=function(){var e=[],t=this.j;t&&e.push(ft(t,pt,!0),":");var n=this.g;return!n&&"file"!=t||(e.push("//"),(t=this.o)&&e.push(ft(t,pt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(ft(n,"/"==n.charAt(0)?vt:yt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",ft(n,_t)),e.join("")};var mt,pt=/[#\/\?@]/g,yt=/[#\?:]/g,vt=/[#\?]/g,wt=/[#\?@]/g,_t=/#/g;function bt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function It(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r,i=e[n].indexOf("="),s=null;0<=i?(r=e[n].substring(0,i),s=e[n].substring(i+1)):r=e[n],t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Tt(e,t){It(e),t=xt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Et(e,t){return It(e),t=xt(e,t),e.g.has(t)}function St(e,t,n){Tt(e,t),0<n.length&&(e.i=null,e.g.set(xt(e,t),d(n)),e.h+=n.length)}function xt(e,t){return t=String(t),e.j?t.toLowerCase():t}function Dt(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function At(){this.g=new class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}}}function Ct(e){this.l=e.Ub||null,this.j=e.eb||!1}function Nt(e,t){ae.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function kt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Rt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Ot(e)}function Ot(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Mt(e){let t="";return v(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Lt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Mt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):ht(e,t,n))}function Ft(e){ae.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=bt.prototype).add=function(e,t){It(this),this.i=null,e=xt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){It(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},e.na=function(){It(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){var r=e[i];for(let e=0;e<r.length;e++)n.push(t[i])}return n},e.V=function(e){It(this);let t=[];if("string"==typeof e)Et(this,e)&&(t=t.concat(this.g.get(xt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return It(this),this.i=null,Et(this,e=xt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r)),s=this.V(r);for(r=0;r<s.length;r++){var a=i;""!==s[r]&&(a+="="+encodeURIComponent(String(s[r]))),e.push(a)}}return this.i=e.join("&")},l(Ct,pe),Ct.prototype.g=function(){return new Nt(this.l,this.j)},Ct.prototype.i=(mt={},function(){return mt}),l(Nt,ae),(e=Nt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Ot(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Rt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ot(this)),this.g&&(this.readyState=3,Ot(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;kt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){var t;this.g&&(this.o&&e.value?this.response.push(e.value):this.o||(t=e.value||new Uint8Array(0),(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?Rt:Ot)(this),3==this.readyState&&kt(this))},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Rt(this))},e.Qa=function(e){this.g&&(this.response=e,Rt(this))},e.ga=function(){this.g&&Rt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Nt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),l(Ft,ae);var Vt=/^https?$/i,Pt=["POST","PUT"];function Ut(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Bt(e),jt(e)}function Bt(e){e.A||(e.A=!0,oe(e,"complete"),oe(e,"error"))}function qt(e){if(e.h&&void 0!==r&&(!e.v[1]||4!=Gt(e)||2!=e.Z()))if(e.u&&4==Gt(e))ce(e.Ea,0,e);else if(oe(e,"readystatechange"),4==Gt(e)){e.h=!1;try{var t,n,s,a=e.Z();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break e;default:o=!1}if((t=o)||((n=0===a)&&(!(s=String(e.D).match(it)[1]||null)&&i.self&&i.self.location&&(s=i.self.location.protocol.slice(0,-1)),n=!Vt.test(s?s.toLowerCase():"")),t=n),t)oe(e,"complete"),oe(e,"success");else{e.m=6;try{var u=2<Gt(e)?e.g.statusText:""}catch(e){u=""}e.l=u+" ["+e.Z()+"]",Bt(e)}}finally{jt(e)}}}function jt(e,t){if(e.g){Kt(e);const n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||oe(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Kt(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function Gt(e){return e.g?e.g.readyState:0}function zt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function $t(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Qt(e){this.Aa=0,this.i=[],this.j=new ke,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=$t("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=$t("baseRetryDelayMs",5e3,e),this.cb=$t("retryDelaySeedMs",1e4,e),this.Wa=$t("forwardChannelMaxRetries",2,e),this.wa=$t("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new Je(e&&e.concurrentRequestLimit),this.Da=new At,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function Ht(e){if(Jt(e),3==e.G){var t=e.U++,n=at(e.I);if(ht(n,"SID",e.K),ht(n,"RID",t),ht(n,"TYPE","terminate"),Zt(e,n),(t=new Fe(e,e.j,t)).L=2,t.v=lt(at(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=dn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Ge(t)}hn(e)}function Wt(e){e.g&&(rn(e),e.g.cancel(),e.g=null)}function Jt(e){Wt(e),e.u&&(i.clearTimeout(e.u),e.u=null),an(e),e.h.cancel(),e.s&&("number"==typeof e.s&&i.clearTimeout(e.s),e.s=null)}function Yt(e){var t;Ye(e.h)||e.s||(e.s=!0,t=e.Ga,E||L(),S||(E(),S=!0),M.add(t,e),e.B=0)}function Xt(e,t){var n=t?t.l:e.U++,r=at(e.I);ht(r,"SID",e.K),ht(r,"RID",n),ht(r,"AID",e.T),Zt(e,r),e.m&&e.o&&Lt(r,e.m,e.o),n=new Fe(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=en(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),et(e.h,n),qe(n,r,t)}function Zt(e,t){e.H&&v(e.H,(function(e,n){ht(t,n,e)})),e.l&&rt({},(function(e,n){ht(t,n,e)}))}function en(e,t,n){n=Math.min(e.i.length,n);var r=e.l?c(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const u=["count="+n];-1==t?0<n?(t=i[0].g,u.push("ofs="+t)):t=0:u.push("ofs="+t);let c=!0;for(let h=0;h<n;h++){var s=i[h].g,o=i[h].map;if((s-=t)<0)t=Math.max(0,i[h].g-100),c=!1;else try{!function(e,t,n){const r=n||"";try{rt(e,(function(e,n){let i=e;a(e)&&(i=ge(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}(o,u,"req"+s+"_")}catch(e){r&&r(o)}}if(c){r=u.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function tn(e){var t;e.g||e.u||(e.Y=1,t=e.Fa,E||L(),S||(E(),S=!0),M.add(t,e),e.v=0)}function nn(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Ne(c(e.Fa,e),un(e,e.v)),e.v++,1)}function rn(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function sn(e){e.g=new Fe(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=at(e.qa);ht(t,"RID","rpc"),ht(t,"SID",e.K),ht(t,"AID",e.T),ht(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ht(t,"TO",e.ja),ht(t,"TYPE","xmlhttp"),Zt(e,t),e.m&&e.o&&Lt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=lt(at(t)),n.m=null,n.P=!0,je(n,e)}function an(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function on(e,t){var n,r,i,s=null;if(e.g==t){an(e),rn(e),e.g=null;var a=2}else{if(!Ze(e.h,t))return;s=t.D,tt(e.h,t),a=1}if(0!=e.G)if(t.o)1==a?(s=t.m?t.m.length:0,t=Date.now()-t.F,n=e.B,oe(a=Ee(),new Ce(a,s)),Yt(e)):tn(e);else if(3==(n=t.s)||0==n&&0<t.X||(1!=a||(i=t,Xe((r=e).h)>=r.h.j-(r.s?1:0)||(r.s?(r.i=i.D.concat(r.i),0):1==r.G||2==r.G||r.B>=(r.Va?0:r.Wa)||(r.s=Ne(c(r.Ga,r,i),un(r,r.B)),r.B++,0))))&&(2!=a||!nn(e)))switch(s&&0<s.length&&(t=e.h,t.i=t.i.concat(s)),n){case 1:cn(e,5);break;case 4:cn(e,10);break;case 3:cn(e,6);break;default:cn(e,2)}}function un(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function cn(e,t){var n,r,s;e.j.info("Error code "+t),2==t?(n=c(e.fb,e),r=!(s=e.Xa),s=new st(s||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||ot(s,"https"),lt(s),(r?function(e,t){var n=new ke;if(i.Image){const r=new Image;r.onload=h(Dt,n,"TestLoadImage: loaded",!0,t,r),r.onerror=h(Dt,n,"TestLoadImage: error",!1,t,r),r.onabort=h(Dt,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=h(Dt,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}:function(e,t){new ke;const n=new AbortController,r=setTimeout((()=>{n.abort(),Dt(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(r),e.ok?Dt(0,0,!0,t):Dt(0,0,!1,t)})).catch((()=>{clearTimeout(r),Dt(0,0,!1,t)}))})(s.toString(),n)):Ae(2),e.G=0,e.l&&e.l.sa(t),hn(e),Jt(e)}function hn(e){var t;e.G=0,e.ka=[],e.l&&(0==(t=nt(e.h)).length&&0==e.i.length||(f(e.ka,t),f(e.ka,e.i),e.h.i.length=0,d(e.i),e.i.length=0),e.l.ra())}function ln(e,t,n){var r,s,a=n instanceof st?at(n):new st(n);return""!=a.g?(t&&(a.g=t+"."+a.g),ut(a,a.s)):(a=(r=i.location).protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port,s=new st(null),a&&ot(s,a),t&&(s.g=t),r&&ut(s,r),n&&(s.l=n),a=s),n=e.D,t=e.ya,n&&t&&ht(a,n,t),ht(a,"VER",e.la),Zt(e,a),a}function dn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Ft(new Ct({eb:n})):new Ft(e.pa)).Ha(e.J),t}function fn(){}function gn(){}function mn(e,t){ae.call(this),this.g=new Qt(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!g(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!g(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new vn(this)}function pn(e){_e.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function yn(){be.call(this),this.status=1}function vn(e){this.g=e}(e=Ft.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=(this.o||Pe).g(),this.v=this.o?ye(this.o):ye(Pe),this.g.onreadystatechange=c(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void Ut(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}for(var[a,o]of(r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),s=i.FormData&&e instanceof i.FormData,0<=Array.prototype.indexOf.call(Pt,t,void 0)&&!r&&!s&&n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n))this.g.setRequestHeader(a,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Kt(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){Ut(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,oe(this,"complete"),oe(this,"abort"),jt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),jt(this,!0)),Ft.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?qt(this):this.bb())},e.bb=function(){qt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Gt(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),me(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Qt.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Ae(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=ln(this,null,this.W),Yt(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Fe(this,this.j,e);let s=this.o;if(this.S&&(s?(s=w(s),b(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=en(this,i,t),ht(n=at(this.I),"RID",e),ht(n,"CVER",22),this.D&&ht(n,"X-HTTP-Session-Id",this.D),Zt(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Mt(s)))+"&"+t:this.m&&Lt(n,this.m,s)),et(this.h,i),this.Ua&&ht(n,"TYPE","init"),this.P?(ht(n,"$req",t),ht(n,"SID","null"),i.T=!0,qe(i,n,null)):qe(i,n,t),this.G=2}}else 3==this.G&&(e?Xt(this,e):0==this.i.length||Ye(this.h)||Xt(this))},e.Fa=function(){var e;this.u=null,sn(this),this.ba&&!(this.M||null==this.g||this.R<=0)&&(e=2*this.R,this.j.info("BP detection timer enabled: "+e),this.A=Ne(c(this.ab,this),e))},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ae(10),Wt(this),sn(this))},e.Za=function(){null!=this.C&&(this.C=null,Wt(this),nn(this),Ae(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Ae(2)):(this.j.info("Failed to ping google.com"),Ae(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=fn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},gn.prototype.g=function(e,t){return new mn(e,t)},l(mn,ae),mn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},mn.prototype.close=function(){Ht(this.g)},mn.prototype.o=function(e){var t,n=this.g;"string"==typeof e?((t={}).__data__=e,e=t):this.u&&((t={}).__data__=ge(e),e=t),n.i.push(new class{constructor(e,t){this.g=e,this.map=t}}(n.Ya++,e)),3==n.G&&Yt(n)},mn.prototype.N=function(){this.g.l=null,delete this.j,Ht(this.g),delete this.g,mn.aa.N.call(this)},l(pn,_e),l(yn,be),l(vn,fn),vn.prototype.ua=function(){oe(this.g,"a")},vn.prototype.ta=function(e){oe(this.g,new pn(e))},vn.prototype.sa=function(e){oe(this.g,new yn)},vn.prototype.ra=function(){oe(this.g,"b")},gn.prototype.createWebChannel=gn.prototype.g,mn.prototype.send=mn.prototype.o,mn.prototype.open=mn.prototype.m,O=function(){return new gn},R=Ee,k=Ie,N={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Oe.NO_ERROR=0,Oe.TIMEOUT=8,Oe.HTTP_ERROR=6,C=Oe,Me.COMPLETE="complete",A=Me,(ve.EventType=we).OPEN="a",we.CLOSE="b",we.ERROR="c",we.MESSAGE="d",ae.prototype.listen=ae.prototype.K,D=ve,Ft.prototype.listenOnce=Ft.prototype.L,Ft.prototype.getLastError=Ft.prototype.Ka,Ft.prototype.getLastErrorCode=Ft.prototype.Ba,Ft.prototype.getStatus=Ft.prototype.Z,Ft.prototype.getResponseJson=Ft.prototype.Oa,Ft.prototype.getResponseText=Ft.prototype.oa,Ft.prototype.send=Ft.prototype.ea,Ft.prototype.setWithCredentials=Ft.prototype.Ha,x=Ft}).apply(void 0!==F?F:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const V="@firebase/firestore";class P{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}P.UNAUTHENTICATED=new P(null),P.GOOGLE_CREDENTIALS=new P("google-credentials-uid"),P.FIRST_PARTY=new P("first-party-uid"),P.MOCK_USER=new P("mock-user");let U="10.14.1";const B=new class{constructor(e){this.name=e,this._logLevel=_,this._logHandler=I,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in r))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?w[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...e),this._logHandler(this,r.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...e),this._logHandler(this,r.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,r.INFO,...e),this._logHandler(this,r.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,r.WARN,...e),this._logHandler(this,r.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...e),this._logHandler(this,r.ERROR,...e)}}("@firebase/firestore");function q(){return B.logLevel}function j(e,...t){var n;B.logLevel<=r.DEBUG&&(n=t.map(z),B.debug(`Firestore (${U}): ${e}`,...n))}function K(e,...t){var n;B.logLevel<=r.ERROR&&(n=t.map(z),B.error(`Firestore (${U}): ${e}`,...n))}function G(e,...t){var n;B.logLevel<=r.WARN&&(n=t.map(z),B.warn(`Firestore (${U}): ${e}`,...n))}function z(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function $(e="Unexpected state"){var t=`FIRESTORE (${U}) INTERNAL ASSERTION FAILED: `+e;throw K(t),new Error(t)}function Q(e){e||$()}const H={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class W extends d{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class J{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Y{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class X{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(P.UNAUTHENTICATED)))}shutdown(){}}class Z{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class ee{constructor(e){this.t=e,this.currentUser=P.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Q(void 0===this.o);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new J;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new J,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},a=e=>{j("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit((e=>a(e))),setTimeout((()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?a(e):(j("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new J))}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(j("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Q("string"==typeof t.accessToken),new Y(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){var e=this.auth&&this.auth.getUid();return Q(null===e||"string"==typeof e),new P(e)}}class te{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=P.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);var e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class ne{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new te(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(P.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class re{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class ie{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){Q(void 0===this.o);const n=e=>{null!=e.error&&j("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);var n=e.token!==this.R;return this.R=e.token,j("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{j("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{var e;this.appCheck||((e=this.A.getImmediate({optional:!0}))?r(e):j("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))}),0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Q("string"==typeof e.token),this.R=e.token,new re(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class se{static newId(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){var r=function(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}();for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function ae(e,t){return e<t?-1:t<e?1:0}function oe(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function ue(e){return e+"\0"}class ce{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new W(H.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new W(H.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new W(H.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new W(H.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ce.fromMillis(Date.now())}static fromDate(e){return ce.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new ce(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ae(this.nanoseconds,e.nanoseconds):ae(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class he{constructor(e){this.timestamp=e}static fromTimestamp(e){return new he(e)}static min(){return new he(new ce(0,0))}static max(){return new he(new ce(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class le{constructor(e,t,n){void 0===t?t=0:t>e.length&&$(),void 0===n?n=e.length-t:n>e.length-t&&$(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===le.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof le?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class de extends le{construct(e,t,n){return new de(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new W(H.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>0<e.length)))}return new de(t)}static emptyPath(){return new de([])}}const fe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ge extends le{construct(e,t,n){return new ge(e,t,n)}static isValidIdentifier(e){return fe.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ge.isValidIdentifier(e)?e:"`"+e+"`"))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ge(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var i=()=>{if(0===n.length)throw new W(H.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new W(H.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new W(H.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new W(H.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ge(t)}static emptyPath(){return new ge([])}}class me{constructor(e){this.path=e}static fromPath(e){return new me(de.fromString(e))}static fromName(e){return new me(de.fromString(e).popFirst(5))}static empty(){return new me(de.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===de.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return de.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new me(new de(e.slice()))}}class pe{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function ye(e){return e.fields.find((e=>2===e.kind))}function ve(e){return e.fields.filter((e=>2!==e.kind))}pe.UNKNOWN_ID=-1;class we{constructor(e,t){this.fieldPath=e,this.kind=t}}class _e{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new _e(0,Te.min())}}function be(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1;return r=he.fromTimestamp(1e9===r?new ce(n+1,0):new ce(n,r)),new Te(r,me.empty(),t)}function Ie(e){return new Te(e.readTime,e.key,-1)}class Te{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Te(he.min(),me.empty(),-1)}static max(){return new Te(he.max(),me.empty(),-1)}}function Ee(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=me.comparator(e.documentKey,t.documentKey),0!==n?n:ae(e.largestBatchId,t.largestBatchId))}const Se="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class xe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function De(e){if(e.code!==H.FAILED_PRECONDITION||e.message!==Se)throw e;j("LocalStore","Unexpectedly lost primary lease")}class Ae{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ae(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{var t=e();return t instanceof Ae?t:Ae.resolve(t)}catch(e){return Ae.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Ae.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Ae.reject(t)}static resolve(e){return new Ae(((t,n)=>{t(e)}))}static reject(e){return new Ae(((t,n)=>{n(e)}))}static waitFor(e){return new Ae(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=Ae.resolve(!1);for(const n of e)t=t.next((e=>e?Ae.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new Ae(((n,r)=>{const i=e.length,s=new Array(i);let a=0;for(let o=0;o<i;o++){const u=o;t(e[u]).next((e=>{s[u]=e,++a,a===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new Ae(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}class Ce{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new J,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Oe(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{var n=Pe(t.target.error);this.V.reject(new Oe(e,n))}}static open(e,t,n,r){try{return new Ce(t,e.transaction(r,n))}catch(e){throw new Oe(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(j("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){var t=this.transaction.objectStore(e);return new Le(t)}}class Ne{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===Ne.S(h())&&K("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return j("SimpleDb","Removing database:",e),Fe(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!function(){try{return"object"==typeof indexedDB}catch(e){return}}())return!1;if(Ne.v())return!0;const e=h(),t=Ne.S(e),n=0<t&&t<10,r=ke(e),i=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||i)}static v(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.C)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}async M(e){return this.db||(j("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{var n=e.target.result;t(n)},r.onblocked=()=>{n(new Oe(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{var r=t.target.error;"VersionError"===r.name?n(new W(H.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new W(H.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Oe(e,r))},r.onupgradeneeded=e=>{j("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.p.O(t,r.transaction,e.oldVersion,this.version).next((()=>{j("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){var i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.M(e);const t=Ce.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.g(),e))).catch((e=>(t.abort(e),Ae.reject(e)))).toPromise();return s.catch((()=>{})),await t.m,s}catch(e){const t=e,n="FirebaseError"!==t.name&&s<3;if(j("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ke(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class Re{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return Fe(this.B.delete())}}class Oe extends W{constructor(e,t){super(H.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Me(e){return"IndexedDbTransactionError"===e.name}class Le{constructor(e){this.store=e}put(e,t){let n;return n=void 0!==t?(j("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(j("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)),Fe(n)}add(e){return j("SimpleDb","ADD",this.store.name,e,e),Fe(this.store.add(e))}get(e){return Fe(this.store.get(e)).next((t=>(j("SimpleDb","GET",this.store.name,e,t=void 0===t?null:t),t)))}delete(e){return j("SimpleDb","DELETE",this.store.name,e),Fe(this.store.delete(e))}count(){return j("SimpleDb","COUNT",this.store.name),Fe(this.store.count())}U(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new Ae(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.W(e,((e,n)=>{t.push(n)})).next((()=>t))}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Ae(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}j(e,t){j("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;var r=this.cursor(n);return this.W(r,((e,t,n)=>n.delete()))}J(e,t){let n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.W(r,t)}Y(e){const t=this.cursor({});return new Ae(((n,r)=>{t.onerror=e=>{var t=Pe(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}W(e,t){const n=[];return new Ae(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(i){const e=new Re(i),s=t(i.primaryKey,i.value,e);if(s instanceof Ae){const t=s.catch((t=>(e.done(),Ae.reject(t))));n.push(t)}e.isDone?r():null===e.K?i.continue():i.continue(e.K)}else r()}})).next((()=>Ae.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Fe(e){return new Ae(((t,n)=>{e.onsuccess=e=>{var n=e.target.result;t(n)},e.onerror=e=>{var t=Pe(e.target.error);n(t)}}))}let Ve=!1;function Pe(e){const t=Ne.S(h());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new W("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ve||(Ve=!0,setTimeout((()=>{throw e}),0)),e}}return e}class Ue{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){j("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{j("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(e){Me(e)?j("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):await De(e)}await this.X(6e4)}))}}class Be{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.te(t,e)))}te(e,t){const n=new Set;let r=t,i=!0;return Ae.doWhile((()=>!0===i&&0<r),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>null===t||n.has(t)?void(i=!1):(j("IndexBackfiller",`Processing collection: ${t}`),this.ne(e,t,r).next((e=>{r-=e,n.add(t)}))))))).next((()=>t-r))}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.re(r,n))).next((n=>(j("IndexBackfiller",`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}re(e,t){let n=e;return t.changes.forEach(((e,t)=>{var r=Ie(t);0<Ee(r,n)&&(n=r)})),new Te(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class qe{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.se&&this.se(e),e}}function je(e){return null==e}function Ke(e){return 0===e&&1/e==-1/0}function Ge(e){return"number"==typeof e&&Number.isInteger(e)&&!Ke(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function ze(e){let t="";for(let n=0;n<e.length;n++)0<t.length&&(t=$e(t)),t=function(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(e.get(n),t);return $e(t)}function $e(e){return e+""}function Qe(e){const t=e.length;if(Q(2<=t),2===t)return Q(""===e.charAt(0)&&""===e.charAt(1)),de.emptyPath();const n=t-2,r=[];let i="";for(let a=0;a<t;){const t=e.indexOf("",a);switch((t<0||t>n)&&$(),e.charAt(t+1)){case"":var s=e.substring(a,t);let n;0===i.length?n=s:(i+=s,n=i,i=""),r.push(n);break;case"":i+=e.substring(a,t),i+="\0";break;case"":i+=e.substring(a,t+1);break;default:$()}a=t+2}return new de(r)}qe.oe=-1;const He=["userId","batchId"];function We(e,t){return[e,ze(t)]}function Je(e,t,n){return[e,ze(t),n]}const Ye={},Xe=["prefixPath","collectionGroup","readTime","documentId"],Ze=["prefixPath","collectionGroup","documentId"],et=["collectionGroup","readTime","prefixPath","documentId"],tt=["canonicalId","targetId"],nt=["targetId","path"],rt=["path","targetId"],it=["collectionId","parent"],st=["indexId","uid"],at=["uid","sequenceNumber"],ot=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],ut=["indexId","uid","orderedDocumentKey"],ct=["userId","collectionPath","documentId"],ht=["userId","collectionPath","largestBatchId"],lt=["userId","collectionGroup","largestBatchId"],dt=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ft=[...dt,"documentOverlays"],gt=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],mt=gt,pt=[...mt,"indexConfiguration","indexState","indexEntries"],yt=pt,vt=[...pt,"globals"];class wt extends xe{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function _t(e,t){var n=e;return Ne.F(n._e,t)}function bt(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function It(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Tt(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Et{constructor(e,t){this.comparator=e,this.root=t||xt.EMPTY}insert(e,t){return new Et(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,xt.BLACK,null,null))}remove(e){return new Et(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new St(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new St(this.root,e,this.comparator,!1)}getReverseIterator(){return new St(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new St(this.root,e,this.comparator,!0)}}class St{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class xt{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:xt.RED,this.left=null!=r?r:xt.EMPTY,this.right=null!=i?i:xt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new xt(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return xt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return xt.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,xt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,xt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $();if(this.right.isRed())throw $();var e=this.left.check();if(e!==this.right.check())throw $();return e+(this.isRed()?0:1)}}xt.EMPTY=null,xt.RED=!0,xt.BLACK=!1,xt.EMPTY=new class{constructor(){this.size=0}get key(){throw $()}get value(){throw $()}get color(){throw $()}get left(){throw $()}get right(){throw $()}copy(e,t,n,r,i){return this}insert(e,t,n){return new xt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Dt{constructor(e){this.comparator=e,this.data=new Et(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new At(this.data.getIterator())}getIteratorFrom(e){return new At(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Dt))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Dt(this.comparator);return t.data=e,t}}class At{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ct(e){return e.hasNext()?e.getNext():void 0}class Nt{constructor(e){(this.fields=e).sort(ge.comparator)}static empty(){return new Nt([])}unionWith(e){let t=new Dt(ge.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Nt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return oe(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class kt extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Rt{constructor(e){this.binaryString=e}static fromBase64String(e){var t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new kt("Invalid base64 string: "+e):e}}(e);return new Rt(t)}static fromUint8Array(e){var t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Rt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ae(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Rt.EMPTY_BYTE_STRING=new Rt("");const Ot=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mt(e){if(Q(!!e),"string"!=typeof e)return{seconds:Lt(e.seconds),nanos:Lt(e.nanos)};{let n=0;var t=Ot.exec(e);Q(!!t),t[1]&&(t=((t=t[1])+"000000000").substr(0,9),n=Number(t));const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:n}}}function Lt(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ft(e){return"string"==typeof e?Rt.fromBase64String(e):Rt.fromUint8Array(e)}function Vt(e){var t;return"server_timestamp"===(null===(t=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Pt(e){var t=e.mapValue.fields.__previous_value__;return Vt(t)?Pt(t):t}function Ut(e){var t=Mt(e.mapValue.fields.__local_write_time__.timestampValue);return new ce(t.seconds,t.nanos)}class Bt{constructor(e,t,n,r,i,s,a,o,u){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=u}}class qt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new qt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof qt&&e.projectId===this.projectId&&e.database===this.database}}const jt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Kt={nullValue:"NULL_VALUE"};function Gt(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Vt(e)?4:an(e)?9007199254740991:rn(e)?10:11:$()}function zt(e,t){if(e===t)return!0;var n,r,i=Gt(e);if(i!==Gt(t))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ut(e).isEqual(Ut(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=Mt(e.timestampValue),r=Mt(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r=t,Ft(e.bytesValue).isEqual(Ft(r.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return n=t,Lt((r=e).geoPointValue.latitude)===Lt(n.geoPointValue.latitude)&&Lt(r.geoPointValue.longitude)===Lt(n.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Lt(e.integerValue)===Lt(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=Lt(e.doubleValue),r=Lt(t.doubleValue);return n===r?Ke(n)===Ke(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return oe(e.arrayValue.values||[],t.arrayValue.values||[],zt);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(bt(n)!==bt(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!zt(n[e],r[e])))return!1;return!0}(e,t);default:return $()}}function $t(e,t){return void 0!==(e.values||[]).find((e=>zt(e,t)))}function Qt(e,t){if(e===t)return 0;var n,r,i,s,a,o,u,c=Gt(e),h=Gt(t);if(c!==h)return ae(c,h);switch(c){case 0:case 9007199254740991:return 0;case 1:return ae(e.booleanValue,t.booleanValue);case 2:return a=t,(o=Lt((s=e).integerValue||s.doubleValue))<(u=Lt(a.integerValue||a.doubleValue))?-1:u<o?1:o===u?0:isNaN(o)?isNaN(u)?0:-1:1;case 3:return Ht(e.timestampValue,t.timestampValue);case 4:return Ht(Ut(e),Ut(t));case 5:return ae(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ft(e),r=Ft(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=ae(n[e],r[e]);if(0!==t)return t}return ae(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return n=e.geoPointValue,r=t.geoPointValue,0!==(i=ae(Lt(n.latitude),Lt(r.latitude)))?i:ae(Lt(n.longitude),Lt(r.longitude));case 9:return Wt(e.arrayValue,t.arrayValue);case 10:return n=e.mapValue,r=t.mapValue,o=n.fields||{},u=r.fields||{},o=null===(i=o.value)||void 0===i?void 0:i.arrayValue,u=null===(i=u.value)||void 0===i?void 0:i.arrayValue,0!==(i=ae((null===(i=null==o?void 0:o.values)||void 0===i?void 0:i.length)||0,(null===(i=null==u?void 0:u.values)||void 0===i?void 0:i.length)||0))?i:Wt(o,u);case 11:return function(e,t){if(e===jt.mapValue&&t===jt.mapValue)return 0;if(e===jt.mapValue)return 1;if(t===jt.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=ae(r[e],s[e]);if(0!==t)return t;var a=Qt(n[r[e]],i[s[e]]);if(0!==a)return a}return ae(r.length,s.length)}(e.mapValue,t.mapValue);default:throw $()}}function Ht(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ae(e,t);var n=Mt(e),r=Mt(t),i=ae(n.seconds,r.seconds);return 0!==i?i:ae(n.nanos,r.nanos)}function Wt(e,t){var n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=Qt(n[e],r[e]);if(t)return t}return ae(n.length,r.length)}function Jt(e){return function e(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(e){const t=Mt(e);return`time(${t.seconds},${t.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(e){return Ft(e).toBase64()}(t.bytesValue):"referenceValue"in t?function(e){return me.fromName(e).toString()}(t.referenceValue):"geoPointValue"in t?function(e){return`geo(${e.latitude},${e.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let n="[",r=!0;for(const i of t.values||[])r?r=!1:n+=",",n+=e(i);return n+"]"}(t.arrayValue):"mapValue"in t?function(t){const n=Object.keys(t.fields||{}).sort();let r="{",i=!0;for(const s of n)i?i=!1:r+=",",r+=`${s}:${e(t.fields[s])}`;return r+"}"}(t.mapValue):$()}(e)}function Yt(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Xt(e){return!!e&&"integerValue"in e}function Zt(e){return!!e&&"arrayValue"in e}function en(e){return e&&"nullValue"in e}function tn(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function nn(e){return e&&"mapValue"in e}function rn(e){var t;return"__vector__"===(null===(t=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function sn(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return It(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=sn(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=sn(e.arrayValue.values[n]);return t}return Object.assign({},e)}function an(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}const on={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function un(e,t){var n=Qt(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function cn(e,t){var n=Qt(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class hn{constructor(e){this.value=e}static empty(){return new hn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!nn(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=sn(t)}setAll(e){let t=ge.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=sn(e):r.push(i.lastSegment())}));var i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());nn(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return zt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];nn(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){It(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new hn(sn(this.value))}}class ln{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new ln(e,0,he.min(),he.min(),he.min(),hn.empty(),0)}static newFoundDocument(e,t,n,r){return new ln(e,1,t,he.min(),n,r,0)}static newNoDocument(e,t){return new ln(e,2,t,he.min(),he.min(),hn.empty(),0)}static newUnknownDocument(e,t){return new ln(e,3,t,he.min(),he.min(),hn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(he.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=hn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=hn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=he.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ln&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ln(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class dn{constructor(e,t){this.position=e,this.inclusive=t}}function fn(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],a=e.position[i];if(r=s.field.isKeyField()?me.comparator(me.fromName(a.referenceValue),n.key):Qt(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function gn(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!zt(e.position[n],t.position[n]))return!1;return!0}class mn{constructor(e,t="asc"){this.field=e,this.dir=t}}class pn{}class yn extends pn{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Sn(e,t,n):"array-contains"===t?new Cn(e,n):"in"===t?new Nn(e,n):"not-in"===t?new kn(e,n):"array-contains-any"===t?new Rn(e,n):new yn(e,t,n)}static createKeyFieldInFilter(e,t,n){return new("in"===t?xn:Dn)(e,n)}matches(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Qt(t,this.value)):null!==t&&Gt(this.value)===Gt(t)&&this.matchesComparison(Qt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return $()}}isInequality(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class vn extends pn{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new vn(e,t)}matches(e){return wn(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function wn(e){return"and"===e.op}function _n(e){return"or"===e.op}function bn(e){return In(e)&&wn(e)}function In(e){for(const t of e.filters)if(t instanceof vn)return!1;return!0}function Tn(e,t){var n=e.filters.concat(t);return vn.create(n,e.op)}function En(e){return e instanceof yn?`${(t=e).field.canonicalString()} ${t.op} ${Jt(t.value)}`:e instanceof vn?e.op.toString()+" {"+e.getFilters().map(En).join(" ,")+"}":"Filter";var t}class Sn extends yn{constructor(e,t,n){super(e,t,n),this.key=me.fromName(n.referenceValue)}matches(e){var t=me.comparator(e.key,this.key);return this.matchesComparison(t)}}class xn extends yn{constructor(e,t){super(e,"in",t),this.keys=An(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Dn extends yn{constructor(e,t){super(e,"not-in",t),this.keys=An(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function An(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>me.fromName(e.referenceValue)))}class Cn extends yn{constructor(e,t){super(e,"array-contains",t)}matches(e){var t=e.data.field(this.field);return Zt(t)&&$t(t.arrayValue,this.value)}}class Nn extends yn{constructor(e,t){super(e,"in",t)}matches(e){var t=e.data.field(this.field);return null!==t&&$t(this.value.arrayValue,t)}}class kn extends yn{constructor(e,t){super(e,"not-in",t)}matches(e){if($t(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!$t(this.value.arrayValue,t)}}class Rn extends yn{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Zt(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>$t(this.value.arrayValue,e)))}}class On{constructor(e,t=null,n=[],r=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ue=null}}function Mn(e,t=null,n=[],r=[],i=null,s=null,a=null){return new On(e,t,n,r,i,s,a)}function Ln(e){const t=e;if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>function e(t){if(t instanceof yn)return t.field.canonicalString()+t.op.toString()+Jt(t.value);if(bn(t))return t.filters.map((t=>e(t))).join(",");var n=t.filters.map((t=>e(t))).join(",");return`${t.op}(${n})`}(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),je(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Jt(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Jt(e))).join(",")),t.ue=e}return t.ue}function Fn(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(n=e.orderBy[i],r=t.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;var n,r;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof yn?(i=t,(s=n)instanceof yn&&i.op===s.op&&i.field.isEqual(s.field)&&zt(i.value,s.value)):t instanceof vn?(r=n)instanceof vn&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce(((t,n,i)=>t&&e(n,r.filters[i])),!0):void $();var r,i,s}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!gn(e.startAt,t.startAt)&&gn(e.endAt,t.endAt)}function Vn(e){return me.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Pn(e,t){return e.filters.filter((e=>e instanceof yn&&e.field.isEqual(t)))}function Un(e,t,n){let r=Kt,i=!0;for(const n of Pn(e,t)){let e=Kt,t=!0;switch(n.op){case"<":case"<=":e="nullValue"in(s=n.value)?Kt:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?Yt(qt.empty(),me.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?rn(s)?on:{mapValue:{}}:$();break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=Kt}un({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}var s;if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];un({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function Bn(e,t,n){let r=jt,i=!0;for(const n of Pn(e,t)){let e=jt,t=!0;switch(n.op){case">=":case">":e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?Yt(qt.empty(),me.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?on:"mapValue"in s?rn(s)?{mapValue:{}}:jt:$(),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=jt}0<cn({value:r,inclusive:i},{value:e,inclusive:t})&&(r=e,i=t)}var s;if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];0<cn({value:r,inclusive:i},{value:e,inclusive:n.inclusive})&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class qn{constructor(e,t=null,n=[],r=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function jn(e,t,n,r,i,s,a,o){return new qn(e,t,n,r,i,s,a,o)}function Kn(e){return new qn(e)}function Gn(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function zn(e){return null!==e.collectionGroup}function $n(e){const t=e;if(null===t.ce){t.ce=[];const e=new Set;for(const n of t.explicitOrderBy)t.ce.push(n),e.add(n.field.canonicalString());const n=0<t.explicitOrderBy.length?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new Dt(ge.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.ce.push(new mn(r,n))})),e.has(ge.keyField().canonicalString())||t.ce.push(new mn(ge.keyField(),n))}return t.ce}function Qn(e){const t=e;return t.le||(t.le=function(e,t){if("F"===e.limitType)return Mn(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);t=t.map((e=>{var t="desc"===e.dir?"asc":"desc";return new mn(e.field,t)}));var n=e.endAt?new dn(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new dn(e.startAt.position,e.startAt.inclusive):null;return Mn(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}(t,$n(e))),t.le}function Hn(e,t){var n=e.filters.concat([t]);return new qn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Wn(e,t,n){return new qn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Jn(e,t){return Fn(Qn(e),Qn(t))&&e.limitType===t.limitType}function Yn(e){return`${Ln(Qn(e))}|lt:${e.limitType}`}function Xn(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map((e=>En(e))).join(", ")}]`),je(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Jt(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Jt(e))).join(",")),`Target(${t})`}(Qn(e))}; limitType=${e.limitType})`}function Zn(e,t){return t.isFoundDocument()&&(i=e,a=(s=t).key.path,null!==i.collectionGroup?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(a):me.isDocumentKey(i.path)?i.path.isEqual(a):i.path.isImmediateParentOf(a))&&function(e,t){for(const n of $n(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return;return 1}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return;return 1}(e,t)&&(i=t,!((t=e).startAt&&(n=t.startAt,e=$n(t),r=fn(n,e,i),!(n.inclusive?r<=0:r<0))||t.endAt&&(n=t.endAt,t=$n(t),r=fn(n,t,i),!(n.inclusive?0<=r:0<r))));var n,r,i,s,a}function er(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function tr(e){return(t,n)=>{let r=!1;for(const i of $n(e)){const e=function(e,t,n){var r=e.field.isKeyField()?me.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Qt(r,i):$()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return $()}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class nr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){It(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return Tt(this.inner)}size(){return this.innerSize}}const rr=new Et(me.comparator),ir=new Et(me.comparator);function sr(...e){let t=ir;for(const n of e)t=t.insert(n.key,n);return t}function ar(e){let t=ir;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function or(){return new nr((e=>e.toString()),((e,t)=>e.isEqual(t)))}const ur=new Et(me.comparator),cr=new Dt(me.comparator);function hr(...e){let t=cr;for(const n of e)t=t.add(n);return t}const lr=new Dt(ae);function dr(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ke(t)?"-0":t}}function fr(e){return{integerValue:""+e}}function gr(e,t){return Ge(t)?fr(t):dr(e,t)}class mr{constructor(){this._=void 0}}function pr(e,t){return e instanceof Ir?Xt(e=t)||e&&"doubleValue"in e?t:{integerValue:0}:null}class yr extends mr{}class vr extends mr{constructor(e){super(),this.elements=e}}function wr(e,t){const n=Er(t);for(const t of e.elements)n.some((e=>zt(e,t)))||n.push(t);return{arrayValue:{values:n}}}class _r extends mr{constructor(e){super(),this.elements=e}}function br(e,t){let n=Er(t);for(const t of e.elements)n=n.filter((e=>!zt(e,t)));return{arrayValue:{values:n}}}class Ir extends mr{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Tr(e){return Lt(e.integerValue||e.doubleValue)}function Er(e){return Zt(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Sr{constructor(e,t){this.field=e,this.transform=t}}class xr{constructor(e,t){this.version=e,this.transformResults=t}}class Dr{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Dr}static exists(e){return new Dr(void 0,e)}static updateTime(e){return new Dr(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ar(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Cr{}function Nr(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Ur(e.key,Dr.none()):new Mr(e.key,e.data,Dr.none());{const r=e.data,i=hn.empty();let s=new Dt(ge.comparator);for(var n of t.fields)if(!s.has(n)){let e=r.field(n);null===e&&1<n.length&&(n=n.popLast(),e=r.field(n)),null===e?i.delete(n):i.set(n,e),s=s.add(n)}return new Lr(e.key,i,new Nt(s.toArray()),Dr.none())}}function kr(e,t,n){e instanceof Mr?function(e,t,n){const r=e.value.clone(),i=Vr(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Lr?function(e,t,n){if(!Ar(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=Vr(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Fr(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function Rr(e,t,n,r){return e instanceof Mr?function(e,t,n,r){if(!Ar(e.precondition,t))return n;const i=e.value.clone(),s=Pr(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Lr?function(e,t,n,r){if(!Ar(e.precondition,t))return n;const i=Pr(e.fieldTransforms,r,t),s=t.data;return s.setAll(Fr(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):Ar(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function Or(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&oe(n,r,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof vr&&t instanceof vr||e instanceof _r&&t instanceof _r?oe(e.elements,t.elements,zt):e instanceof Ir&&t instanceof Ir?zt(e.Pe,t.Pe):e instanceof yr&&t instanceof yr)}(e,t))))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}class Mr extends Cr{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Lr extends Cr{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Fr(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{var r;n.isEmpty()||(r=e.data.field(n),t.set(n,r))})),t}function Vr(e,t,n){const r=new Map;Q(e.length===n.length);for(let h=0;h<n.length;h++){var i=e[h],s=i.transform,a=t.data.field(i.field);r.set(i.field,(o=s,u=a,c=n[h],o instanceof vr?wr(o,u):o instanceof _r?br(o,u):c))}var o,u,c;return r}function Pr(e,t,n){const r=new Map;for(const u of e){const e=u.transform,c=n.data.field(u.field);r.set(u.field,(i=e,s=c,o=a=void 0,i instanceof yr?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return(t=t&&Vt(t)?Pt(t):t)&&(n.fields.__previous_value__=t),{mapValue:n}}(t,s):i instanceof vr?wr(i,s):i instanceof _r?br(i,s):(o=Tr(a=pr(i,s))+Tr(i.Pe),Xt(a)&&Xt(i.Pe)?fr(o):dr(i.serializer,o))))}var i,s,a,o;return r}class Ur extends Cr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Br extends Cr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class qr{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){var n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&kr(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Rr(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Rr(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=or();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let a=this.applyToLocalView(s,i.mutatedFields);a=t.has(r.key)?null:a;var o=Nr(s,a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(he.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),hr())}isEqual(e){return this.batchId===e.batchId&&oe(this.mutations,e.mutations,((e,t)=>Or(e,t)))&&oe(this.baseMutations,e.baseMutations,((e,t)=>Or(e,t)))}}class jr{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Q(e.mutations.length===n.length);let r=ur;var i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new jr(e,t,n,r)}}class Kr{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Gr{constructor(e,t){this.count=e,this.unchangedNames=t}}function zr(e){switch(e){default:return $();case H.CANCELLED:case H.UNKNOWN:case H.DEADLINE_EXCEEDED:case H.RESOURCE_EXHAUSTED:case H.INTERNAL:case H.UNAVAILABLE:case H.UNAUTHENTICATED:return!1;case H.INVALID_ARGUMENT:case H.NOT_FOUND:case H.ALREADY_EXISTS:case H.PERMISSION_DENIED:case H.FAILED_PRECONDITION:case H.ABORTED:case H.OUT_OF_RANGE:case H.UNIMPLEMENTED:case H.DATA_LOSS:return!0}}function $r(e){if(void 0===e)return K("GRPC error has no .code"),H.UNKNOWN;switch(e){case M.OK:return H.OK;case M.CANCELLED:return H.CANCELLED;case M.UNKNOWN:return H.UNKNOWN;case M.DEADLINE_EXCEEDED:return H.DEADLINE_EXCEEDED;case M.RESOURCE_EXHAUSTED:return H.RESOURCE_EXHAUSTED;case M.INTERNAL:return H.INTERNAL;case M.UNAVAILABLE:return H.UNAVAILABLE;case M.UNAUTHENTICATED:return H.UNAUTHENTICATED;case M.INVALID_ARGUMENT:return H.INVALID_ARGUMENT;case M.NOT_FOUND:return H.NOT_FOUND;case M.ALREADY_EXISTS:return H.ALREADY_EXISTS;case M.PERMISSION_DENIED:return H.PERMISSION_DENIED;case M.FAILED_PRECONDITION:return H.FAILED_PRECONDITION;case M.ABORTED:return H.ABORTED;case M.OUT_OF_RANGE:return H.OUT_OF_RANGE;case M.UNIMPLEMENTED:return H.UNIMPLEMENTED;case M.DATA_LOSS:return H.DATA_LOSS;default:return $()}}function Qr(){return new TextEncoder}(S=M=M||{})[S.OK=0]="OK",S[S.CANCELLED=1]="CANCELLED",S[S.UNKNOWN=2]="UNKNOWN",S[S.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",S[S.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",S[S.NOT_FOUND=5]="NOT_FOUND",S[S.ALREADY_EXISTS=6]="ALREADY_EXISTS",S[S.PERMISSION_DENIED=7]="PERMISSION_DENIED",S[S.UNAUTHENTICATED=16]="UNAUTHENTICATED",S[S.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",S[S.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",S[S.ABORTED=10]="ABORTED",S[S.OUT_OF_RANGE=11]="OUT_OF_RANGE",S[S.UNIMPLEMENTED=12]="UNIMPLEMENTED",S[S.INTERNAL=13]="INTERNAL",S[S.UNAVAILABLE=14]="UNAVAILABLE",S[S.DATA_LOSS=15]="DATA_LOSS";const Hr=new T([4294967295,4294967295],0);function Wr(e){const t=Qr().encode(e),n=new E;return n.update(t),new Uint8Array(n.digest())}function Jr(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new T([n,r],0),new T([i,s],0)]}class Yr{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||8<=t)throw new Xr(`Invalid padding: ${t}`);if(n<0)throw new Xr(`Invalid hash count: ${n}`);if(0<e.length&&0===this.hashCount)throw new Xr(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Xr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=T.fromNumber(this.Ie)}Ee(e,t,n){let r=e.add(t.multiply(T.fromNumber(n)));return 1===r.compare(Hr)&&(r=new T([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Te).toNumber()}de(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=Wr(e),[n,r]=Jr(t);for(let e=0;e<this.hashCount;e++){const t=this.Ee(n,r,e);if(!this.de(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new Yr(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0!==this.Ie){const t=Wr(e),[n,r]=Jr(t);for(let e=0;e<this.hashCount;e++){const t=this.Ee(n,r,e);this.Ae(t)}}}Ae(e){var t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Xr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Zr{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,ei.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Zr(he.min(),r,new Et(ae),rr,hr())}}class ei{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ei(n,t,hr(),hr(),hr())}}class ti{constructor(e,t,n,r){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=r}}class ni{constructor(e,t){this.targetId=e,this.me=t}}class ri{constructor(e,t,n=Rt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class ii{constructor(){this.fe=0,this.ge=oi(),this.pe=Rt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){0<e.approximateByteSize()&&(this.we=!0,this.pe=e)}ve(){let e=hr(),t=hr(),n=hr();return this.ge.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:$()}})),new ei(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=oi()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){--this.fe,Q(0<=this.fe)}Ne(){this.we=!0,this.ye=!0}}class si{constructor(e){this.Le=e,this.Be=new Map,this.ke=rr,this.qe=ai(),this.Qe=new Et(ae)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,(t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:$()}}))}forEachTarget(e,t){0<e.targetIds.length?e.targetIds.forEach(t):this.Be.forEach(((e,n)=>{this.ze(n)&&t(n)}))}He(e){const t=e.targetId,n=e.me.count,r=this.Je(t);if(r){var i=r.target;if(Vn(i))if(0===n){const e=new me(i.path);this.Ue(t,e,ln.newNoDocument(e,he.min()))}else Q(1===n);else{const r=this.Ye(t);if(r!==n){const n=this.Ze(e),i=n?this.Xe(n,e,r):1;if(0!==i){this.je(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}}}}}Ze(e){var t;if(!(t=e.me.unchangedNames)||!t.bits)return null;var{bits:{bitmap:n="",padding:r=0},hashCount:t=0}=t;let i,s;try{i=Ft(n).toUint8Array()}catch(e){if(e instanceof kt)return G("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{s=new Yr(i,r,t)}catch(e){return G(e instanceof Xr?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===s.Ie?null:s}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{var i=`projects/${(i=this.Le.tt()).projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(i)||(this.Ue(t,n,null),r++)})),r}rt(e){const t=new Map;this.Be.forEach(((n,r)=>{var i=this.Je(r);if(i){if(n.current&&Vn(i.target)){const t=new me(i.target.path);null!==this.ke.get(t)||this.it(r,t)||this.Ue(r,t,ln.newNoDocument(t,e))}n.be&&(t.set(r,n.ve()),n.Ce())}}));let n=hr();this.qe.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{var t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1)})),r&&(n=n.add(e))})),this.ke.forEach(((t,n)=>n.setReadTime(e)));var r=new Zr(e,t,this.Qe,this.ke,n);return this.ke=rr,this.qe=ai(),this.Qe=new Et(ae),r}$e(e,t){var n;this.ze(e)&&(n=this.it(e,t.key)?2:0,this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e)))}Ue(e,t,n){if(this.ze(e)){const r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}}removeTarget(e){this.Be.delete(e)}Ye(e){var t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new ii,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Dt(ae),this.qe=this.qe.insert(e,t)),t}ze(e){var t=null!==this.Je(e);return t||j("WatchChangeAggregator","Detected inactive target",e),t}Je(e){var t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new ii),this.Le.getRemoteKeysForTarget(e).forEach((t=>{this.Ue(e,t,null)}))}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function ai(){return new Et(me.comparator)}function oi(){return new Et(me.comparator)}const ui={asc:"ASCENDING",desc:"DESCENDING"},ci={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},hi={and:"AND",or:"OR"};class li{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function di(e,t){return e.useProto3Json||je(t)?t:{value:t}}function fi(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function gi(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function mi(e){return Q(!!e),he.fromTimestamp((t=Mt(e),new ce(t.seconds,t.nanos)));var t}function pi(e,t){return yi(e,t).canonicalString()}function yi(e,t){const n=new de(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function vi(e){var t=de.fromString(e);return Q(Fi(t)),t}function wi(e,t){return pi(e.databaseId,t.path)}function _i(e,t){const n=vi(t);if(n.get(1)!==e.databaseId.projectId)throw new W(H.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new W(H.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new me(Ei(n))}function bi(e,t){return pi(e.databaseId,t)}function Ii(e){var t=vi(e);return 4===t.length?de.emptyPath():Ei(t)}function Ti(e){return new de(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ei(e){return Q(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function Si(e,t,n){return{name:wi(e,t),fields:n.value.mapValue.fields}}function xi(e,t,n){const r=_i(e,t.name),i=mi(t.updateTime),s=t.createTime?mi(t.createTime):he.min(),a=new hn({mapValue:{fields:t.fields}}),o=ln.newFoundDocument(r,i,s,a);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Di(e,t){let n;if(t instanceof Mr)n={update:Si(e,t.key,t.value)};else if(t instanceof Ur)n={delete:wi(e,t.key)};else if(t instanceof Lr)n={update:Si(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof Br))return $();n={verify:wi(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e){var t=e.transform;if(t instanceof yr)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof vr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof _r)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Ir)return{fieldPath:e.field.canonicalString(),increment:t.Pe};throw $()}(e)))),t.precondition.isNone||(n.currentDocument=(r=e,void 0!==(e=t.precondition).updateTime?{updateTime:(t=e.updateTime,fi(r,t.toTimestamp()))}:void 0!==e.exists?{exists:e.exists}:$())),n;var r}function Ai(e,t){const n=t.currentDocument?void 0!==(i=t.currentDocument).updateTime?Dr.updateTime(mi(i.updateTime)):void 0!==i.exists?Dr.exists(i.exists):Dr.none():Dr.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)Q("REQUEST_TIME"===t.setToServerValue),n=new yr;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new vr(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new _r(e)}else"increment"in t?n=new Ir(e,t.increment):$();var r=ge.fromServerFormat(t.fieldPath);return new Sr(r,n)}(e,t))):[];var i;if(t.update){t.update.name;var s=_i(e,t.update.name),a=new hn({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new Nt(t.map((e=>ge.fromServerFormat(e))))}(t.updateMask);return new Lr(s,a,e,n,r)}return new Mr(s,a,n,r)}if(t.delete){const r=_i(e,t.delete);return new Ur(r,n)}if(t.verify){const r=_i(e,t.verify);return new Br(r,n)}return $()}function Ci(e,t){return{documents:[bi(e,t.path)]}}function Ni(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=bi(e,i);var s=function(e){if(0!==e.length)return function e(t){return t instanceof yn?function(e){if("=="===e.op){if(tn(e.value))return{unaryFilter:{field:Mi(e.field),op:"IS_NAN"}};if(en(e.value))return{unaryFilter:{field:Mi(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(tn(e.value))return{unaryFilter:{field:Mi(e.field),op:"IS_NOT_NAN"}};if(en(e.value))return{unaryFilter:{field:Mi(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Mi(e.field),op:Ri(e.op),value:e.value}}}(t):t instanceof vn?function(t){const n=t.getFilters().map((t=>e(t)));return 1===n.length?n[0]:{compositeFilter:{op:Oi(t.op),filters:n}}}(t):$()}(vn.create(e,"and"))}(t.filters);return s&&(n.structuredQuery.where=s),s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Mi(e.field),direction:(e=e.dir,ui[e])}}(e)))}(t.orderBy),s&&(n.structuredQuery.orderBy=s),null!==(s=di(e,t.limit))&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt={before:(e=t.startAt).inclusive,values:e.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),{_t:n,parent:i}}function ki(e){let t=Ii(e.parent);var n,r,i,s=e.structuredQuery,a=s.from?s.from.length:0;let o=null;if(0<a){Q(1===a);const e=s.from[0];e.allDescendants?o=e.collectionId:t=t.child(e.collectionId)}let u=[];s.where&&(u=function(e){const t=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Li(e.unaryFilter.field);return yn.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Li(e.unaryFilter.field);return yn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Li(e.unaryFilter.field);return yn.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Li(e.unaryFilter.field);return yn.create(i,"!=",{nullValue:"NULL_VALUE"});default:return $()}}(t):void 0!==t.fieldFilter?function(e){return yn.create(Li(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return $()}}(e.fieldFilter.op),e.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return vn.create(t.compositeFilter.filters.map((t=>e(t))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return $()}}(t.compositeFilter.op))}(t):$()}(e);return t instanceof vn&&bn(t)?t.getFilters():[t]}(s.where));let c=[];s.orderBy&&(c=s.orderBy.map((e=>function(e){return new mn(Li(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let h=null;s.limit&&(h=je(n="object"==typeof(e=s.limit)?e.value:e)?null:n);let l=null;s.startAt&&(i=!!(r=s.startAt).before,n=r.values||[],l=new dn(n,i));let d=null;return s.endAt&&(i=!(r=s.endAt).before,s=r.values||[],d=new dn(s,i)),jn(t,o,c,u,h,"F",l,d)}function Ri(e){return ci[e]}function Oi(e){return hi[e]}function Mi(e){return{fieldPath:e.canonicalString()}}function Li(e){return ge.fromServerFormat(e.fieldPath)}function Fi(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}class Vi{constructor(e,t,n,r,i=he.min(),s=he.min(),a=Rt.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new Vi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Vi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Vi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Vi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Pi{constructor(e){this.ct=e}}function Ui(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Bi(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:wi(i=e.ct,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:fi(i,e.version.toTimestamp()),createTime:fi(i,e.createTime.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:qi(t.version)};else{if(!t.isUnknownDocument())return $();r.unknownDocument={path:n.path.toArray(),version:qi(t.version)}}var i;return r}function Bi(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function qi(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function ji(e){var t=new ce(e.seconds,e.nanoseconds);return he.fromTimestamp(t)}function Ki(e,t){const n=(t.baseMutations||[]).map((t=>Ai(e.ct,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>Ai(e.ct,t))),i=ce.fromMillis(t.localWriteTimeMs);return new qr(t.batchId,i,n,r)}function Gi(e){var t,n=ji(e.readTime),r=void 0!==e.lastLimboFreeSnapshotVersion?ji(e.lastLimboFreeSnapshotVersion):he.min(),i=void 0!==e.query.documents?(Q(1===(t=e.query).documents.length),Qn(Kn(Ii(t.documents[0])))):Qn(ki(e.query));return new Vi(i,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,n,r,Rt.fromBase64String(e.resumeToken))}function zi(e,t){var n=qi(t.snapshotVersion),r=qi(t.lastLimboFreeSnapshotVersion),i=Vn(t.target)?Ci(e.ct,t.target):Ni(e.ct,t.target)._t,s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Ln(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function $i(e){var t=ki({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Wn(t,t.limit,"L"):t}function Qi(e,t){return new Kr(t.largestBatchId,Ai(e.ct,t.overlayMutation))}function Hi(e,t){var n=t.path.lastSegment();return[e,ze(t.path.popLast()),n]}function Wi(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:qi(r.readTime),documentKey:ze(r.documentKey.path),largestBatchId:r.largestBatchId}}class Ji{getBundleMetadata(e,t){return Yi(e).get(t).next((e=>{if(e)return{id:e.bundleId,createTime:ji(e.createTime),version:e.version}}))}saveBundleMetadata(e,t){return Yi(e).put({bundleId:t.id,createTime:qi(mi(t.createTime)),version:t.version})}getNamedQuery(e,t){return Xi(e).get(t).next((e=>{if(e)return{name:e.name,query:$i(e.bundledQuery),readTime:ji(e.readTime)}}))}saveNamedQuery(e,t){return Xi(e).put({name:t.name,readTime:qi(mi(t.readTime)),bundledQuery:t.bundledQuery})}}function Yi(e){return _t(e,"bundles")}function Xi(e){return _t(e,"namedQueries")}class Zi{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){var n=t.uid||"";return new Zi(e,n)}getOverlay(e,t){return es(e).get(Hi(this.userId,t)).next((e=>e?Qi(this.serializer,e):null))}getOverlays(e,t){const n=or();return Ae.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{var s=new Kr(t,i);r.push(this.ht(e,s))})),Ae.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(ze(e.getCollectionPath()))));const i=[];return r.forEach((t=>{var r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(es(e).j("collectionPathOverlayIndex",r))})),Ae.waitFor(i)}getOverlaysForCollection(e,t,n){const r=or(),i=ze(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return es(e).U("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=Qi(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=or();let s;var a=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return es(e).J({index:"collectionGroupOverlayIndex",range:a},((e,t,n)=>{const a=Qi(this.serializer,t);i.size()<r||a.largestBatchId===s?(i.set(a.getKey(),a),s=a.largestBatchId):n.done()})).next((()=>i))}ht(e,t){return es(e).put(function(e,t,n){var[,r,i]=Hi(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:i,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Di(e.ct,n.mutation)}}(this.serializer,this.userId,t))}}function es(e){return _t(e,"documentOverlays")}class ts{Pt(e){return _t(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next((e=>{var t=null==e?void 0:e.value;return t?Rt.fromUint8Array(t):Rt.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class ns{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Lt(e.integerValue));else if("doubleValue"in e){var n=Lt(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),Ke(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=Mt(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else"stringValue"in e?(this.Vt(e.stringValue,t),this.ft(t)):"bytesValue"in e?(this.dt(t,30),t.gt(Ft(e.bytesValue)),this.ft(t)):"referenceValue"in e?this.yt(e.referenceValue,t):"geoPointValue"in e?(n=e.geoPointValue,this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)):"mapValue"in e?an(e)?this.dt(t,Number.MAX_SAFE_INTEGER):rn(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):$()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){var n=e.fields||{};this.dt(t,55);for(const e of Object.keys(n))this.Vt(e,t),this.Tt(n[e],t)}wt(e,t){var n=e.fields||{};this.dt(t,53);var r=(null===(r=null===(r=n.value.arrayValue)||void 0===r?void 0:r.values)||void 0===r?void 0:r.length)||0;this.dt(t,15),t.At(Lt(r)),this.Vt("value",t),this.Tt(n.value,t)}bt(e,t){var n=e.values||[];this.dt(t,50);for(const e of n)this.Tt(e,t)}yt(e,t){this.dt(t,37),me.fromName(e).path.forEach((e=>{this.dt(t,60),this.Dt(e,t)}))}dt(e,t){e.At(t)}ft(e){e.At(2)}}function rs(e){var t=64-function(e){let t=0;for(let r=0;r<8;++r){var n=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&e[r]);if(t+=n,8!==n)break}return t}(e);return Math.ceil(t/8)}ns.vt=new ns;class is{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ft(e);else if(e<2048)this.Ft(960|e>>>6),this.Ft(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|e>>>12),this.Ft(128|63&e>>>6),this.Ft(128|63&e);else{const e=t.codePointAt(0);this.Ft(240|e>>>18),this.Ft(128|63&e>>>12),this.Ft(128|63&e>>>6),this.Ft(128|63&e)}}this.Mt()}Bt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Ot(e);else if(e<2048)this.Ot(960|e>>>6),this.Ot(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Ot(480|e>>>12),this.Ot(128|63&e>>>6),this.Ot(128|63&e);else{const e=t.codePointAt(0);this.Ot(240|e>>>18),this.Ot(128|63&e>>>12),this.Ot(128|63&e>>>6),this.Ot(128|63&e)}}this.Nt()}kt(e){var t=this.qt(e),n=rs(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Kt(e){var t=this.qt(e),n=rs(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}Ft(e){var t=255&e;0==t?(this.Ut(0),this.Ut(255)):255==t?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){var t=255&e;0==t?(this.Gt(0),this.Gt(255)):255==t?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){var t=e+this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class ss{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class as{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class os{constructor(){this.jt=new is,this.Ht=new ss(this.jt),this.Jt=new as(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return 0===e?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}class us{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}Zt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new us(this.indexId,this.documentKey,this.arrayValue,n)}}function cs(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=hs(e.arrayValue,t.arrayValue),0!==n?n:(n=hs(e.directionalValue,t.directionalValue),0!==n?n:me.comparator(e.documentKey,t.documentKey)))}function hs(e,t){for(let r=0;r<e.length&&r<t.length;++r){var n=e[r]-t[r];if(0!=n)return n}return e.length-t.length}class ls{constructor(e){this.Xt=new Dt(((e,t)=>ge.comparator(e.field,t.field))),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const e=t;e.isInequality()?this.Xt=this.Xt.add(e):this.tn.push(e)}}get nn(){return 1<this.Xt.size}rn(e){if(Q(e.collectionGroup===this.collectionId),this.nn)return!1;const t=ye(e);if(void 0!==t&&!this.sn(t))return!1;const n=ve(e);let r=new Set,i=0,s=0;for(;i<n.length&&this.sn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(0<this.Xt.size){const e=this.Xt.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=n[i];if(!this.on(e,t)||!this._n(this.en[s++],t))return!1}++i}for(;i<n.length;++i){const e=n[i];if(s>=this.en.length||!this._n(this.en[s++],e))return!1}return!0}an(){if(this.nn)return null;let e=new Dt(ge.comparator);const t=[];for(const n of this.tn)n.field.isKeyField()||("array-contains"===n.op||"array-contains-any"===n.op?t.push(new we(n.field,2)):e.has(n.field)||(e=e.add(n.field),t.push(new we(n.field,0))));for(const n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new we(n.field,"asc"===n.dir?0:1)));return new pe(pe.UNKNOWN_ID,this.collectionId,t,_e.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind==n}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function ds(e){return e instanceof yn}function fs(e){return e instanceof vn&&bn(e)}function gs(e){return ds(e)||fs(e)||function(e){if(e instanceof vn&&_n(e)){for(const t of e.getFilters())if(!ds(t)&&!fs(t))return!1;return!0}return!1}(e)}function ms(e,t){var n,r;return Q(e instanceof yn||e instanceof vn),Q(t instanceof yn||t instanceof vn),ys(e instanceof yn?t instanceof yn?(n=e,r=t,vn.create([n,r],"and")):ps(e,t):t instanceof yn?ps(t,e):function(e,t){if(Q(0<e.filters.length&&0<t.filters.length),wn(e)&&wn(t))return Tn(e,t.getFilters());const n=_n(e)?e:t,r=_n(e)?t:e,i=n.filters.map((e=>ms(e,r)));return vn.create(i,"or")}(e,t))}function ps(e,t){if(wn(t))return Tn(t,e.getFilters());var n=t.filters.map((t=>ms(e,t)));return vn.create(n,"or")}function ys(e){if(Q(e instanceof yn||e instanceof vn),e instanceof yn)return e;const t=e.getFilters();if(1===t.length)return ys(t[0]);if(In(e))return e;const n=t.map((e=>ys(e))),r=[];return n.forEach((t=>{t instanceof yn?r.push(t):t instanceof vn&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:vn.create(r,e.op)}class vs{constructor(){this.un=new ws}addToCollectionParentIndex(e,t){return this.un.add(t),Ae.resolve()}getCollectionParents(e,t){return Ae.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return Ae.resolve()}deleteFieldIndex(e,t){return Ae.resolve()}deleteAllFieldIndexes(e){return Ae.resolve()}createTargetIndexes(e,t){return Ae.resolve()}getDocumentsMatchingTarget(e,t){return Ae.resolve(null)}getIndexType(e,t){return Ae.resolve(0)}getFieldIndexes(e,t){return Ae.resolve([])}getNextCollectionGroupToUpdate(e){return Ae.resolve(null)}getMinOffset(e,t){return Ae.resolve(Te.min())}getMinOffsetFromCollectionGroup(e,t){return Ae.resolve(Te.min())}updateCollectionGroup(e,t,n){return Ae.resolve()}updateIndexEntries(e,t){return Ae.resolve()}}class ws{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Dt(de.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Dt(de.comparator)).toArray()}}const _s=new Uint8Array(0);class bs{constructor(e,t){this.databaseId=t,this.cn=new ws,this.ln=new nr((e=>Ln(e)),((e,t)=>Fn(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this.cn.has(t))return Ae.resolve();var n=t.lastSegment(),r=t.popLast();return e.addOnCommittedListener((()=>{this.cn.add(t)})),r={collectionId:n,parent:ze(r)},Is(e).put(r)}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[ue(t),""],!1,!0);return Is(e).U(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Qe(r.parent))}return n}))}addFieldIndex(e,t){const n=Es(e),r={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))};delete r.indexId;const i=n.add(r);if(t.indexState){const n=Ss(e);return i.next((e=>{n.put(Wi(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=Es(e),r=Ss(e),i=Ts(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=Es(e),n=Ts(e),r=Ss(e);return t.j().next((()=>n.j())).next((()=>r.j()))}createTargetIndexes(e,t){return Ae.forEach(this.hn(t),(t=>this.getIndexType(e,t).next((n=>{if(0===n||1===n){const n=new ls(t).an();if(null!=n)return this.addFieldIndex(e,n)}}))))}getDocumentsMatchingTarget(e,t){const n=Ts(e);let r=!0;const i=new Map;return Ae.forEach(this.hn(t),(t=>this.Pn(e,t).next((e=>{r=r&&!!e,i.set(t,e)})))).next((()=>{if(r){let e=hr();const r=[];return Ae.forEach(i,((i,s)=>{var a;j("IndexedDbIndexManager",`Using index ${a=i,`id=${a.indexId}|cg=${a.collectionGroup}|f=${a.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${Ln(t)}`);var o=function(e,t){var n=ye(t);if(void 0===n)return null;for(const t of Pn(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),u=function(e,t){const n=new Map;for(const r of ve(t))for(const t of Pn(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),c=function(e,t){const n=[];let r=!0;for(const i of ve(t)){const t=(0===i.kind?Un:Bn)(e,i.fieldPath,e.startAt);n.push(t.value),r=r&&t.inclusive}return new dn(n,r)}(s,i),h=function(e,t){const n=[];let r=!0;for(const i of ve(t)){const t=(0===i.kind?Bn:Un)(e,i.fieldPath,e.endAt);n.push(t.value),r=r&&t.inclusive}return new dn(n,r)}(s,i),l=this.In(i,s,c),d=this.In(i,s,h);return u=this.Tn(i,s,u),u=this.En(i.indexId,o,l,c.inclusive,d,h.inclusive,u),Ae.forEach(u,(i=>n.G(i,t.limit).next((t=>{t.forEach((t=>{var n=me.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return Ae.resolve(null)}))}hn(e){let t=this.ln.get(e);return t||(t=0===e.filters.length?[e]:function(e){if(0===e.getFilters().length)return[];const t=function e(t){if(Q(t instanceof yn||t instanceof vn),t instanceof yn)return t;if(1===t.filters.length)return e(t.filters[0]);const n=t.filters.map((t=>e(t)));let r=vn.create(n,t.op);return r=ys(r),gs(r)?r:(Q(r instanceof vn),Q(wn(r)),Q(1<r.filters.length),r.filters.reduce(((e,t)=>ms(e,t))))}(function e(t){var n;if(Q(t instanceof yn||t instanceof vn),t instanceof yn){if(t instanceof Nn){const e=(null===(n=null===(n=t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===n?void 0:n.map((e=>yn.create(t.field,"==",e))))||[];return vn.create(e,"or")}return t}const r=t.filters.map((t=>e(t)));return vn.create(r,t.op)}(e));return Q(gs(t)),ds(t)||fs(t)?[t]:t.getFilters()}(vn.create(e.filters,"and")).map((t=>Mn(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.ln.set(e,t),t)}En(e,t,n,r,i,s,a){const o=(null!=t?t.length:1)*Math.max(n.length,i.length),u=o/(null!=t?t.length:1),c=[];for(let h=0;h<o;++h){const o=t?this.dn(t[h/u]):_s,l=this.An(e,o,n[h%u],r),d=this.Rn(e,o,i[h%u],s),f=a.map((t=>this.An(e,o,t,!0)));c.push(...this.createRange(l,d,f))}return c}An(e,t,n,r){const i=new us(e,me.empty(),t,n);return r?i:i.Zt()}Rn(e,t,n,r){const i=new us(e,me.empty(),t,n);return r?i.Zt():i}Pn(e,t){const n=new ls(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.rn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.hn(t);return Ae.forEach(r,(t=>this.Pn(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new Dt(ge.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&1<r.length&&2===n?1:n))}Vn(e,t){const n=new os;for(const i of ve(e)){const e=t.data.field(i.fieldPath);if(null==e)return null;var r=n.Yt(i.kind);ns.vt.It(e,r)}return n.zt()}dn(e){const t=new os;return ns.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const n=new os;return ns.vt.It(Yt(this.databaseId,t),n.Yt(0===(r=ve(e)).length?0:r[r.length-1].kind)),n.zt();var r}Tn(e,t,n){if(null===n)return[];let r=[];r.push(new os);let i=0;for(const s of ve(e)){const e=n[i++];for(const n of r)if(this.fn(t,s.fieldPath)&&Zt(e))r=this.gn(r,s,e);else{const t=n.Yt(s.kind);ns.vt.It(e,t)}}return this.pn(r)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new os;r.seed(n.zt()),ns.vt.It(e,r.Yt(t.kind)),i.push(r)}return i}fn(e,t){return!!e.filters.find((e=>e instanceof yn&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Es(e),r=Ss(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next((e=>{const t=[];return Ae.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{var r,i,s;t.push((r=e,i=n?new _e(n.sequenceNumber,new Te(ji(n.readTime),new me(Qe(n.documentKey)),n.largestBatchId)):_e.empty(),s=r.fields.map((([e,t])=>new we(ge.fromServerFormat(e),t))),new pe(r.indexId,r.collectionGroup,s,i)))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!=n?n:ae(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=Es(e),i=Ss(e);return this.yn(e).next((e=>r.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>Ae.forEach(t,(t=>i.put(Wi(t.indexId,this.uid,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return Ae.forEach(t,((t,r)=>{var i=n.get(t.collectionGroup);return(i?Ae.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),Ae.forEach(i,(n=>this.wn(e,t,n).next((t=>{var i=this.Sn(r,n);return t.isEqual(i)?Ae.resolve():this.bn(e,r,n,t,i)})))))))}))}Dn(e,t,n,r){return Ts(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,r){return Ts(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){const r=Ts(e);let i=new Dt(cs);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},((e,r)=>{i=i.add(new us(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}Sn(e,t){let n=new Dt(cs);var r=this.Vn(t,e);if(null==r)return n;const i=ye(t);if(null!=i){var s=e.data.field(i.fieldPath);if(Zt(s))for(const i of s.arrayValue.values||[])n=n.add(new us(t.indexId,e.key,this.dn(i),r))}else n=n.add(new us(t.indexId,e.key,_s,r));return n}bn(e,t,n,r,i){j("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){var s=e.getIterator(),a=t.getIterator();let o=Ct(s),u=Ct(a);for(;o||u;){let e=!1,t=!1;if(o&&u){const r=n(o,u);r<0?t=!0:0<r&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(u),u=Ct(a)):t?(i(o),o=Ct(s)):(o=Ct(s),u=Ct(a))}}(r,i,cs,(r=>{s.push(this.Dn(e,t,n,r))}),(r=>{s.push(this.vn(e,t,n,r))})),Ae.waitFor(s)}yn(e){let t=1;return Ss(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>cs(e,t))).filter(((e,t,n)=>!t||0!==cs(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=cs(i,e),s=cs(i,t);if(0===n)r[0]=e.Zt();else if(0<n&&s<0)r.push(i),r.push(i.Zt());else if(0<s)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2){if(this.Cn(r[e],r[e+1]))return[];const t=[r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,_s,[]],n=[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,_s,[]];i.push(IDBKeyRange.bound(t,n))}return i}Cn(e,t){return 0<cs(e,t)}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(xs)}getMinOffset(e,t){return Ae.mapArray(this.hn(t),(t=>this.Pn(e,t).next((e=>e||$())))).next(xs)}}function Is(e){return _t(e,"collectionParents")}function Ts(e){return _t(e,"indexEntries")}function Es(e){return _t(e,"indexConfiguration")}function Ss(e){return _t(e,"indexState")}function xs(e){Q(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let i=1;i<e.length;i++){var r=e[i].indexState.offset;Ee(r,t)<0&&(t=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new Te(t.readTime,t.documentKey,n)}const Ds={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class As{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new As(e,As.DEFAULT_COLLECTION_PERCENTILE,As.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Cs(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId);let o=0;const u=r.J({range:a},((e,t,n)=>(o++,n.delete())));s.push(u.next((()=>{Q(1===o)})));const c=[];for(const e of n.mutations){const r=Je(t,e.key.path,n.batchId);s.push(i.delete(r)),c.push(e.key)}return Ae.waitFor(s).next((()=>c))}function Ns(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw $();t=e.noDocument}return JSON.stringify(t).length}As.DEFAULT_COLLECTION_PERCENTILE=10,As.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,As.DEFAULT=new As(41943040,As.DEFAULT_COLLECTION_PERCENTILE,As.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),As.DISABLED=new As(-1,0,0);class ks{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Fn={}}static lt(e,t,n,r){Q(""!==e.uid);var i=e.isAuthenticated()?e.uid:"";return new ks(i,t,n,r)}checkEmpty(e){let t=!0;var n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Os(e).J({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=Ms(e),s=Os(e);return s.add({}).next((a=>{Q("number"==typeof a);const o=new qr(a,t,n,r),u=(h=this.serializer,l=this.userId,f=(d=o).baseMutations.map((e=>Di(h.ct,e))),g=d.mutations.map((e=>Di(h.ct,e))),{userId:l,batchId:d.batchId,localWriteTimeMs:d.localWriteTime.toMillis(),baseMutations:f,mutations:g}),c=[];var h,l,d,f,g;let m=new Dt(((e,t)=>ae(e.canonicalString(),t.canonicalString())));for(const e of r){const t=Je(this.userId,e.key.path,a);m=m.add(e.key.path.popLast()),c.push(s.put(u)),c.push(i.put(t,Ye))}return m.forEach((t=>{c.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Fn[a]=o.keys()})),Ae.waitFor(c).next((()=>o))}))}lookupMutationBatch(e,t){return Os(e).get(t).next((e=>e?(Q(e.userId===this.userId),Ki(this.serializer,e)):null))}Mn(e,t){return this.Fn[t]?Ae.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){var n=e.keys();return this.Fn[t]=n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Os(e).J({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(Q(t.batchId>=n),i=Ki(this.serializer,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Os(e).J({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Os(e).U("userMutationsIndex",t).next((e=>e.map((e=>Ki(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=We(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return Ms(e).J({range:r},((n,r,s)=>{var[a,o,u]=n,o=Qe(o);if(a===this.userId&&t.path.isEqual(o))return Os(e).get(u).next((e=>{if(!e)throw $();Q(e.userId===this.userId),i.push(Ki(this.serializer,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Dt(ae);const r=[];return t.forEach((t=>{var i=We(this.userId,t.path);i=IDBKeyRange.lowerBound(i),i=Ms(e).J({range:i},((e,r,i)=>{var[s,a,o]=e,a=Qe(a);s===this.userId&&t.path.isEqual(a)?n=n.add(o):i.done()})),r.push(i)})),Ae.waitFor(r).next((()=>this.xn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=We(this.userId,n),s=IDBKeyRange.lowerBound(i);let a=new Dt(ae);return Ms(e).J({range:s},((e,t,i)=>{var[s,o,u]=e,o=Qe(o);s===this.userId&&n.isPrefixOf(o)?o.length===r&&(a=a.add(u)):i.done()})).next((()=>this.xn(e,a)))}xn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(Os(e).get(t).next((e=>{if(null===e)throw $();Q(e.userId===this.userId),n.push(Ki(this.serializer,e))})))})),Ae.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return Cs(e._e,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.On(t.batchId)})),Ae.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return Ae.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return Ms(e).J({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Qe(e[1]);r.push(t)}else n.done()})).next((()=>{Q(0===r.length)}))}))}containsKey(e,t){return Rs(e,this.userId,t)}Nn(e){return Ls(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function Rs(e,t,n){const r=We(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let a=!1;return Ms(e).J({range:s,H:!0},((e,n,r)=>{var[s,o]=e;s===t&&o===i&&(a=!0),r.done()})).next((()=>a))}function Os(e){return _t(e,"mutations")}function Ms(e){return _t(e,"documentMutations")}function Ls(e){return _t(e,"mutationQueues")}class Fs{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Fs(0)}static kn(){return new Fs(-1)}}class Vs{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next((t=>{const n=new Fs(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.qn(e).next((e=>he.fromTimestamp(new ce(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.qn(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.qn(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Qn(e,r))))}addTargetData(e,t){return this.Kn(e,t).next((()=>this.qn(e).next((n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Ps(e).delete(t.targetId))).next((()=>this.qn(e))).next((t=>(Q(0<t.targetCount),--t.targetCount,this.Qn(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return Ps(e).J(((s,a)=>{var o=Gi(a);o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r++,i.push(this.removeTargetData(e,o)))})).next((()=>Ae.waitFor(i))).next((()=>r))}forEachTarget(e,t){return Ps(e).J(((e,n)=>{var r=Gi(n);t(r)}))}qn(e){return Us(e).get("targetGlobalKey").next((e=>(Q(null!==e),e)))}Qn(e,t){return Us(e).put("targetGlobalKey",t)}Kn(e,t){return Ps(e).put(zi(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next((e=>e.targetCount))}getTargetData(e,t){var n=Ln(t);n=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let r=null;return Ps(e).J({range:n,index:"queryTargetsIndex"},((e,n,i)=>{var s=Gi(n);Fn(t,s.target)&&(r=s,i.done())})).next((()=>r))}addMatchingKeys(e,t,n){const r=[],i=Bs(e);return t.forEach((t=>{var s=ze(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),Ae.waitFor(r)}removeMatchingKeys(e,t,n){const r=Bs(e);return Ae.forEach(t,(t=>{var i=ze(t.path);return Ae.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=Bs(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Bs(e);let i=hr();return r.J({range:n,H:!0},((e,t,n)=>{var r=Qe(e[1]);r=new me(r),i=i.add(r)})).next((()=>i))}containsKey(e,t){var n=ze(t.path);n=IDBKeyRange.bound([n],[ue(n)],!1,!0);let r=0;return Bs(e).J({index:"documentTargetsIndex",H:!0,range:n},(([e],t,n)=>{0!==e&&(r++,n.done())})).next((()=>0<r))}ot(e,t){return Ps(e).get(t).next((e=>e?Gi(e):null))}}function Ps(e){return _t(e,"targets")}function Us(e){return _t(e,"targetGlobal")}function Bs(e){return _t(e,"targetDocuments")}function qs([e,t],[n,r]){var i=ae(e,n);return 0===i?ae(t,r):i}class js{constructor(e){this.Un=e,this.buffer=new Dt(qs),this.Wn=0}Gn(){return++this.Wn}zn(e){var t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();qs(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Ks{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return null!==this.jn}Hn(e){j("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Me(e)?j("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await De(e)}await this.Hn(3e5)}))}}class Gs{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Ae.resolve(qe.oe);const n=new js(t);return this.Jn.forEachTarget(e,(e=>n.zn(e.sequenceNumber))).next((()=>this.Jn.Zn(e,(e=>n.zn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(j("LruGarbageCollector","Garbage collection skipped; disabled"),Ae.resolve(Ds)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(j("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ds):this.Xn(e,t)))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,i,s,a,o,u,c;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(i=t>this.params.maximumSequenceNumbersToCollect?(j("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),this.params.maximumSequenceNumbersToCollect):t,a=Date.now(),this.nthSequenceNumber(e,i)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(s=t,u=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),q()<=r.DEBUG&&j("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-h}ms\n\tDetermined least recently used ${i} in `+(o-a)+"ms\n"+`\tRemoved ${s} targets in `+(u-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-u)+"ms\n"+`Total Duration: ${c-h}ms`),Ae.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e}))))}}class zs{constructor(e,t){this.db=e,this.garbageCollector=new Gs(e=this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}er(e){let t=0;return this.Zn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,((e,n)=>t(n)))}addReference(e,t,n){return $s(e,n)}removeReference(e,t,n){return $s(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return $s(e,t)}nr(e,t){let n=!1;return Ls(e).Y((r=>Rs(e,r,t).next((e=>(e&&(n=!0),Ae.resolve(!e)))))).next((()=>n))}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.tr(e,((s,a)=>{if(a<=t){const t=this.nr(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,he.min()),Bs(e).delete(function(e){return[0,ze(e.path)]}(s)))))}));r.push(t)}})).next((()=>Ae.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return $s(e,t)}tr(e,t){const n=Bs(e);let r,i=qe.oe;return n.J({index:"documentTargetsIndex"},(([e],{path:n,sequenceNumber:s})=>{0===e?(i!==qe.oe&&t(new me(Qe(r)),i),i=s,r=n):i=qe.oe})).next((()=>{i!==qe.oe&&t(new me(Qe(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function $s(e,t){return Bs(e).put((e=e.currentSequenceNumber,{targetId:0,path:ze(t.path),sequenceNumber:e}))}class Qs{constructor(){this.changes=new nr((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ln.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?Ae.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Hs{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Xs(e).put(n)}removeEntry(e,t,n){return Xs(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Bi(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.rr(e,n))))}getEntry(e,t){let n=ln.newInvalidDocument(t);return Xs(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Zs(t))},((e,r)=>{n=this.ir(t,r)})).next((()=>n))}sr(e,t){let n={size:0,document:ln.newInvalidDocument(t)};return Xs(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(Zs(t))},((e,r)=>{n={document:this.ir(t,r),size:Ns(r)}})).next((()=>n))}getEntries(e,t){let n=rr;return this._r(e,t,((e,t)=>{var r=this.ir(e,t);n=n.insert(e,r)})).next((()=>n))}ar(e,t){let n=rr,r=new Et(me.comparator);return this._r(e,t,((e,t)=>{var i=this.ir(e,t);n=n.insert(e,i),r=r.insert(e,Ns(t))})).next((()=>({documents:n,ur:r})))}_r(e,t,n){if(t.isEmpty())return Ae.resolve();let r=new Dt(ta);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(Zs(r.first()),Zs(r.last())),s=r.getIterator();let a=s.getNext();return Xs(e).J({index:"documentKeyIndex",range:i},((e,t,r)=>{for(var i=me.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);a&&ta(a,i)<0;)n(a,null),a=s.getNext();a&&a.isEqual(i)&&(n(a,t),a=s.hasNext()?s.getNext():null),a?r.$(Zs(a)):r.done()})).next((()=>{for(;a;)n(a,null),a=s.hasNext()?s.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r,i){const s=t.path,a=[s.popLast().toArray(),s.lastSegment(),Bi(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Xs(e).U(IDBKeyRange.bound(a,o,!0)).next((e=>{null==i||i.incrementDocumentReadCount(e.length);let n=rr;for(const i of e){const e=this.ir(me.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(Zn(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=rr;var s=ea(t,n),a=ea(t,Te.max());return Xs(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,a,!0)},((e,t,n)=>{var s=this.ir(me.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new Js(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return Ys(e).get("remoteDocumentGlobalKey").next((e=>(Q(!!e),e)))}rr(e,t){return Ys(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const e=function(e,t){let n;if(t.document)n=xi(e.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=me.fromSegments(t.noDocument.path),r=ji(t.noDocument.readTime);n=ln.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return $();{const e=me.fromSegments(t.unknownDocument.path),r=ji(t.unknownDocument.version);n=ln.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime((t=t.readTime,r=new ce(t[0],t[1]),he.fromTimestamp(r))),n;var r}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(he.min()))return e}return ln.newInvalidDocument(e)}}function Ws(e){return new Hs(e)}class Js extends Qs{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new nr((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new Dt(((e,t)=>ae(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{var a=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,a.readTime)),s.isValidDocument()){var o=Ui(this.cr.serializer,s);r=r.add(i.path.popLast());var u=Ns(o);n+=u-a.size,t.push(this.cr.addEntry(e,i,o))}else if(n-=a.size,this.trackRemovals){const n=Ui(this.cr.serializer,s.convertToNoDocument(he.min()));t.push(this.cr.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.cr.updateMetadata(e,n)),Ae.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next((e=>(this.lr.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.cr.ar(e,t).next((({documents:e,ur:t})=>(t.forEach(((t,n)=>{this.lr.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function Ys(e){return _t(e,"remoteDocumentGlobal")}function Xs(e){return _t(e,"remoteDocumentsV14")}function Zs(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function ea(e,t){const n=t.documentKey.path.toArray();return[e,Bi(t.readTime),n.slice(0,n.length-2),0<n.length?n[n.length-1]:""]}function ta(e,t){var n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=ae(n[e],r[e]),i)return i;return i=ae(n.length,r.length),i||(i=ae(n[n.length-2],r[r.length-2]),i||ae(n[n.length-1],r[r.length-1]))}class na{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ra{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Rr(n.mutation,e,Nt.empty(),ce.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,hr()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=hr()){const r=or();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=sr();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=or();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,hr())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=rr;const s=or(),a=or();return t.forEach(((e,t)=>{const a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof Lr)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),Rr(a.mutation,t,a.mutation.getFieldMask(),ce.now())):s.set(t.key,Nt.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return a.set(e,new na(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),a)))}recalculateAndSaveOverlays(e,t){const n=or();let r=new Et(((e,t)=>e-t)),i=hr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{var s,a=t.get(e);null!==a&&(s=n.get(e)||Nt.empty(),s=i.applyToLocalView(a,s),n.set(e,s),s=(r.get(i.batchId)||hr()).add(e),r=r.insert(i.batchId,s))}))})).next((()=>{const s=[],a=r.getReverseIterator();for(;a.hasNext();){const r=a.getNext(),o=r.key,u=r.value,c=or();u.forEach((e=>{var r;i.has(e)||(null!==(r=Nr(t.get(e),n.get(e)))&&c.set(e,r),i=i.add(e))})),s.push(this.documentOverlayCache.saveOverlays(e,o,c))}return Ae.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return i=t,me.isDocumentKey(i.path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):zn(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r);var i}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=0<r-i.size?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Ae.resolve(or());let a=-1,o=i;return s.next((t=>Ae.forEach(t,((t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?Ae.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{o=o.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,o,t,hr()))).next((e=>({batchId:a,changes:ar(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new me(t)).next((e=>{let t=sr();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=sr();return this.indexManager.getCollectionParents(e,i).next((a=>Ae.forEach(a,(a=>{var o,u=(o=t,a=a.child(i),new qn(a,null,o.explicitOrderBy.slice(),o.filters.slice(),o.limit,o.limitType,o.startAt,o.endAt));return this.getDocumentsMatchingCollectionQuery(e,u,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{var r=n.getKey();null===e.get(r)&&(e=e.insert(r,ln.newInvalidDocument(r)))}));let n=sr();return e.forEach(((e,r)=>{var s=i.get(e);void 0!==s&&Rr(s.mutation,r,Nt.empty(),ce.now()),Zn(t,r)&&(n=n.insert(e,r))})),n}))}}class ia{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return Ae.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:t.id,version:t.version,createTime:mi(t.createTime)}),Ae.resolve()}getNamedQuery(e,t){return Ae.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:t.name,query:$i(t.bundledQuery),readTime:mi(t.readTime)}),Ae.resolve()}}class sa{constructor(){this.overlays=new Et(me.comparator),this.Ir=new Map}getOverlay(e,t){return Ae.resolve(this.overlays.get(t))}getOverlays(e,t){const n=or();return Ae.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),Ae.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Ir.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.Ir.delete(n)),Ae.resolve()}getOverlaysForCollection(e,t,n){const r=or(),i=t.length+1,s=new me(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Ae.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new Et(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=or(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=or(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach(((e,t)=>a.set(e,t))),!(a.size()>=r)););return Ae.resolve(a)}ht(e,t,n){var r=this.overlays.get(n.key);if(null!==r){const e=this.Ir.get(r.largestBatchId).delete(n.key);this.Ir.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Kr(t,n));let i=this.Ir.get(t);void 0===i&&(i=hr(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}class aa{constructor(){this.sessionToken=Rt.EMPTY_BYTE_STRING}getSessionToken(e){return Ae.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Ae.resolve()}}class oa{constructor(){this.Tr=new Dt(ua.Er),this.dr=new Dt(ua.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){var n=new ua(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Vr(new ua(e,t))}mr(e,t){e.forEach((e=>this.removeReference(e,t)))}gr(e){const t=new me(new de([])),n=new ua(t,e),r=new ua(t,e+1),i=[];return this.dr.forEachInRange([n,r],(e=>{this.Vr(e),i.push(e.key)})),i}pr(){this.Tr.forEach((e=>this.Vr(e)))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){var t=new me(new de([])),n=new ua(t,e);t=new ua(t,e+1);let r=hr();return this.dr.forEachInRange([n,t],(e=>{r=r.add(e.key)})),r}containsKey(e){var t=new ua(e,0);return null!==(t=this.Tr.firstAfterOrEqual(t))&&e.isEqual(t.key)}}class ua{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return me.comparator(e.key,t.key)||ae(e.wr,t.wr)}static Ar(e,t){return ae(e.wr,t.wr)||me.comparator(e.key,t.key)}}class ca{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Dt(ua.Er)}checkEmpty(e){return Ae.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){var i=this.Sr;this.Sr++,0<this.mutationQueue.length&&this.mutationQueue[this.mutationQueue.length-1];var s=new qr(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.br=this.br.add(new ua(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Ae.resolve(s)}lookupMutationBatch(e,t){return Ae.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){var n=(n=this.vr(t+1))<0?0:n;return Ae.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return Ae.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return Ae.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new ua(t,0),r=new ua(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,r],(e=>{var t=this.Dr(e.wr);i.push(t)})),Ae.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Dt(ae);return t.forEach((e=>{var t=new ua(e,0),r=new ua(e,Number.POSITIVE_INFINITY);this.br.forEachInRange([t,r],(e=>{n=n.add(e.wr)}))})),Ae.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;me.isDocumentKey(i)||(i=i.child(""));var s=new ua(new me(i),0);let a=new Dt(ae);return this.br.forEachWhile((e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.wr)),!0)}),s),Ae.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach((e=>{var n=this.Dr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Q(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return Ae.forEach(t.mutations,(r=>{var i=new ua(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.br=n}))}On(e){}containsKey(e,t){var n=new ua(t,0);return n=this.br.firstAfterOrEqual(n),Ae.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ae.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){var t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ha{constructor(e){this.Mr=e,this.docs=new Et(me.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Ae.resolve(n?n.document.mutableCopy():ln.newInvalidDocument(t))}getEntries(e,t){let n=rr;return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ln.newInvalidDocument(e))})),Ae.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=rr;const s=t.path,a=new me(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||Ee(Ie(a),n)<=0||(r.has(a.key)||Zn(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return Ae.resolve(i)}getAllFromCollectionGroup(e,t,n,r){$()}Or(e,t){return Ae.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new la(this)}getSize(e){return Ae.resolve(this.size)}}class la extends Qs{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(n)})),Ae.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class da{constructor(e){this.persistence=e,this.Nr=new nr((e=>Ln(e)),Fn),this.lastRemoteSnapshotVersion=he.min(),this.highestTargetId=0,this.Lr=0,this.Br=new oa,this.targetCount=0,this.kr=Fs.Bn()}forEachTarget(e,t){return this.Nr.forEach(((e,n)=>t(n))),Ae.resolve()}getLastRemoteSnapshotVersion(e){return Ae.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ae.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),Ae.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),Ae.resolve()}Kn(e){this.Nr.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.kr=new Fs(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,Ae.resolve()}updateTargetData(e,t){return this.Kn(t),Ae.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),--this.targetCount,Ae.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Nr.forEach(((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Nr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)})),Ae.waitFor(i).next((()=>r))}getTargetCount(e){return Ae.resolve(this.targetCount)}getTargetData(e,t){var n=this.Nr.get(t)||null;return Ae.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),Ae.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),Ae.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),Ae.resolve()}getMatchingKeysForTargetId(e,t){var n=this.Br.yr(t);return Ae.resolve(n)}containsKey(e,t){return Ae.resolve(this.Br.containsKey(t))}}class fa{constructor(e,t){this.qr={},this.overlays={},this.Qr=new qe(0),this.Kr=!1,this.Kr=!0,this.$r=new aa,this.referenceDelegate=e(this),this.Ur=new da(this),this.indexManager=new vs,this.remoteDocumentCache=new ha(e=e=>this.referenceDelegate.Wr(e)),this.serializer=new Pi(t),this.Gr=new ia(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sa,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new ca(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){j("MemoryPersistence","Starting transaction:",e);const r=new ga(this.Qr.next());return this.referenceDelegate.zr(),n(r).next((e=>this.referenceDelegate.jr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Hr(e,t){return Ae.or(Object.values(this.qr).map((n=>()=>n.containsKey(e,t))))}}class ga extends xe{constructor(e){super(),this.currentSequenceNumber=e}}class ma{constructor(e){this.persistence=e,this.Jr=new oa,this.Yr=null}static Zr(e){return new ma(e)}get Xr(){if(this.Yr)return this.Yr;throw $()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),Ae.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),Ae.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),Ae.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach((e=>this.Xr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Xr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ae.forEach(this.Xr,(n=>{const r=me.fromPath(n);return this.ei(e,r).next((e=>{e||t.removeEntry(r,he.min())}))})).next((()=>(this.Yr=null,t.apply(e))))}updateLimboDocument(e,t){return this.ei(e,t).next((e=>{e?this.Xr.delete(t.toString()):this.Xr.add(t.toString())}))}Wr(e){return 0}ei(e,t){return Ae.or([()=>Ae.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class pa{constructor(e){this.serializer=e}O(e,t,n,r){const i=new Ce("createOrUpgrade",t);var s;n<1&&1<=r&&(e.createObjectStore("owner"),(s=e).createObjectStore("mutationQueues",{keyPath:"userId"}),s.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",He,{unique:!0}),s.createObjectStore("documentMutations"),ya(e),e.createObjectStore("remoteDocuments"));let a=Ae.resolve();return n<3&&3<=r&&(0!==n&&((s=e).deleteObjectStore("targetDocuments"),s.deleteObjectStore("targets"),s.deleteObjectStore("targetGlobal"),ya(e)),a=a.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:he.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&4<=r&&(0!==n&&(a=a.next((()=>function(e,t){return t.store("mutations").U().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",He,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return Ae.waitFor(i)}))}(e,i)))),a=a.next((()=>{e.createObjectStore("clientMetadata",{keyPath:"clientId"})}))),n<5&&5<=r&&(a=a.next((()=>this.ni(i)))),n<6&&6<=r&&(a=a.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i))))),n<7&&7<=r&&(a=a.next((()=>this.ii(i)))),n<8&&8<=r&&(a=a.next((()=>this.si(e,i)))),n<9&&9<=r&&(a=a.next((()=>{var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}))),n<10&&10<=r&&(a=a.next((()=>this.oi(i)))),n<11&&11<=r&&(a=a.next((()=>{e.createObjectStore("bundles",{keyPath:"bundleId"}),e.createObjectStore("namedQueries",{keyPath:"name"})}))),n<12&&12<=r&&(a=a.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:ct});t.createIndex("collectionPathOverlayIndex",ht,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",lt,{unique:!1})}(e)}))),n<13&&13<=r&&(a=a.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:Xe});t.createIndex("documentKeyIndex",Ze),t.createIndex("collectionGroupIndex",et)}(e))).next((()=>this._i(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&14<=r&&(a=a.next((()=>this.ai(e,i)))),n<15&&15<=r&&(a=a.next((()=>function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:st}).createIndex("sequenceNumberIndex",at,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:ot}).createIndex("documentKeyIndex",ut,{unique:!1})}(e)))),n<16&&16<=r&&(a=a.next((()=>{t.objectStore("indexState").clear()})).next((()=>{t.objectStore("indexEntries").clear()}))),n<17&&17<=r&&(a=a.next((()=>{e.createObjectStore("globals",{keyPath:"name"})}))),a}ri(e){let t=0;return e.store("remoteDocuments").J(((e,n)=>{t+=Ns(n)})).next((()=>{var n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}ni(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next((t=>Ae.forEach(t,(t=>{var r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",r).next((n=>Ae.forEach(n,(n=>{Q(n.userId===t.userId);var r=Ki(this.serializer,n);return Cs(e,t.userId,r).next((()=>{}))}))))}))))}ii(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.J(((n,i)=>{const s=new de(n),a=[0,ze(s)];r.push(t.get(a).next((n=>n?Ae.resolve():(n=>t.put({targetId:0,path:ze(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>Ae.waitFor(r)))}))}si(e,t){e.createObjectStore("collectionParents",{keyPath:it});const n=t.store("collectionParents"),r=new ws,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:ze(r)})}};return t.store("remoteDocuments").J({H:!0},((e,t)=>{const n=new de(e);return i(n.popLast())})).next((()=>t.store("documentMutations").J({H:!0},(([,e],t)=>{const n=Qe(e);return i(n.popLast())}))))}oi(e){const t=e.store("targets");return t.J(((e,n)=>{var r=Gi(n);return r=zi(this.serializer,r),t.put(r)}))}_i(e,t){const n=t.store("remoteDocuments"),r=[];return n.J(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=((o=n).document?new me(de.fromString(o.document.name).popFirst(5)):o.noDocument?me.fromSegments(o.noDocument.path):o.unknownDocument?me.fromSegments(o.unknownDocument.path):$()).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};var o;r.push(i.put(a))})).next((()=>Ae.waitFor(r)))}ai(e,t){const n=t.store("mutations"),r=Ws(this.serializer),i=new fa(ma.Zr,this.serializer.ct);return n.U().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:hr();Ki(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),Ae.forEach(n,((e,n)=>{var s=new P(n),a=Zi.lt(this.serializer,s),o=i.getIndexManager(s);return s=ks.lt(s,this.serializer,o,i.referenceDelegate),new ra(r,s,a,o).recalculateAndSaveOverlaysForDocumentKeys(new wt(t,qe.oe),e).next()}))}))}}function ya(e){e.createObjectStore("targetDocuments",{keyPath:nt}).createIndex("documentTargetsIndex",rt,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",tt,{unique:!0}),e.createObjectStore("targetGlobal")}const va="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class wa{constructor(e,t,n,r,i,s,a,o,u,c,h=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=i,this.window=s,this.document=a,this.ci=u,this.li=c,this.hi=h,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=e=>Promise.resolve(),!wa.D())throw new W(H.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new zs(this,r),this.Ai=t+"main",this.serializer=new Pi(o),this.Ri=new Ne(this.Ai,this.hi,new pa(this.serializer)),this.$r=new ts,this.Ur=new Vs(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Ws(this.serializer),this.Gr=new Ji,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,!1===c&&K("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new W(H.FAILED_PRECONDITION,va);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Ur.getHighestSequenceNumber(e)))})).then((e=>{this.Qr=new qe(e,this.ci)})).then((()=>{this.Kr=!0})).catch((e=>(this.Ri&&this.Ri.close(),Promise.reject(e))))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget((async()=>{this.started&&await this.mi()})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>ba(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.wi(e).next((e=>{e||(this.isPrimary=!1,this.ui.enqueueRetryable((()=>this.di(!1))))}))})).next((()=>this.Si(e))).next((t=>this.isPrimary&&!t?this.bi(e).next((()=>!1)):!!t&&this.Di(e).next((()=>!0)))))).catch((e=>{if(Me(e))return j("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return j("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.ui.enqueueRetryable((()=>this.di(e))),this.isPrimary=e}))}wi(e){return _a(e).get("owner").next((e=>Ae.resolve(this.vi(e))))}Ci(e){return ba(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=_t(e,"clientMetadata");return t.U().next((e=>{const n=this.xi(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return Ae.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.mi().then((()=>this.Fi())).then((()=>this.pi()))))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?Ae.resolve(!0):_a(e).get("owner").next((t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new W(H.FAILED_PRECONDITION,va);return!1}}return!(!this.networkEnabled||!this.inForeground)||ba(e).U().next((e=>void 0===this.xi(e,5e3).find((e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&j("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new wt(e,qe.oe);return this.bi(t).next((()=>this.Ci(t)))})),this.Ri.close(),this.qi()}xi(e,t){return e.filter((e=>this.Mi(e.updateTimeMs,t)&&!this.Ni(e.clientId)))}Qi(){return this.runTransaction("getActiveClients","readonly",(e=>ba(e).U().next((e=>this.xi(e,18e5).map((e=>e.clientId))))))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return ks.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new bs(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Zi.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){j("IndexedDbPersistence","Starting transaction:",e);var r,i="readonly"===t?"readonly":"readwrite",s=17===(r=this.hi)?vt:16===r?yt:15===r?pt:14===r?mt:13===r?gt:12===r?ft:11===r?dt:void $();let a;return this.Ri.runTransaction(e,i,s,(r=>(a=new wt(r,this.Qr?this.Qr.next():qe.oe),"readwrite-primary"===t?this.wi(a).next((e=>!!e||this.Si(a))).next((t=>{if(!t)throw K(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable((()=>this.di(!1))),new W(H.FAILED_PRECONDITION,Se);return n(a)})).next((e=>this.Di(a).next((()=>e)))):this.Ki(a).next((()=>n(a)))))).then((e=>(a.raiseOnCommittedEvent(),e)))}Ki(e){return _a(e).get("owner").next((e=>{if(null!==e&&this.Mi(e.leaseTimestampMs,5e3)&&!this.Ni(e.ownerId)&&!this.vi(e)&&!(this.li||this.allowTabSynchronization&&e.allowTabSynchronization))throw new W(H.FAILED_PRECONDITION,va)}))}Di(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return _a(e).put("owner",t)}static D(){return Ne.D()}bi(e){const t=_a(e);return t.get("owner").next((e=>this.vi(e)?(j("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):Ae.resolve()))}Mi(e,t){var n=Date.now();return!(e<n-t||n<e&&(K(`Detected an update time that is in the future: ${e} > ${n}`),1))}fi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ii=()=>{this.ui.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.mi())))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground="visible"===this.document.visibilityState)}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Pi=()=>{this.Li();var e=/(?:Version|Mobile)\/1[456]/;l()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{var n=null!==(null===(t=this.Vi)||void 0===t?void 0:t.getItem(this.Oi(e)));return j("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return K("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){K("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch(e){}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function _a(e){return _t(e,"owner")}function ba(e){return _t(e,"clientMetadata")}function Ia(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Ta{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=r}static Wi(e,t){let n=hr(),r=hr();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Ta(e,t.fromCache,n,r)}}class Ea{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Sa{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=l()?8:0<ke(h())?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.Yi(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.Zi(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(!i.result){const n=new Ea;return this.Xi(e,t,n).next((r=>{if(i.result=r,this.zi)return this.es(e,t,n,r.size)}))}})).next((()=>i.result))}es(e,t,n,i){return n.documentReadCount<this.ji?(q()<=r.DEBUG&&j("QueryEngine","SDK will not create cache indexes for query:",Xn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),Ae.resolve()):(q()<=r.DEBUG&&j("QueryEngine","Query:",Xn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(q()<=r.DEBUG&&j("QueryEngine","The SDK decides to create cache indexes for query:",Xn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Qn(t))):Ae.resolve())}Yi(e,t){if(Gn(t))return Ae.resolve(null);let n=Qn(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Wn(t,null,"F"),n=Qn(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=hr(...r);return this.Ji.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{var s=this.ts(t,r);return this.ns(t,s,i,n.readTime)?this.Yi(e,Wn(t,null,"F")):this.rs(e,s,t,n)}))))})))))}Zi(e,t,n,i){return Gn(t)||i.isEqual(he.min())?Ae.resolve(null):this.Ji.getDocuments(e,n).next((s=>{var a=this.ts(t,s);return this.ns(t,a,n,i)?Ae.resolve(null):(q()<=r.DEBUG&&j("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Xn(t)),this.rs(e,a,t,be(i,-1)).next((e=>e)))}))}ts(e,t){let n=new Dt(tr(e));return t.forEach(((t,r)=>{Zn(e,r)&&(n=n.add(r))})),n}ns(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||0<i.version.compareTo(r))}Xi(e,t,n){return q()<=r.DEBUG&&j("QueryEngine","Using full collection scan to execute query:",Xn(t)),this.Ji.getDocumentsMatchingQuery(e,t,Te.min(),n)}rs(e,t,n,r){return this.Ji.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class xa{constructor(e,t,n,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new Et(ae),this._s=new nr((e=>Ln(e)),Fn),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ra(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.os)))}}function Da(e,t,n,r){return new xa(e,t,n,r)}async function Aa(e,t){const n=e;return n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.ls(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let a=hr();for(const e of r){i.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return n.localDocuments.getDocuments(e,a).next((e=>({hs:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Ca(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Ur.getLastRemoteSnapshotVersion(e)))}function Na(e,t,n){let r=hr(),i=hr();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=rr;return n.forEach(((n,s)=>{const a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(he.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||0<s.version.compareTo(a.version)||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):j("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),{Ps:r,Is:i}}))}function ka(e,t){const n=e;return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Ur.getTargetData(e,t).next((i=>i?(r=i,Ae.resolve(r)):n.Ur.allocateTargetId(e).next((i=>(r=new Vi(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Ur.addTargetData(e,r).next((()=>r)))))))})).then((e=>{var r=n.os.get(e.targetId);return(null===r||0<e.snapshotVersion.compareTo(r.snapshotVersion))&&(n.os=n.os.insert(e.targetId,e),n._s.set(t,e.targetId)),e}))}async function Ra(e,t,n){const r=e,i=r.os.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!Me(e))throw e;j("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.os=r.os.remove(t),r._s.delete(i.target)}function Oa(e,t,n){const r=e;let i=he.min(),s=hr();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=e,i=r._s.get(n);return void 0!==i?Ae.resolve(r.os.get(i)):r.Ur.getTargetData(t,n)}(r,e,Qn(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.ss.getDocumentsMatchingQuery(e,t,n?i:he.min(),n?s:hr()))).next((e=>(Fa(r,er(t),e),{documents:e,Ts:s})))))}function Ma(e,t){const n=e,r=n.Ur,i=n.os.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.ot(e,t).next((e=>e?e.target:null))))}function La(e,t){const n=e,r=n.us.get(t)||he.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.cs.getAllFromCollectionGroup(e,t,be(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>(Fa(n,t,e),e)))}function Fa(e,t,n){let r=e.us.get(t)||he.min();n.forEach(((e,t)=>{0<t.readTime.compareTo(r)&&(r=t.readTime)})),e.us.set(t,r)}function Va(e,t){return`firestore_clients_${e}_${t}`}function Pa(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Ua(e,t){return`firestore_targets_${e}_${t}`}class Ba{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Rs(e,t,n){var r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new W(r.error.code,r.error.message))),s?new Ba(e,t,r.state,i):(K("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class qa{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){var n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new W(n.error.code,n.error.message))),i?new qa(e,n.state,r):(K("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ja{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=lr;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=Ge(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new ja(e,i):(K("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Ka{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Ka(t.clientId,t.onlineState):(K("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Ga{constructor(){this.activeTargetIds=lr}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class za{constructor(e,t,n,r,i){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Et(ae),this.started=!1,this.bs=[];var s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=Va(this.persistenceKey,this.ps),this.vs=`firestore_sequence_number_${this.persistenceKey}`,this.Ss=this.Ss.insert(this.ps,new Ga),this.Cs=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.xs=`firestore_online_state_${this.persistenceKey}`,this.Os=`firestore_bundle_loaded_v2_${this.persistenceKey}`,this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const n of e)if(n!==this.ps){const e=this.getItem(Va(this.persistenceKey,n));var t;!e||(t=ja.Rs(n,e))&&(this.Ss=this.Ss.insert(t.clientId,t))}this.Ns();const n=this.storage.getItem(this.xs);if(n){const e=this.Ls(n);e&&this.Bs(e)}for(const e of this.bs)this.ws(e);this.bs=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){const t=this.storage.getItem(Ua(this.persistenceKey,e));var r;!t||(r=qa.Rs(e,t))&&(n=r.state)}return t&&this.Ks.fs(e),this.Ns(),n}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Ua(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Qs(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return j("SharedClientState","READ",e,t),t}setItem(e,t){j("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){j("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;t.storageArea===this.storage&&(j("SharedClientState","EVENT",t.key,t.newValue),t.key!==this.Ds?this.ui.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.Cs.test(t.key)){if(null==t.newValue){var e=this.Gs(t.key);return this.zs(e,null)}if(e=this.js(t.key,t.newValue))return this.zs(e.clientId,e)}else if(this.Fs.test(t.key)){if(null!==t.newValue){var n=this.Hs(t.key,t.newValue);if(n)return this.Js(n)}}else if(this.Ms.test(t.key)){if(null!==t.newValue&&(n=this.Ys(t.key,t.newValue)))return this.Zs(n)}else if(t.key===this.xs){if(null!==t.newValue){var r=this.Ls(t.newValue);if(r)return this.Bs(r)}}else if(t.key===this.vs)r=function(e){let t=qe.oe;if(null!=e)try{var n=JSON.parse(e);Q("number"==typeof n),t=n}catch(e){K("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue),r!==qe.oe&&this.sequenceNumberHandler(r);else if(t.key===this.Os){const e=this.Xs(t.newValue);await Promise.all(e.map((e=>this.syncEngine.eo(e))))}}else this.bs.push(t)})):K("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){const r=new Ba(this.currentUser,e,t,n),i=Pa(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Vs())}Qs(e){var t=Pa(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){var t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,n){const r=Ua(this.persistenceKey,e),i=new qa(e,t,n);this.setItem(r,i.Vs())}Ws(e){var t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){var t=this.Cs.exec(e);return t?t[1]:null}js(e,t){var n=this.Gs(e);return ja.Rs(n,t)}Hs(e,t){var n=this.Fs.exec(e),r=Number(n[1]);return n=void 0!==n[2]?n[2]:null,Ba.Rs(new P(n),r,t)}Ys(e,t){var n=this.Ms.exec(e);return n=Number(n[1]),qa.Rs(n,t)}Ls(e){return Ka.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);j("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const n=t?this.Ss.insert(e,t):this.Ss.remove(e),r=this.ks(this.Ss),i=this.ks(n),s=[],a=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||a.push(e)})),this.syncEngine.io(s,a).then((()=>{this.Ss=n}))}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=lr;return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class $a{constructor(){this.so=new Ga,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Ga,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Qa{_o(e){}shutdown(){}}class Ha{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){j("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){j("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Wa=null;function Ja(){return null===Wa?Wa=268435456+Math.round(2147483648*Math.random()):Wa++,"0x"+Wa.toString(16)}const Ya={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Xa{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const Za="WebChannelConnection";class eo extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Do=t+"://"+e.host,this.vo=`projects/${n}/databases/${r}`,this.Co="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get Fo(){return!1}Mo(e,t,n,r,i){const s=Ja(),a=this.xo(e,t.toUriEncodedString());j("RestConnection",`Sending RPC '${e}' ${s}:`,a,n);var o={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(o,r,i),this.No(e,a,o,n).then((t=>(j("RestConnection",`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw G("RestConnection",`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t}))}Lo(e,t,n,r,i,s){return this.Mo(e,t,n,r,i)}Oo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+U,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}xo(e,t){var n=Ya[e];return`${this.Do}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,r){const i=Ja();return new Promise(((s,a)=>{const o=new x;o.setWithCredentials(!0),o.listenOnce(A.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case C.NO_ERROR:var t=o.getResponseJson();j(Za,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case C.TIMEOUT:j(Za,`RPC '${e}' ${i} timed out`),a(new W(H.DEADLINE_EXCEEDED,"Request time out"));break;case C.HTTP_ERROR:var n=o.getStatus();if(j(Za,`RPC '${e}' ${i} failed with status:`,n,"response text:",o.getResponseText()),0<n){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);var r=null==e?void 0:e.error;if(r&&r.status&&r.message){const e=(u=r.status.toLowerCase().replace(/_/g,"-"),0<=Object.values(H).indexOf(u)?u:H.UNKNOWN);a(new W(e,r.message))}else a(new W(H.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new W(H.UNAVAILABLE,"Connection failed."));break;default:$()}}finally{j(Za,`RPC '${e}' ${i} completed.`)}var u}));var u=JSON.stringify(r);j(Za,`RPC '${e}' ${i} sending request:`,r),o.send(t,"POST",u,n,15)}))}Bo(e,t,n){const r=Ja(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=O(),a=R(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(o.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Oo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;var c=i.join("");j(Za,`Creating RPC '${e}' stream ${r}: ${c}`,o);const h=s.createWebChannel(c,o);let l=!1,d=!1;const f=new Xa({Io:t=>{d?j(Za,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(l||(j(Za,`Opening RPC '${e}' stream ${r} transport.`),h.open(),l=!0),j(Za,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},To:()=>h.close()}),g=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return g(h,D.EventType.OPEN,(()=>{d||(j(Za,`RPC '${e}' stream ${r} transport opened.`),f.yo())})),g(h,D.EventType.CLOSE,(()=>{d||(d=!0,j(Za,`RPC '${e}' stream ${r} transport closed`),f.So())})),g(h,D.EventType.ERROR,(t=>{d||(d=!0,G(Za,`RPC '${e}' stream ${r} transport errored:`,t),f.So(new W(H.UNAVAILABLE,"The operation could not be completed")))})),g(h,D.EventType.MESSAGE,(t=>{if(!d){var n=t.data[0];Q(!!n);var i=n.error||(null===(i=n[0])||void 0===i?void 0:i.error);if(i){j(Za,`RPC '${e}' stream ${r} received error:`,i);const t=i.status;let n=function(e){var t=M[e];if(void 0!==t)return $r(t)}(t),s=i.message;void 0===n&&(n=H.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),d=!0,f.So(new W(n,s)),h.close()}else j(Za,`RPC '${e}' stream ${r} received:`,n),f.bo(n)}})),g(a,k.STAT_EVENT,(t=>{t.stat===N.PROXY?j(Za,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===N.NOPROXY&&j(Za,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.wo()}),0),f}}function to(){return"undefined"!=typeof window?window:null}function no(){return"undefined"!=typeof document?document:null}function ro(e){return new li(e,!0)}class io{constructor(e,t,n=1e3,r=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=r,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();var t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-n);0<r&&j("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,(()=>(this.Uo=Date.now(),e()))),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class so{constructor(e,t,n,r,i,s,a,o){this.ui=e,this.Ho=n,this.Jo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new io(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,(()=>this.__())))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==e?this.t_.reset():t&&t.code===H.RESOURCE_EXHAUSTED?(K(t.toString()),K("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===H.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Yo===t&&this.P_(e,n)}),(t=>{e((()=>{var e=new W(H.UNKNOWN,"Fetching auth token failed: "+t.message);return this.I_(e)}))}))}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo((()=>{n((()=>this.listener.Eo()))})),this.stream.Ro((()=>{n((()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,(()=>(this.r_()&&(this.state=3),Promise.resolve()))),this.listener.Ro())))})),this.stream.mo((e=>{n((()=>this.I_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.e_?this.E_(e):this.onNext(e)))}))}i_(){this.state=5,this.t_.Go((async()=>{this.state=0,this.start()}))}I_(e){return j("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget((()=>this.Yo===e?t():(j("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ao extends so{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(f=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:$(),i=t.targetChange.targetIds||[],s=(f=t.targetChange.resumeToken,e.useProto3Json?(Q(void 0===f||"string"==typeof f),Rt.fromBase64String(f||"")):(Q(void 0===f||f instanceof Buffer||f instanceof Uint8Array),Rt.fromUint8Array(f||new Uint8Array))),a=t.targetChange.cause,o=a&&(o=void 0===(f=a).code?H.UNKNOWN:$r(f.code),new W(o,f.message||""));n=new ri(r,i,s,o||null)}else if("documentChange"in t){t.documentChange,(h=t.documentChange).document,h.document.name,h.document.updateTime,s=_i(e,h.document.name),o=mi(h.document.updateTime);var u=h.document.createTime?mi(h.document.createTime):he.min(),c=new hn({mapValue:{fields:h.document.fields}}),h=(u=ln.newFoundDocument(s,o,u,c),c=h.targetIds||[],h.removedTargetIds||[]);n=new ti(c,h,u.key,u)}else if("documentDelete"in t)t.documentDelete,(c=t.documentDelete).document,h=_i(e,c.document),u=c.readTime?mi(c.readTime):he.min(),u=ln.newNoDocument(h,u),c=c.removedTargetIds||[],n=new ti([],c,u.key,u);else if("documentRemove"in t){t.documentRemove,(d=t.documentRemove).document;var l=_i(e,d.document),d=d.removedTargetIds||[];n=new ti([],d,l,null)}else{if(!("filter"in t))return $();{t.filter;const e=t.filter;e.targetId;var{count:d=0,unchangedNames:l}=e;d=new Gr(d,l),l=e.targetId,n=new ni(l,d)}}var f;return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return he.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?he.min():mi(t.readTime)}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=Ti(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Vn(r)?{documents:Ci(e,r)}:{query:Ni(e,r)._t},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()){n.resumeToken=gi(e,t.resumeToken);const r=di(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(0<t.snapshotVersion.compareTo(he.min())){n.readTime=fi(e,t.snapshotVersion.toTimestamp());const r=di(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);var n=(this.serializer,null==(n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $()}}(e.purpose))?null:{"goog-listen-tags":n});n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=Ti(this.serializer),t.removeTarget=e,this.a_(t)}}class oo extends so{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get V_(){return 0<this.e_}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return Q(!!e.streamToken),this.lastStreamToken=e.streamToken,Q(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){Q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();var t,n,r=(t=e.writeResults,n=e.commitTime,t&&0<t.length?(Q(void 0!==n),t.map((e=>function(e,t){let n=e.updateTime?mi(e.updateTime):mi(t);return n.isEqual(he.min())&&(n=mi(t)),new xr(n,e.transformResults||[])}(e,n)))):[]),i=mi(e.commitTime);return this.listener.g_(i,r)}p_(){const e={};e.database=Ti(this.serializer),this.a_(e)}m_(e){var t={streamToken:this.lastStreamToken,writes:e.map((e=>Di(this.serializer,e)))};this.a_(t)}}class uo extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new W(H.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.Mo(e,yi(t,n),r,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===H.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new W(H.UNKNOWN,e.toString())}))}Lo(e,t,n,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,a])=>this.connection.Lo(e,yi(t,n),r,s,a,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===H.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new W(H.UNKNOWN,e.toString())}))}terminate(){this.y_=!0,this.connection.terminate()}}class co{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve()))))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,1<=this.S_&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){var t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(K(t),this.D_=!1):j("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class ho{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o((e=>{n.enqueueAndForget((async()=>{_o(this)&&(j("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.L_.add(4),await fo(t),t.q_.set("Unknown"),t.L_.delete(4),await lo(t)}(this))}))})),this.q_=new co(n,r)}}async function lo(e){if(_o(e))for(const t of e.B_)await t(!0)}async function fo(e){for(const t of e.B_)await t(!1)}function go(e,t){const n=e;n.N_.has(t.targetId)||(n.N_.set(t.targetId,t),wo(n)?vo(n):No(n).r_()&&po(n,t))}function mo(e,t){const n=e,r=No(n);n.N_.delete(t),r.r_()&&yo(n,t),0===n.N_.size&&(r.r_()?r.o_():_o(n)&&n.q_.set("Unknown"))}function po(e,t){var n;e.Q_.xe(t.targetId),(0<t.resumeToken.approximateByteSize()||0<t.snapshotVersion.compareTo(he.min()))&&(n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size,t=t.withExpectedCount(n)),No(e).A_(t)}function yo(e,t){e.Q_.xe(t),No(e).R_(t)}function vo(e){e.Q_=new si({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.N_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),No(e).start(),e.q_.v_()}function wo(e){return _o(e)&&!No(e).n_()&&0<e.N_.size}function _o(e){return 0===e.L_.size}function bo(e){e.Q_=void 0}async function Io(e,t,n){if(!Me(t))throw t;e.L_.add(1),await fo(e),e.q_.set("Offline"),n=n||(()=>Ca(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{j("RemoteStore","Retrying IndexedDB access"),await n(),e.L_.delete(1),await lo(e)}))}function To(e,t){return t().catch((n=>Io(e,n,t)))}async function Eo(e){const t=e,n=ko(t);let r=0<t.O_.length?t.O_[t.O_.length-1].batchId:-1;for(;_o(i=t)&&i.O_.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}(t.localStore,r);if(null===e){0===t.O_.length&&n.o_();break}r=e.batchId,function(e,t){e.O_.push(t);const n=ko(e);n.r_()&&n.V_&&n.m_(t.mutations)}(t,e)}catch(e){await Io(t,e)}var i;So(t)&&xo(t)}function So(e){return _o(e)&&!ko(e).n_()&&0<e.O_.length}function xo(e){ko(e).start()}async function Do(e,t){t&&ko(e).V_&&await async function(e,t){if(zr(n=t.code)&&n!==H.ABORTED){const n=e.O_.shift();ko(e).s_(),await To(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Eo(e)}var n}(e,t),So(e)&&xo(e)}async function Ao(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),j("RemoteStore","RemoteStore received new credentials");var r=_o(n);n.L_.add(3),await fo(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.L_.delete(3),await lo(n)}async function Co(e,t){const n=e;t?(n.L_.delete(2),await lo(n)):(n.L_.add(2),await fo(n),n.q_.set("Unknown"))}function No(e){return e.K_||(e.K_=function(e,t,n){const r=e;return r.w_(),new ao(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:async function(e){e.q_.set("Online")}.bind(null,e),Ro:async function(e){e.N_.forEach(((t,n)=>{po(e,t)}))}.bind(null,e),mo:async function(e,t){bo(e),wo(e)?(e.q_.M_(t),vo(e)):e.q_.set("Unknown")}.bind(null,e),d_:async function(e,t,n){if(e.q_.set("Online"),t instanceof ri&&2===t.state&&t.cause)try{await async function(e,t){var n=t.cause;for(const r of t.targetIds)e.N_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.N_.delete(r),e.Q_.removeTarget(r))}(e,t)}catch(n){j("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Io(e,n)}else if(t instanceof ti?e.Q_.Ke(t):t instanceof ni?e.Q_.He(t):e.Q_.We(t),!n.isEqual(he.min()))try{const t=await Ca(e.localStore);0<=n.compareTo(t)&&await function(e,t){const n=e.Q_.rt(t);return n.targetChanges.forEach(((n,r)=>{if(0<n.resumeToken.approximateByteSize()){const i=e.N_.get(r);i&&e.N_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.N_.get(t);var i;r&&(e.N_.set(t,r.withResumeToken(Rt.EMPTY_BYTE_STRING,r.snapshotVersion)),yo(e,t),i=new Vi(r.target,t,n,r.sequenceNumber),po(e,i))})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){j("RemoteStore","Failed to raise snapshot:",t),await Io(e,t)}}.bind(null,e)}),e.B_.push((async t=>{t?(e.K_.s_(),wo(e)?vo(e):e.q_.set("Unknown")):(await e.K_.stop(),bo(e))}))),e.K_}function ko(e){return e.U_||(e.U_=function(e,t,n){const r=e;return r.w_(),new oo(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:()=>Promise.resolve(),Ro:async function(e){ko(e).p_()}.bind(null,e),mo:Do.bind(null,e),f_:async function(e){const t=ko(e);for(const n of e.O_)t.m_(n.mutations)}.bind(null,e),g_:async function(e,t,n){const r=e.O_.shift(),i=jr.from(r,t,n);await To(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Eo(e)}.bind(null,e)}),e.B_.push((async t=>{t?(e.U_.s_(),await Eo(e)):(await e.U_.stop(),0<e.O_.length&&(j("RemoteStore",`Stopping write stream with ${e.O_.length} pending writes`),e.O_=[]))}))),e.U_}class Ro{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new J,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,a=new Ro(e,t,s,r,i);return a.start(n),a}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new W(H.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Oo(e,t){if(K("AsyncQueue",`${t}: ${e}`),Me(e))return new W(H.UNAVAILABLE,`${t}: ${e}`);throw e}class Mo{constructor(e){this.comparator=e?(t,n)=>e(t,n)||me.comparator(t.key,n.key):(e,t)=>me.comparator(e.key,t.key),this.keyedMap=sr(),this.sortedSet=new Et(this.comparator)}static emptySet(e){return new Mo(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Mo))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Mo;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Lo{constructor(){this.W_=new Et(me.comparator)}track(e){var t=e.doc.key,n=this.W_.get(t);!n||0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):$()}G_(){const e=[];return this.W_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Fo{constructor(e,t,n,r,i,s,a,o,u){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=u}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new Fo(e,t,Mo.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Jn(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Vo{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some((e=>e.J_()))}}class Po{constructor(){this.queries=Uo(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(e,t){const n=e,r=n.queries;n.queries=Uo(),r.forEach(((e,n)=>{for(const e of n.j_)e.onError(t)}))}(this,new W(H.ABORTED,"Firestore shutting down"))}}function Uo(){return new nr((e=>Yn(e)),Jn)}async function Bo(e,t){const n=e;let r=3;var i=t.query;let s=n.queries.get(i);s?!s.H_()&&t.J_()&&(r=2):(s=new Vo,r=t.J_()?0:1);try{switch(r){case 0:s.z_=await n.onListen(i,!0);break;case 1:s.z_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=Oo(e,`Initialization of query '${Xn(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,s),s.j_.push(t),t.Z_(n.onlineState),!s.z_||t.X_(s.z_)&&jo(n)}async function qo(e,t){const n=e,r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.j_.indexOf(t);0<=e&&(s.j_.splice(e,1),0===s.j_.length?i=t.J_()?0:1:!s.H_()&&t.J_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function jo(e){e.Y_.forEach((e=>{e.next()}))}(L=L||{}).ea="default",L.Cache="cache";class Ko{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Fo(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){return!e.fromCache||!this.J_()||(!this.options._a||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){if(0<e.docChanges.length)return!0;var t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}oa(e){e=Fo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==L.Cache}}class Go{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}class zo{constructor(e){this.serializer=e}Es(e){return _i(this.serializer,e)}ds(e){return e.metadata.exists?xi(this.serializer,e.document,!1):ln.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return mi(e)}}class $o{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Qo(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const n=de.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,n=new zo(this.serializer);for(const i of e)if(i.metadata.queries){const e=n.Es(i.metadata.name);for(const n of i.metadata.queries){var r=(t.get(n)||hr()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=e;let s=hr(),a=rr;for(const e of n){const n=t.Es(e.metadata.name);e.document&&(s=s.add(n));const r=t.ds(e);r.setReadTime(t.As(e.metadata.readTime)),a=a.insert(n,r)}const o=i.cs.newChangeBuffer({trackRemovals:!0}),u=await ka(i,Qn(Kn(de.fromString(`__bundle__/docs/${r}`))));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>Na(e,o,a).next((t=>(o.apply(e),t))).next((t=>i.Ur.removeMatchingKeysForTargetId(e,u.targetId).next((()=>i.Ur.addMatchingKeys(e,s,u.targetId))).next((()=>i.localDocuments.getLocalViewOfDocuments(e,t.Ps,t.Is))).next((()=>t.Ps))))))}(this.localStore,new zo(this.serializer),this.documents,this.ca.id),t=this.ha(this.documents);for(const e of this.queries)await async function(e,t,n=hr()){const r=await ka(e,Qn($i(t.bundledQuery))),i=e;return i.persistence.runTransaction("Save named query","readwrite",(e=>{var s=mi(t.readTime);return 0<=r.snapshotVersion.compareTo(s)?i.Gr.saveNamedQuery(e,t):(s=r.withResumeToken(Rt.EMPTY_BYTE_STRING,s),i.os=i.os.insert(s.targetId,s),i.Ur.updateTargetData(e,s).next((()=>i.Ur.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.Ur.addMatchingKeys(e,n,r.targetId))).next((()=>i.Gr.saveNamedQuery(e,t))))}))}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function Qo(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Ho{constructor(e){this.key=e}}class Wo{constructor(e){this.key=e}}class Jo{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=hr(),this.mutatedKeys=hr(),this.Aa=tr(e),this.Ra=new Mo(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new Lo,r=(t||this).Ra;let i=(t||this).mutatedKeys,s=r,a=!1;const o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,u="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const c=r.get(e),h=Zn(this.query,t)?t:null,l=!!c&&this.mutatedKeys.has(c.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;c&&h?c.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.ga(c,h)||(n.track({type:2,doc:h}),f=!0,(o&&0<this.Aa(h,o)||u&&this.Aa(h,u)<0)&&(a=!0)):!c&&h?(n.track({type:0,doc:h}),f=!0):c&&!h&&(n.track({type:1,doc:c}),f=!0,(o||u)&&(a=!0)),f&&(i=h?(s=s.add(h),d?i.add(e):i.delete(e)):(s=s.delete(e),i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ra:s,fa:n,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){var i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const s=e.fa.G_();s.sort(((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $()}};return n(e)-n(t)}(e.type,t.type)||this.Aa(e.doc,t.doc))),this.pa(n),r=null!=r&&r;var a=t&&!r?this.ya():[],o=0===this.da.size&&this.current&&!r?1:0,u=o!==this.Ea;return this.Ea=o,0!==s.length||u?{snapshot:new Fo(this.query,e.Ra,i,s,e.mutatedKeys,0==o,u,!1,!!n&&0<n.resumeToken.approximateByteSize()),wa:a}:{wa:a}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Lo,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach((e=>this.Ta=this.Ta.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Ta=this.Ta.delete(e))),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=hr(),this.Ra.forEach((e=>{this.Sa(e.key)&&(this.da=this.da.add(e.key))}));const t=[];return e.forEach((e=>{this.da.has(e)||t.push(new Wo(e))})),this.da.forEach((n=>{e.has(n)||t.push(new Ho(n))})),t}ba(e){this.Ta=e.Ts,this.da=hr();var t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return Fo.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class Yo{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Xo{constructor(e){this.key=e,this.va=!1}}class Zo{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Ca={},this.Fa=new nr((e=>Yn(e)),Jn),this.Ma=new Map,this.xa=new Set,this.Oa=new Et(me.comparator),this.Na=new Map,this.La=new oa,this.Ba={},this.ka=new Map,this.qa=Fs.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}async function eu(e,t,n,r){var i=await ka(e.localStore,Qn(t)),s=i.targetId,a=e.sharedClientState.addLocalQueryTarget(s,n);let o;return r&&(o=await tu(e,t,s,"current"===a,i.resumeToken)),e.isPrimaryClient&&n&&go(e.remoteStore,i),o}async function tu(e,t,n,r,i){e.Ka=(t,n,r)=>async function(e,t,n,r){let i=t.view.ma(n);i.ns&&(i=await Oa(e.localStore,t.query,!1).then((({documents:e})=>t.view.ma(e,i))));var s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId);return a=t.view.applyChanges(i,e.isPrimaryClient,s,a),cu(e,t.targetId,a.wa),a.snapshot}(e,t,n,r);const s=await Oa(e.localStore,t,!0),a=new Jo(t,s.Ts),o=a.ma(s.documents),u=ei.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),c=a.applyChanges(o,e.isPrimaryClient,u);cu(e,n,c.wa);var h=new Yo(t,n,a);return e.Fa.set(t,h),e.Ma.has(n)?e.Ma.get(n).push(t):e.Ma.set(n,[t]),c.snapshot}async function nu(e,t){const n=e;try{const e=await function(e,t){const n=e,r=t.snapshotVersion;let i=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.cs.newChangeBuffer({trackRemovals:!0});i=n.os;const a=[];t.targetChanges.forEach(((s,o)=>{const u=i.get(o);if(u){a.push(n.Ur.removeMatchingKeys(e,s.removedDocuments,o).next((()=>n.Ur.addMatchingKeys(e,s.addedDocuments,o))));let d=u.withSequenceNumber(e.currentSequenceNumber);var c,h,l;null!==t.targetMismatches.get(o)?d=d.withResumeToken(Rt.EMPTY_BYTE_STRING,he.min()).withLastLimboFreeSnapshotVersion(he.min()):0<s.resumeToken.approximateByteSize()&&(d=d.withResumeToken(s.resumeToken,r)),i=i.insert(o,d),h=d,l=s,0!==(c=u).resumeToken.approximateByteSize()&&!(3e8<=h.snapshotVersion.toMicroseconds()-c.snapshotVersion.toMicroseconds()||0<l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size)||a.push(n.Ur.updateTargetData(e,d))}}));let o=rr,u=hr();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),a.push(Na(e,s,t.documentUpdates).next((e=>{o=e.Ps,u=e.Is}))),!r.isEqual(he.min())){const t=n.Ur.getLastRemoteSnapshotVersion(e).next((t=>n.Ur.setTargetsMetadata(e,e.currentSequenceNumber,r)));a.push(t)}return Ae.waitFor(a).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,o,u))).next((()=>o))})).then((e=>(n.os=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Na.get(t);r&&(Q(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?r.va=!0:0<e.modifiedDocuments.size?Q(r.va):0<e.removedDocuments.size&&(Q(r.va),r.va=!1))})),await lu(n,e,t)}catch(e){await De(e)}}function ru(e,t,n){const r=e;if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Fa.forEach(((n,r)=>{var i=r.view.Z_(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=e;n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.j_)e.Z_(t)&&(r=!0)})),r&&jo(n)}(r.eventManager,t),e.length&&r.Ca.d_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function iu(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let a=Ae.resolve();return s.forEach((e=>{a=a.next((()=>r.getEntry(t,e))).next((t=>{var s=n.docVersions.get(e);Q(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),a.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=hr();for(let n=0;n<e.mutationResults.length;++n)0<e.mutationResults[n].transformResults.length&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);au(n,r,null),su(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await lu(n,e)}catch(e){await De(e)}}function su(e,t){(e.ka.get(t)||[]).forEach((e=>{e.resolve()})),e.ka.delete(t)}function au(e,t,n){const r=e;let i=r.Ba[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ba[r.currentUser.toKey()]=i}}function ou(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Ma.get(t))e.Fa.delete(r),n&&e.Ca.$a(r,n);e.Ma.delete(t),e.isPrimaryClient&&e.La.gr(t).forEach((t=>{e.La.containsKey(t)||uu(e,t)}))}function uu(e,t){e.xa.delete(t.path.canonicalString());var n=e.Oa.get(t);null!==n&&(mo(e.remoteStore,n),e.Oa=e.Oa.remove(t),e.Na.delete(n),hu(e))}function cu(e,t,n){for(const r of n)r instanceof Ho?(e.La.addReference(r.key,t),function(e,t){const n=t.key,r=n.path.canonicalString();e.Oa.get(n)||e.xa.has(r)||(j("SyncEngine","New document in limbo: "+n),e.xa.add(r),hu(e))}(e,r)):r instanceof Wo?(j("SyncEngine","Document no longer in limbo: "+r.key),e.La.removeReference(r.key,t),e.La.containsKey(r.key)||uu(e,r.key)):$()}function hu(e){for(;0<e.xa.size&&e.Oa.size<e.maxConcurrentLimboResolutions;){var t=e.xa.values().next().value;e.xa.delete(t);var n=new me(de.fromString(t));t=e.qa.next(),e.Na.set(t,new Xo(n)),e.Oa=e.Oa.insert(n,t),go(e.remoteStore,new Vi(Qn(Kn(n.path)),t,"TargetPurposeLimboResolution",qe.oe))}}async function lu(e,t,n){const r=e,i=[],s=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach(((e,o)=>{a.push(r.Ka(o,t,n).then((e=>{var t;if((e||n)&&r.isPrimaryClient){const i=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(o.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(o.targetId,i?"current":"not-current")}if(e){i.push(e);const t=Ta.Wi(o.targetId,e);s.push(t)}})))})),await Promise.all(a),r.Ca.d_(i),await async function(e,t){const n=e;try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Ae.forEach(t,(t=>Ae.forEach(t.$i,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Ae.forEach(t.Ui,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Me(e))throw e;j("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.os.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.os=n.os.insert(t,i)}}}(r.localStore,s))}async function du(e,t){const n=e,r=[],i=[];for(const e of t){let t;const c=n.Ma.get(e);if(c&&0!==c.length){t=await ka(n.localStore,Qn(c[0]));for(const e of c){const t=n.Fa.get(e),r=(s=n,a=t,u=void 0,u=await Oa((o=s).localStore,a.query,!0),u=a.view.ba(u),o.isPrimaryClient&&cu(o,a.targetId,u.wa),await u);r.snapshot&&i.push(r.snapshot)}}else{const r=await Ma(n.localStore,e);t=await ka(n.localStore,r),await tu(n,fu(r),e,!1,t.resumeToken)}r.push(t)}var s,a,o,u;return n.Ca.d_(i),r}function fu(e){return jn(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function gu(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=nu.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(e,t){const n=e,r=n.Na.get(t);if(r&&r.va)return hr().add(r.key);{let e=hr();const r=n.Ma.get(t);if(!r)return e;for(const t of r){const r=n.Fa.get(t);e=e.unionWith(r.view.Va)}return e}}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Na.get(t),s=i&&i.key;if(s){let e=new Et(me.comparator);e=e.insert(s,ln.newNoDocument(s,he.min()));const n=hr().add(s),i=new Zr(he.min(),new Map,new Et(ae),e,n);await nu(r,i),r.Oa=r.Oa.remove(s),r.Na.delete(t),hu(r)}else await Ra(r.localStore,t,!1).then((()=>ou(r,t,n))).catch(De)}.bind(null,t),t.Ca.d_=function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.j_)t.X_(e)&&(r=!0);i.z_=e}}r&&jo(n)}.bind(null,t.eventManager),t.Ca.$a=function(e,t,n){const r=e,i=r.queries.get(t);if(i)for(const e of i.j_)e.onError(n);r.queries.delete(t)}.bind(null,t.eventManager),t}function mu(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=iu.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=async function(e,t,n){const r=e;try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(Q(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);au(r,t,n),su(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await lu(r,e)}catch(n){await De(n)}}.bind(null,t),t}class pu{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ro(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return Da(this.persistence,new Sa,e.initialUser,this.serializer)}Ga(e){return new fa(ma.Zr,this.serializer)}Wa(e){return new $a}async terminate(){var e;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}pu.provider={build:()=>new pu};class yu extends pu{constructor(e,t,n){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await mu(this.Ja.syncEngine),await Eo(this.Ja.remoteStore),await this.persistence.yi((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}za(e){return Da(this.persistence,new Sa,e.initialUser,this.serializer)}ja(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new Ks(n,e.asyncQueue,t)}Ha(e,t){var n=new Be(t,this.persistence);return new Ue(e.asyncQueue,n)}Ga(e){var t=Ia(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?As.withCacheSize(this.cacheSizeBytes):As.DEFAULT;return new wa(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,to(),no(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new $a}}class vu extends yu{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);var t=this.Ja.syncEngine;this.sharedClientState instanceof za&&(this.sharedClientState.syncEngine={no:async function(e,t,n,r){var i=e,s=await function(e,t){const n=e,r=n.mutationQueue;return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.Mn(e,t).next((t=>t?n.localDocuments.getDocuments(e,t):Ae.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await Eo(i.remoteStore):"acknowledged"===n||"rejected"===n?(au(i,t,r||null),su(i,t),i.localStore.mutationQueue.On(t)):$(),await lu(i,s)):j("SyncEngine","Cannot apply mutation batch with id: "+t)}.bind(null,t),ro:async function(e,t,n,r){const i=e;if(i.Qa)j("SyncEngine","Ignoring unexpected query state notification.");else{var s=i.Ma.get(t);if(s&&0<s.length)switch(n){case"current":case"not-current":{const e=await La(i.localStore,er(s[0])),r=Zr.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,Rt.EMPTY_BYTE_STRING);await lu(i,e,r);break}case"rejected":await Ra(i.localStore,t,!0),ou(i,t,r);break;default:$()}}}.bind(null,t),io:async function(e,t,n){const r=gu(e);if(r.Qa){for(const e of t)if(r.Ma.has(e)&&r.sharedClientState.isActiveQueryTarget(e))j("SyncEngine","Adding an already active target "+e);else{const t=await Ma(r.localStore,e),n=await ka(r.localStore,t);await tu(r,fu(t),n.targetId,!1,n.resumeToken),go(r.remoteStore,n)}for(const e of n)r.Ma.has(e)&&await Ra(r.localStore,e,!1).then((()=>{mo(r.remoteStore,e),ou(r,e)})).catch(De)}}.bind(null,t),Qi:function(e){return e.localStore.persistence.Qi()}.bind(null,t),eo:async function(e,t){const n=e;return La(n.localStore,t).then((e=>lu(n,e)))}.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi((async e=>{await async function(e,t){const n=e;if(gu(n),mu(n),!0===t&&!0!==n.Qa){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await du(n,e.toArray());n.Qa=!0,await Co(n.remoteStore,!0);for(const e of t)go(n.remoteStore,e)}else if(!1===t&&!1!==n.Qa){const e=[];let t=Promise.resolve();n.Ma.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(ou(n,i),Ra(n.localStore,i,!0)))),mo(n.remoteStore,i)})),await t,await du(n,e),function(e){const t=e;t.Na.forEach(((e,n)=>{mo(t.remoteStore,n)})),t.La.pr(),t.Na=new Map,t.Oa=new Et(me.comparator)}(n),n.Qa=!1,await Co(n.remoteStore,!1)}}(this.Ja.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())}))}Wa(e){var t=to();if(!za.D(t))throw new W(H.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Ia(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new za(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class wu{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>ru(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=async function(e,t){const n=e;if(!n.currentUser.isEqual(t)){j("SyncEngine","User change. New user:",t.toKey());const r=await Aa(n.localStore,t);n.currentUser=t,"'waitForPendingWrites' promise is rejected due to a user change.",(e=n).ka.forEach((e=>{e.forEach((e=>{e.reject(new W(H.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.ka.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await lu(n,r.hs)}}.bind(null,this.syncEngine),await Co(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Po}createDatastore(e){var t,n,r,i=ro(e.databaseInfo.databaseId),s=(r=e.databaseInfo,new eo(r));return t=e.authCredentials,n=e.appCheckCredentials,new uo(t,n,r=s,e=i)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>ru(this.syncEngine,e,0),e=new(Ha.D()?Ha:Qa),new ho(t,n,r,i,e);var t,n,r,i}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){const o=new Zo(e,t,n,r,i,s);return a&&(o.Qa=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=e;j("RemoteStore","RemoteStore shutting down."),t.L_.add(5),await fo(t),t.k_.shutdown(),t.q_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(e=this.eventManager)||void 0===e||e.terminate()}}function _u(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){var r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}wu.provider={build:()=>new wu};class bu{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):K("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}class Iu{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new J,this.buffer=new Uint8Array,this.eu=new TextDecoder("utf-8"),this.tu().then((e=>{e&&e.ua()?this.metadata.resolve(e.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.aa)}`))}),(e=>this.metadata.reject(e)))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){var e=await this.nu();if(null===e)return null;var t=this.eu.decode(e),n=Number(t);return isNaN(n)&&this.ru(`length string (${t}) is not valid number`),t=await this.iu(n),new Go(JSON.parse(t),e.length+n)}su(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async nu(){for(;this.su()<0&&!await this.ou(););if(0===this.buffer.length)return null;var e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");var t=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){var e=await this.Xa.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class Tu{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw this.lastTransactionError=new W(H.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(e,t){const n=e,r={documents:t.map((e=>wi(n.serializer,e)))},i=await n.Lo("BatchGetDocuments",n.serializer.databaseId,de.emptyPath(),r,t.length),s=new Map;i.forEach((e=>{const t=(r=n.serializer,"found"in e?function(e,t){Q(!!t.found),t.found.name,t.found.updateTime;var n=_i(e,t.found.name),r=mi(t.found.updateTime),i=t.found.createTime?mi(t.found.createTime):he.min(),s=new hn({mapValue:{fields:t.found.fields}});return ln.newFoundDocument(n,r,i,s)}(r,e):"missing"in e?function(e,t){Q(!!t.missing),Q(!!t.readTime);var n=_i(e,t.missing),r=mi(t.readTime);return ln.newNoDocument(n,r)}(r,e):$());var r;s.set(t.key.toString(),t)}));const a=[];return t.forEach((e=>{var t=s.get(e.toString());Q(!!t),a.push(t)})),a}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ur(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{var n=me.fromPath(t);this.mutations.push(new Br(n,this.precondition(n)))})),await async function(e,t){const n=e,r={writes:t.map((e=>Di(n.serializer,e)))};await n.Mo("Commit",n.serializer.databaseId,de.emptyPath(),r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw $();t=he.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new W(H.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(he.min())?Dr.exists(!1):Dr.updateTime(t):Dr.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return Dr.exists(!0);if(t.isEqual(he.min()))throw new W(H.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Dr.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Eu{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this._u=n.maxAttempts,this.t_=new io(this.asyncQueue,"transaction_retry")}au(){--this._u,this.uu()}uu(){this.t_.Go((async()=>{const e=new Tu(this.datastore),t=this.cu(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.lu(e)}))))})).catch((e=>{this.lu(e)}))}))}cu(e){try{var t=this.updateFunction(e);return!je(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}lu(e){0<this._u&&this.hu(e)?(--this._u,this.asyncQueue.enqueueAndForget((()=>(this.uu(),Promise.resolve())))):this.deferred.reject(e)}hu(e){if("FirebaseError"!==e.name)return!1;var t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!zr(t)}}class Su{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=P.UNAUTHENTICATED,this.clientId=se.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async e=>{j("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(j("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new J;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){var t=Oo(n,"Failed to shutdown persistence");e.reject(t)}})),e.promise}}async function xu(e,t){e.asyncQueue.verifyOperationInProgress(),j("FirestoreClient","Initializing OfflineComponentProvider");var n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Aa(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function Du(e,t){e.asyncQueue.verifyOperationInProgress();var n=await Au(e);j("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Ao(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Ao(t.remoteStore,n))),e._onlineComponents=t}async function Au(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){j("FirestoreClient","Using user provided OfflineComponentProvider");try{await xu(e,e._uninitializedComponentsProvider._offline)}catch(r){var t=r;if(!("FirebaseError"===(n=t).name?n.code===H.FAILED_PRECONDITION||n.code===H.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code))throw t;G("Error using user provided cache. Falling back to memory cache: "+t),await xu(e,new pu)}}else j("FirestoreClient","Using default OfflineComponentProvider"),await xu(e,new pu);var n;return e._offlineComponents}async function Cu(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(j("FirestoreClient","Using user provided OnlineComponentProvider"),await Du(e,e._uninitializedComponentsProvider._online)):(j("FirestoreClient","Using default OnlineComponentProvider"),await Du(e,new wu))),e._onlineComponents}function Nu(e){return Au(e).then((e=>e.persistence))}function ku(e){return Au(e).then((e=>e.localStore))}function Ru(e){return Cu(e).then((e=>e.remoteStore))}function Ou(e){return Cu(e).then((e=>e.syncEngine))}async function Mu(e){const t=await Cu(e),n=t.eventManager;return n.onListen=async function(e,t,n=!0){const r=gu(e);let i;const s=r.Fa.get(t);return i=s?(r.sharedClientState.addLocalQueryTarget(s.targetId),s.view.Da()):await eu(r,t,n,!0),i}.bind(null,t.syncEngine),n.onUnlisten=async function(e,t,n){const r=e,i=r.Fa.get(t),s=r.Ma.get(i.targetId);if(1<s.length)return r.Ma.set(i.targetId,s.filter((e=>!Jn(e,t)))),void r.Fa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Ra(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&mo(r.remoteStore,i.targetId),ou(r,i.targetId)})).catch(De)):(ou(r,i.targetId),await Ra(r.localStore,i.targetId,!0))}.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=async function(e,t){await eu(gu(e),t,!0,!1)}.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=async function(e,t){const n=e,r=n.Fa.get(t),i=n.Ma.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),mo(n.remoteStore,r.targetId))}.bind(null,t.syncEngine),n}function Lu(e,t,n={}){const r=new J;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new bu({next:o=>{s.Za(),t.enqueueAndForget((()=>qo(e,a)));var u=o.docs.has(n);!u&&o.fromCache?i.reject(new W(H.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&o.fromCache&&r&&"server"===r.source?i.reject(new W(H.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new Ko(Kn(n.path),s,{includeMetadataChanges:!0,_a:!0});return Bo(e,a)}(await Mu(e),e.asyncQueue,t,n,r))),r.promise}function Fu(e,t,n={}){const r=new J;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new bu({next:n=>{s.Za(),t.enqueueAndForget((()=>qo(e,a))),n.fromCache&&"server"===r.source?i.reject(new W(H.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),a=new Ko(n,s,{includeMetadataChanges:!0,_a:!0});return Bo(e,a)}(await Mu(e),e.asyncQueue,t,n,r))),r.promise}function Vu(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Pu=new Map;function Uu(e,t,n){if(!n)throw new W(H.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Bu(e,t,n,r){if(!0===t&&!0===r)throw new W(H.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function qu(e){if(!me.isDocumentKey(e))throw new W(H.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function ju(e){if(me.isDocumentKey(e))throw new W(H.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Ku(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":$();if(e instanceof Array)return"an array";var t=e.constructor?e.constructor.name:null;return t?`a custom ${t} object`:"an object"}function Gu(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new W(H.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Ku(e);throw new W(H.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}function zu(e,t){if(t<=0)throw new W(H.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class $u{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new W(H.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new W(H.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Bu("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Vu(null!==(t=e.experimentalLongPollingOptions)&&void 0!==t?t:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new W(H.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new W(H.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(30<e.timeoutSeconds)throw new W(H.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,n}}class Qu{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $u({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new W(H.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new W(H.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $u(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new X;switch(e.type){case"firstParty":return new ne(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new W(H.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Pu.get(e);t&&(j("ComponentProvider","Removing Datastore"),Pu.delete(e),t.terminate())}(this),Promise.resolve()}}class Hu{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Hu(this.firestore,e,this._query)}}class Wu{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ju(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Wu(this.firestore,e,this._key)}}class Ju extends Hu{constructor(e,t,n){super(e,t,Kn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Wu(this.firestore,null,new me(e))}withConverter(e){return new Ju(this.firestore,e,this._path)}}function Yu(e,t,...n){if(e=y(e),Uu("collection","path",t),e instanceof Qu){var r=de.fromString(t,...n);return ju(r),new Ju(e,null,r)}if(!(e instanceof Wu||e instanceof Ju))throw new W(H.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return ju(r=e._path.child(de.fromString(t,...n))),new Ju(e.firestore,null,r)}function Xu(e,t,...n){if(e=y(e),Uu("doc","path",t=1===arguments.length?se.newId():t),e instanceof Qu){var r=de.fromString(t,...n);return qu(r),new Wu(e,null,new me(r))}if(!(e instanceof Wu||e instanceof Ju))throw new W(H.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return qu(r=e._path.child(de.fromString(t,...n))),new Wu(e.firestore,e instanceof Ju?e.converter:null,new me(r))}function Zu(e,t){return e=y(e),t=y(t),(e instanceof Wu||e instanceof Ju)&&(t instanceof Wu||t instanceof Ju)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function ec(e,t){return e=y(e),t=y(t),e instanceof Hu&&t instanceof Hu&&e.firestore===t.firestore&&Jn(e._query,t._query)&&e.converter===t.converter}class tc{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new io(this,"async_queue_retry"),this.Vu=()=>{var e=no();e&&j("AsyncQueue","Visibility state changed to "+e.visibilityState),this.t_.jo()},this.mu=e;const t=no();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=no();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise((()=>{}));const t=new J;return this.gu((()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Pu.push(e),this.pu())))}async pu(){if(0!==this.Pu.length){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Me(e))throw e;j("AsyncQueue","Operation failed with retryable error: "+e)}0<this.Pu.length&&this.t_.Go((()=>this.pu()))}}gu(e){var t=this.mu.then((()=>(this.du=!0,e().catch((e=>{throw this.Eu=e,this.du=!1,K("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e})).then((e=>(this.du=!1,e))))));return this.mu=t}enqueueAfterDelay(e,t,n){this.fu(),-1<this.Ru.indexOf(e)&&(t=0);var r=Ro.createAndSchedule(this,e,t,n,(e=>this.yu(e)));return this.Tu.push(r),r}fu(){this.Eu&&$()}verifyOperationInProgress(){}async wu(){for(var e;await(e=this.mu),e!==this.mu;);}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then((()=>{this.Tu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Tu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.wu()}))}Du(e){this.Ru.push(e)}yu(e){var t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function nc(e){return function(e,t){if("object"==typeof e&&null!==e){var n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return 1}}(e)}class rc{constructor(){this._progressObserver={},this._taskCompletionResolver=new J,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}var ic,sc,ac;class oc extends Qu{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new tc,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){var e;this._firestoreClient&&(e=this._firestoreClient.terminate(),this._queue=new tc(e),this._firestoreClient=void 0,await e)}}function uc(e){if(e._terminated)throw new W(H.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||cc(e),e._firestoreClient}function cc(e){var t,n,r,i,s,a,o=e._freezeSettings(),u=(r=e._databaseId,i=(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",s=e._persistenceKey,new Bt(r,i,s,(a=o).host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,Vu(a.experimentalLongPollingOptions),a.useFetchStreams));e._componentsProvider||null!==(t=o.localCache)&&void 0!==t&&t._offlineComponentProvider&&null!==(n=o.localCache)&&void 0!==n&&n._onlineComponentProvider&&(e._componentsProvider={_offline:o.localCache._offlineComponentProvider,_online:o.localCache._onlineComponentProvider}),e._firestoreClient=new Su(e._authCredentials,e._appCheckCredentials,e._queue,u,e._componentsProvider&&(u=null==(e=e._componentsProvider)?void 0:e._online.build(),{_offline:null==e?void 0:e._offline.build(u),_online:u}))}function hc(e,t,n){if((e=Gu(e,oc))._firestoreClient||e._terminated)throw new W(H.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new W(H.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},cc(e)}class lc{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lc(Rt.fromBase64String(e))}catch(e){throw new W(H.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new lc(Rt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class dc{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new W(H.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ge(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class fc{constructor(e){this._methodName=e}}class gc{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new W(H.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new W(H.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ae(this._lat,e._lat)||ae(this._long,e._long)}}class mc{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const pc=/^__.*__$/;class yc{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Lr(e,this.data,this.fieldMask,t,this.fieldTransforms):new Mr(e,this.data,t,this.fieldTransforms)}}class vc{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Lr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function wc(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw $()}}class _c{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new _c(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.Ou(e),r}Nu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Bc(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(0===e.length)throw this.Bu("Document fields must not be empty");if(wc(this.Cu)&&pc.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class bc{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||ro(e)}Qu(e,t,n,r=!1){return new _c({Cu:e,methodName:t,qu:n,path:ge.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ic(e){var t=e._freezeSettings(),n=ro(e._databaseId);return new bc(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Tc(e,t,n,r,i,s={}){const a=e.Qu(s.merge||s.mergeFields?2:0,t,n,i);Fc("Data must be an object, but it was:",a,r);var o=Mc(r,a);let u,c;if(s.merge)u=new Nt(a.fieldMask),c=a.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Vc(t,r,n);if(!a.contains(i))throw new W(H.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);qc(e,i)||e.push(i)}u=new Nt(e),c=a.fieldTransforms.filter((e=>u.covers(e.field)))}else u=null,c=a.fieldTransforms;return new yc(new hn(o),u,c)}class Ec extends fc{_toFieldTransform(e){if(2!==e.Cu)throw 1===e.Cu?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ec}}function Sc(e,t,n){return new _c({Cu:3,qu:t.settings.qu,methodName:e._methodName,xu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class xc extends fc{_toFieldTransform(e){return new Sr(e.path,new yr)}isEqual(e){return e instanceof xc}}class Dc extends fc{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Sc(this,e,!0),n=this.Ku.map((e=>Oc(e,t))),r=new vr(n);return new Sr(e.path,r)}isEqual(e){return e instanceof Dc&&m(this.Ku,e.Ku)}}class Ac extends fc{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Sc(this,e,!0),n=this.Ku.map((e=>Oc(e,t))),r=new _r(n);return new Sr(e.path,r)}isEqual(e){return e instanceof Ac&&m(this.Ku,e.Ku)}}class Cc extends fc{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){var t=new Ir(e.serializer,gr(e.serializer,this.$u));return new Sr(e.path,t)}isEqual(e){return e instanceof Cc&&this.$u===e.$u}}function Nc(e,t,n,r){const i=e.Qu(1,t,n);Fc("Data must be an object, but it was:",i,r);const s=[],a=hn.empty();It(r,((e,r)=>{var o=Uc(t,e,n);r=y(r);var u=i.Nu(o);if(r instanceof Ec)s.push(o);else{const e=Oc(r,u);null!=e&&(s.push(o),a.set(o,e))}}));var o=new Nt(s);return new vc(a,o,i.fieldTransforms)}function kc(e,t,n,r,i,s){const a=e.Qu(1,t,n),o=[Vc(t,r,n)],u=[i];if(s.length%2!=0)throw new W(H.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(Vc(t,s[e])),u.push(s[e+1]);const c=[],h=hn.empty();for(let e=o.length-1;0<=e;--e)if(!qc(c,o[e])){const t=o[e];var l=y(l=u[e]);const n=a.Nu(t);if(l instanceof Ec)c.push(t);else{const e=Oc(l,n);null!=e&&(c.push(t),h.set(t,e))}}var d=new Nt(c);return new vc(h,d,a.fieldTransforms)}function Rc(e,t,n,r=!1){return Oc(n,e.Qu(r?4:3,t))}function Oc(e,t){if(Lc(e=y(e)))return Fc("Unsupported field value:",t,e),Mc(e,t);if(e instanceof fc)return function(e,t){if(!wc(t.Cu))throw t.Bu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Bu(`${e._methodName}() is not currently supported inside arrays`);var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xu&&4!==t.Cu)throw t.Bu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Oc(i,t.Lu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=y(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return gr(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=ce.fromDate(e);return{timestampValue:fi(t.serializer,n)}}if(e instanceof ce)return n=new ce(e.seconds,1e3*Math.floor(e.nanoseconds/1e3)),{timestampValue:fi(t.serializer,n)};if(e instanceof gc)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof lc)return{bytesValue:gi(t.serializer,e._byteString)};if(e instanceof Wu){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Bu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:pi(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof mc)return r=t,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:e.toArray().map((e=>{if("number"!=typeof e)throw r.Bu("VectorValues must only contain numeric values.");return dr(r.serializer,e)}))}}}}};var r;throw t.Bu(`Unsupported field value: ${Ku(e)}`)}(e,t)}function Mc(e,t){const n={};return Tt(e)?t.path&&0<t.path.length&&t.fieldMask.push(t.path):It(e,((e,r)=>{var i=Oc(r,t.Mu(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Lc(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ce||e instanceof gc||e instanceof lc||e instanceof Wu||e instanceof fc||e instanceof mc)}function Fc(e,t,n){if(!Lc(n)||"object"!=typeof(i=n)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){var r=Ku(n);throw"an object"===r?t.Bu(e+" a custom object"):t.Bu(e+" "+r)}var i}function Vc(e,t,n){if((t=y(t))instanceof dc)return t._internalPath;if("string"==typeof t)return Uc(e,t);throw Bc("Field path arguments must be of type string or ",e,!1,void 0,n)}const Pc=new RegExp("[~\\*/\\[\\]]");function Uc(e,t,n){if(0<=t.search(Pc))throw Bc(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new dc(...t.split("."))._internalPath}catch(r){throw Bc(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Bc(e,t,n,r,i){var s=r&&!r.isEmpty(),a=void 0!==i;let o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let u="";return(s||a)&&(u+=" (found",s&&(u+=` in field ${r}`),a&&(u+=` in document ${i}`),u+=")"),new W(H.INVALID_ARGUMENT,o+e+u)}function qc(e,t){return e.some((e=>e.isEqual(t)))}class jc{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Wu(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new Kc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){var t=this._document.data.field(Gc("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Kc extends jc{data(){return super.data()}}function Gc(e,t){return"string"==typeof t?Uc(e,t):(t instanceof dc?t:t._delegate)._internalPath}function zc(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new W(H.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class $c{}class Qc extends $c{}function Hc(e,t,...n){let r=[];t instanceof $c&&r.push(t),r=r.concat(n),function(e){var t=e.filter((e=>e instanceof Jc)).length,n=e.filter((e=>e instanceof Wc)).length;if(1<t||0<t&&0<n)throw new W(H.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class Wc extends Qc{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Wc(e,t,n)}_apply(e){var t=this._parse(e);return ih(e._query,t),new Hu(e.firestore,e.converter,Hn(e._query,t))}_parse(e){var t=Ic(e.firestore);return function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new W(H.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){rh(a,s);const t=[];for(const n of a)t.push(nh(r,e,n));o={arrayValue:{values:t}}}else o=nh(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||rh(a,s),o=Rc(n,"where",a,"in"===s||"not-in"===s);return yn.create(i,s,o)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Jc extends $c{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Jc(e,t)}_parse(e){var t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>0<e.getFilters().length));return 1===t.length?t[0]:vn.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(const e of t.getFlattenedFilters())ih(n,e),n=Hn(n,e)}(e._query,t),new Hu(e.firestore,e.converter,Hn(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Yc extends Qc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Yc(e,t)}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new W(H.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new W(H.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new mn(t,n)}(e._query,this._field,this._direction);return new Hu(e.firestore,e.converter,(t=(e=e._query).explicitOrderBy.concat([t]),new qn(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class Xc extends Qc{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Xc(e,t,n)}_apply(e){return new Hu(e.firestore,e.converter,Wn(e._query,this._limit,this._limitType))}}class Zc extends Qc{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Zc(e,t,n)}_apply(e){var t,n=th(e,this.type,this._docOrFields,this._inclusive);return new Hu(e.firestore,e.converter,(t=e._query,e=n,new qn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class eh extends Qc{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new eh(e,t,n)}_apply(e){var t,n=th(e,this.type,this._docOrFields,this._inclusive);return new Hu(e.firestore,e.converter,(t=e._query,e=n,new qn(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function th(e,t,n,r){if(n[0]=y(n[0]),n[0]instanceof jc)return function(e,t,n,r,i){if(!r)throw new W(H.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of $n(e))if(n.field.isKeyField())s.push(Yt(t,r.key));else{const e=r.data.field(n.field);if(Vt(e))throw new W(H.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new W(H.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new dn(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=Ic(e.firestore);return function(e,t,n,r,i,s){const a=e.explicitOrderBy;if(i.length>a.length)throw new W(H.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const o=[];for(let s=0;s<i.length;s++){const u=i[s];if(a[s].field.isKeyField()){if("string"!=typeof u)throw new W(H.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof u}`);if(!zn(e)&&-1!==u.indexOf("/"))throw new W(H.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${u}' contains a slash.`);const n=e.path.child(de.fromString(u));if(!me.isDocumentKey(n))throw new W(H.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new me(n);o.push(Yt(t,i))}else{const e=Rc(n,r,u);o.push(e)}}return new dn(o,s)}(e._query,e.firestore._databaseId,i,t,n,r)}function nh(e,t,n){if("string"==typeof(n=y(n))){if(""===n)throw new W(H.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!zn(t)&&-1!==n.indexOf("/"))throw new W(H.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);var r=t.path.child(de.fromString(n));if(!me.isDocumentKey(r))throw new W(H.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Yt(e,new me(r))}if(n instanceof Wu)return Yt(e,n._key);throw new W(H.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ku(n)}.`)}function rh(e,t){if(!Array.isArray(e)||0===e.length)throw new W(H.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function ih(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(0<=t.indexOf(e.op))return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new W(H.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new W(H.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class sh{convertValue(e,t="none"){switch(Gt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Lt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ft(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw $()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return It(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertVectorValue(e){var t=null===(t=null===(t=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===t?void 0:t.values)||void 0===t?void 0:t.map((e=>Lt(e.doubleValue)));return new mc(t)}convertGeoPoint(e){return new gc(Lt(e.latitude),Lt(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":var n=Pt(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ut(e));default:return null}}convertTimestamp(e){var t=Mt(e);return new ce(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=de.fromString(e);Q(Fi(n));const r=new qt(n.get(1),n.get(3)),i=new me(n.popFirst(5));return r.isEqual(t)||K(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function ah(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class oh extends sh{constructor(e){super(),this.firestore=e}convertBytes(e){return new lc(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Wu(this.firestore,null,t)}}class uh{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ch extends jc{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new hh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){var n=this._document.data.field(Gc("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class hh extends ch{data(e={}){return super.data(e)}}class lh{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new uh(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new hh(this._firestore,this._userDataWriter,n.key,n,new uh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new W(H.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{var r=new hh(e._firestore,e._userDataWriter,n.doc.key,n.doc,new uh(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{var r=new hh(e._firestore,e._userDataWriter,t.doc.key,t.doc,new uh(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $()}}(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function dh(e,t){return e instanceof ch&&t instanceof ch?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof lh&&t instanceof lh&&e._firestore===t._firestore&&ec(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}class fh extends sh{constructor(e){super(),this.firestore=e}convertBytes(e){return new lc(e)}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Wu(this.firestore,null,t)}}function gh(e){e=Gu(e,Wu);const t=Gu(e.firestore,oc),n=uc(t),r=new fh(t);return function(e,t){const n=new J;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=e;return n.persistence.runTransaction("read document","readonly",(e=>n.localDocuments.getDocument(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new W(H.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){var r=Oo(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await ku(e),t,n))),n.promise}(n,e._key).then((n=>new ch(t,r,e._key,n,new uh(null!==n&&n.hasLocalMutations,!0),e.converter)))}function mh(e){e=Gu(e,Hu);const t=Gu(e.firestore,oc),n=uc(t),r=new fh(t);return function(e,t){const n=new J;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await Oa(e,t,!0),i=new Jo(t,r.Ts),s=i.ma(r.documents),a=i.applyChanges(s,!1);n.resolve(a.snapshot)}catch(e){var r=Oo(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await ku(e),t,n))),n.promise}(n,e._query).then((n=>new lh(t,r,e,n)))}function ph(e,t,n){e=Gu(e,Wu);var r=Gu(e.firestore,oc),i=ah(e.converter,t,n);return wh(r,[Tc(Ic(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Dr.none())])}function yh(e,t,n,...r){e=Gu(e,Wu);var i=Gu(e.firestore,oc),s=Ic(i);let a;return a="string"==typeof(t=y(t))||t instanceof dc?kc(s,"updateDoc",e._key,t,n,r):Nc(s,"updateDoc",e._key,t),wh(i,[a.toMutation(e._key,Dr.exists(!0))])}function vh(e,...t){var n;e=y(e);let r={includeMetadataChanges:!1,source:"default"},i=0;"object"!=typeof t[i]||nc(t[i])||(r=t[i],i++);var s={includeMetadataChanges:r.includeMetadataChanges,source:r.source};if(nc(t[i])){const e=t[i];t[i]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[i+1]=null===(n=e.error)||void 0===n?void 0:n.bind(e),t[i+2]=null===(n=e.complete)||void 0===n?void 0:n.bind(e)}let a,o,u;if(e instanceof Wu)o=Gu(e.firestore,oc),u=Kn(e._key.path),a={next:n=>{t[i]&&t[i](_h(o,e,n))},error:t[i+1],complete:t[i+2]};else{const n=Gu(e,Hu);o=Gu(n.firestore,oc),u=n._query;const r=new fh(o);a={next:e=>{t[i]&&t[i](new lh(o,r,n,e))},error:t[i+1],complete:t[i+2]},zc(e._query)}return function(e,t,n,r){const i=new bu(r),s=new Ko(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>Bo(await Mu(e),s))),()=>{i.Za(),e.asyncQueue.enqueueAndForget((async()=>qo(await Mu(e),s)))}}(uc(o),u,s,a)}function wh(e,t){return function(e,t){const n=new J;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=mu(e);try{const e=await function(e,t){const n=e,r=ce.now(),i=t.reduce(((e,t)=>e.add(t.key)),hr());let s,a;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let o=rr,u=hr();return n.cs.getEntries(e,i).next((e=>{o=e,o.forEach(((e,t)=>{t.isValidDocument()||(u=u.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,o))).next((i=>{s=i;const a=[];for(const e of t){const t=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=pr(r.transform,e||null);null!=i&&(null===n&&(n=hn.empty()),n.set(r.field,i))}return n||null}(e,s.get(e.key).overlayedDocument);null!=t&&a.push(new Lr(e.key,t,function e(t){const n=[];return It(t.fields,((t,r)=>{const i=new ge([t]);if(nn(r)){const t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(const e of t)n.push(i.child(e))}else n.push(i)})),new Nt(n)}(t.value.mapValue),Dr.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,a,t)})).next((t=>{var r=(a=t).applyToLocalDocumentSet(s,u);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:a.batchId,changes:ar(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ba[e.currentUser.toKey()];r=r||new Et(ae),r=r.insert(t,n),e.Ba[e.currentUser.toKey()]=r}(r,e.batchId,n),await lu(r,e.changes),await Eo(r.remoteStore)}catch(e){const t=Oo(e,"Failed to persist write");n.reject(t)}}(await Ou(e),t,n))),n.promise}(uc(e),t)}function _h(e,t,n){var r=n.docs.get(t._key),i=new fh(e);return new ch(e,i,t._key,r,new uh(n.hasPendingWrites,n.fromCache),t.converter)}const bh={maxAttempts:5};class Ih{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ic(e)}set(e,t,n){this._verifyNotCommitted();const r=Th(e,this._firestore),i=ah(r.converter,t,n),s=Tc(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Dr.none())),this}update(e,t,n,...r){this._verifyNotCommitted();var i=Th(e,this._firestore);let s;return s="string"==typeof(t=y(t))||t instanceof dc?kc(this._dataReader,"WriteBatch.update",i._key,t,n,r):Nc(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Dr.exists(!0))),this}delete(e){this._verifyNotCommitted();var t=Th(e,this._firestore);return this._mutations=this._mutations.concat(new Ur(t._key,Dr.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new W(H.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Th(e,t){if((e=y(e)).firestore!==t)throw new W(H.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Eh extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ic(e)}get(e){const t=Th(e,this._firestore),n=new oh(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return $();const r=e[0];if(r.isFoundDocument())return new jc(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new jc(this._firestore,n,t._key,null,t.converter);throw $()}))}set(e,t,n){var r=Th(e,this._firestore),i=ah(r.converter,t,n);return i=Tc(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n),this._transaction.set(r._key,i),this}update(e,t,n,...r){var i=Th(e,this._firestore),s="string"==typeof(t=y(t))||t instanceof dc?kc(this._dataReader,"Transaction.update",i._key,t,n,r):Nc(this._dataReader,"Transaction.update",i._key,t);return this._transaction.update(i._key,s),this}delete(e){var t=Th(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Th(e,this._firestore),n=new fh(this._firestore);return super.get(e).then((e=>new ch(this._firestore,n,t._key,e._document,new uh(!1,!1),t.converter)))}}function Sh(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new W("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function xh(){if("undefined"==typeof Uint8Array)throw new W("unimplemented","Uint8Arrays are not available in this environment.")}function Dh(){if("undefined"==typeof atob)throw new W("unimplemented","Blobs are unavailable in Firestore in this environment.")}ic=t.SDK_VERSION,U=ic,t._registerComponent(new v("firestore",((e,{instanceIdentifier:t,options:n})=>{const r=e.getProvider("app").getImmediate(),i=new oc(new ee(e.getProvider("auth-internal")),new ie(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new W(H.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new qt(e.options.projectId,t)}(r,t),r);return n=Object.assign({useFetchStreams:true},n),i._setSettings(n),i}),"PUBLIC").setMultipleInstances(!0)),t.registerVersion(V,"4.7.3",undefined),t.registerVersion(V,"4.7.3","esm2017");class Ah{constructor(e){this._delegate=e}static fromBase64String(e){return Dh(),new Ah(lc.fromBase64String(e))}static fromUint8Array(e){return xh(),new Ah(lc.fromUint8Array(e))}toBase64(){return Dh(),this._delegate.toBase64()}toUint8Array(){return xh(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Ch(e){return function(e,t){if("object"==typeof e&&null!==e){var n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return 1}}(e)}class Nh{enableIndexedDbPersistence(e,t){return function(e,t){G("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings();return hc(e,wu.provider,{build:e=>new yu(e,n.cacheSizeBytes,null==t?void 0:t.forceOwnership)}),Promise.resolve()}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return async function(e){G("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=e._freezeSettings();hc(e,wu.provider,{build:e=>new vu(e,t.cacheSizeBytes)})}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new W(H.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new J;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!Ne.D())return Promise.resolve();var t=e+"main";await Ne.delete(t)}(Ia(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}(e._delegate)}}class kh{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof qt||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||G("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(e,t,n,r={}){var i;const s=(e=Gu(e,Qu))._getSettings(),a=`${t}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&G("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=P.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e),[u(JSON.stringify({alg:"none",type:"JWT"})),u(JSON.stringify(i)),""].join(".")}(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new W(H.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new P(s)}e._authCredentials=new Z(new Y(t,n))}}(this._delegate,e,t,n)}enableNetwork(){return function(e){return(t=uc(e=Gu(e,oc))).asyncQueue.enqueue((async()=>{const e=await Nu(t),n=await Ru(t);return e.setNetworkEnabled(!0),function(e){const t=e;return t.L_.delete(0),lo(t)}(n)}));var t}(this._delegate)}disableNetwork(){return function(e){return(t=uc(e=Gu(e,oc))).asyncQueue.enqueue((async()=>{const e=await Nu(t),n=await Ru(t);return e.setNetworkEnabled(!1),async function(e){const t=e;t.L_.add(0),await fo(t),t.q_.set("Offline")}(n)}));var t}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Bu("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(e){return function(e){const t=new J;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=e;_o(n.remoteStore)||j("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=e;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.ka.get(e)||[];r.push(t),n.ka.set(e,r)}catch(e){const n=Oo(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await Ou(e),t))),t.promise}(uc(e=Gu(e,oc)))}(this._delegate)}onSnapshotsInSync(e){return function(e,t){return function(e,t){const n=new bu(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){e.Y_.add(t),t.next()}(await Mu(e),n))),()=>{n.Za(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){e.Y_.delete(t)}(await Mu(e),n)))}}(uc(e=Gu(e,oc)),nc(t)?t:{next:t})}(this._delegate,e)}get app(){if(!this._appCompat)throw new W("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new zh(this,Yu(this._delegate,e))}catch(e){throw Vh(e,"collection()","Firestore.collection()")}}doc(e){try{return new Fh(this,Xu(this._delegate,e))}catch(e){throw Vh(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new jh(this,function(e,t){if(e=Gu(e,Qu),Uu("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new W(H.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Hu(e,null,new qn(de.emptyPath(),t))}(this._delegate,e))}catch(e){throw Vh(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t,n){e=Gu(e,oc);var r=Object.assign(Object.assign({},bh),n);return function(e){if(e.maxAttempts<1)throw new W(H.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new J;return e.asyncQueue.enqueueAndForget((async()=>{var i=await Cu(e).then((e=>e.datastore));new Eu(e.asyncQueue,i,n,t,r).au()})),r.promise}(uc(e),(n=>t(new Eh(e,n))),r)}(this._delegate,(t=>e(new Oh(this,t))))}batch(){return uc(this._delegate),new Mh(new Ih(this._delegate,(e=>wh(this._delegate,e))))}loadBundle(e){return n=uc(t=Gu(t=this._delegate,oc)),r=new rc,function(e,t,n,r){const i=(t=ro(t),n=function(e,t){if(e instanceof Uint8Array)return _u(e,t);if(e instanceof ArrayBuffer)return _u(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?Qr().encode(n):n),new Iu(n,t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=e;(async function(e,t,n){try{var r=await t.getMetadata();if(await function(e,t){const n=e,r=mi(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.Gr.getBundleMetadata(e,t.id))).then((e=>!!e&&0<=e.createTime.compareTo(r)))}(e.localStore,r))return await t.close(),n._completeWith({taskState:"Success",documentsLoaded:r.totalDocuments,bytesLoaded:r.totalBytes,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}),Promise.resolve(new Set);n._updateProgress(Qo(r));const s=new $o(r,e.localStore,t.serializer);let a=await t.Ua();for(;a;){const e=await s.la(a);e&&n._updateProgress(e),a=await t.Ua()}var i=await s.complete();return await lu(e,i.Ia,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.Gr.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(i.progress),Promise.resolve(i.Pa)}catch(e){return G("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await Ou(e),i,r)}))}(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return function(e,t){return n=uc(e=Gu(e,oc)),r=t,n.asyncQueue.enqueue((async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",(e=>n.Gr.getNamedQuery(e,t)))}(await ku(n),r))).then((t=>t?new Hu(e,null,t.query):null));var n,r}(this._delegate,e).then((e=>e?new jh(this,e):null))}}class Rh extends sh{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ah(new lc(e))}convertReference(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return Fh.forKey(t,this.firestore,null)}}class Oh{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Rh(e)}get(e){const t=$h(e);return this._delegate.get(t).then((e=>new Bh(this._firestore,new ch(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,t,n){var r=$h(e);return n?(Sh("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=$h(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=$h(e);return this._delegate.delete(t),this}}class Mh{constructor(e){this._delegate=e}set(e,t,n){var r=$h(e);return n?(Sh("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){var i=$h(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){var t=$h(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Lh{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){var n=new hh(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new qh(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=Lh.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new Lh(e,new Rh(e),t),r.set(t,i)),i}}Lh.INSTANCES=new WeakMap;class Fh{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Rh(e)}static forPath(e,t,n){if(e.length%2!=0)throw new W("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Fh(t,new Wu(t._delegate,n,new me(e)))}static forKey(e,t,n){return new Fh(t,new Wu(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new zh(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new zh(this.firestore,Yu(this._delegate,e))}catch(e){throw Vh(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=y(e))instanceof Wu&&Zu(this._delegate,e)}set(e,t){t=Sh("DocumentReference.set",t);try{return t?ph(this._delegate,e,t):ph(this._delegate,e)}catch(e){throw Vh(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?yh(this._delegate,e):yh(this._delegate,e,t,...n)}catch(e){throw Vh(e,"updateDoc()","DocumentReference.update()")}}delete(){return wh(Gu((e=this._delegate).firestore,oc),[new Ur(e._key,Dr.none())]);var e}onSnapshot(...e){var t=Ph(e),n=Uh(e,(e=>new Bh(this.firestore,new ch(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return vh(this._delegate,t,n)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?gh:"server"===(null==e?void 0:e.source)?function(e){e=Gu(e,Wu);const t=Gu(e.firestore,oc);return Lu(uc(t),e._key,{source:"server"}).then((n=>_h(t,e,n)))}:function(e){e=Gu(e,Wu);const t=Gu(e.firestore,oc);return Lu(uc(t),e._key).then((n=>_h(t,e,n)))})(this._delegate),t.then((e=>new Bh(this.firestore,new ch(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new Fh(this.firestore,e?this._delegate.withConverter(Lh.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Vh(e,t,n){return e.message=e.message.replace(t,n),e}function Ph(e){for(const t of e)if("object"==typeof t&&!Ch(t))return t;return{}}function Uh(e,t){var n;let r;return r=Ch(e[0])?e[0]:Ch(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{r.next&&r.next(t(e))},error:null===(n=r.error)||void 0===n?void 0:n.bind(r),complete:null===(n=r.complete)||void 0===n?void 0:n.bind(r)}}class Bh{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Fh(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return dh(this._delegate,e._delegate)}}class qh extends Bh{data(e){var t=this._delegate.data(e);return this._delegate._converter||void 0!==t||$(),t}}class jh{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Rh(e)}where(e,t,n){try{return new jh(this.firestore,Hc(this._delegate,(r=n,i=t,s=Gc("where",e),Wc._create(s,i,r))))}catch(e){throw Vh(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,s}orderBy(e,t){try{return new jh(this.firestore,Hc(this._delegate,([n,r="asc"]=[e,t],i=r,s=Gc("orderBy",n),Yc._create(s,i))))}catch(e){throw Vh(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,i,s}limit(e){try{return new jh(this.firestore,Hc(this._delegate,(zu("limit",t=e),Xc._create("limit",t,"F"))))}catch(e){throw Vh(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new jh(this.firestore,Hc(this._delegate,(zu("limitToLast",t=e),Xc._create("limitToLast",t,"L"))))}catch(e){throw Vh(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new jh(this.firestore,Hc(this._delegate,function(...e){return Zc._create("startAt",e,!0)}(...e)))}catch(e){throw Vh(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new jh(this.firestore,Hc(this._delegate,function(...e){return Zc._create("startAfter",e,!1)}(...e)))}catch(e){throw Vh(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new jh(this.firestore,Hc(this._delegate,function(...e){return eh._create("endBefore",e,!1)}(...e)))}catch(e){throw Vh(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new jh(this.firestore,Hc(this._delegate,function(...e){return eh._create("endAt",e,!0)}(...e)))}catch(e){throw Vh(e,"endAt()","Query.endAt()")}}isEqual(e){return ec(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?mh:"server"===(null==e?void 0:e.source)?function(e){e=Gu(e,Hu);const t=Gu(e.firestore,oc),n=uc(t),r=new fh(t);return Fu(n,e._query,{source:"server"}).then((n=>new lh(t,r,e,n)))}:function(e){e=Gu(e,Hu);const t=Gu(e.firestore,oc),n=uc(t),r=new fh(t);return zc(e._query),Fu(n,e._query).then((n=>new lh(t,r,e,n)))})(this._delegate),t.then((e=>new Gh(this.firestore,new lh(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){var t=Ph(e),n=Uh(e,(e=>new Gh(this.firestore,new lh(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return vh(this._delegate,t,n)}withConverter(e){return new jh(this.firestore,e?this._delegate.withConverter(Lh.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Kh{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new qh(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Gh{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new jh(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new qh(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new Kh(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new qh(this._firestore,n))}))}isEqual(e){return dh(this._delegate,e._delegate)}}class zh extends jh{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new Fh(this.firestore,e):null}doc(e){try{return new Fh(this.firestore,void 0===e?Xu(this._delegate):Xu(this._delegate,e))}catch(e){throw Vh(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Gu(e.firestore,oc),r=Xu(e),i=ah(e.converter,t);return wh(n,[Tc(Ic(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Dr.exists(!1))]).then((()=>r))}(this._delegate,e).then((e=>new Fh(this.firestore,e)))}isEqual(e){return Zu(this._delegate,e._delegate)}withConverter(e){return new zh(this.firestore,e?this._delegate.withConverter(Lh.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function $h(e){return Gu(e,Wu)}const Qh={Firestore:kh,GeoPoint:gc,Timestamp:ce,Blob:Ah,Transaction:Oh,WriteBatch:Mh,DocumentReference:Fh,DocumentSnapshot:Bh,Query:jh,QueryDocumentSnapshot:qh,QuerySnapshot:Gh,CollectionReference:zh,FieldPath:class e{constructor(...e){this._delegate=new dc(...e)}static documentId(){return new e(ge.keyField().canonicalString())}isEqual(e){return(e=y(e))instanceof dc&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class e{constructor(e){this._delegate=e}static serverTimestamp(){const t=new xc("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)}static delete(){const t=new Ec("deleteField");return t._methodName="FieldValue.delete",new e(t)}static arrayUnion(...t){const n=function(...e){return new Dc("arrayUnion",e)}(...t);return n._methodName="FieldValue.arrayUnion",new e(n)}static arrayRemove(...t){const n=function(...e){return new Ac("arrayRemove",e)}(...t);return n._methodName="FieldValue.arrayRemove",new e(n)}static increment(t){const n=new Cc("increment",t);return n._methodName="FieldValue.increment",new e(n)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){B.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};sc=i.default,ac=(e,t)=>new kh(e,t,new Nh),sc.INTERNAL.registerComponent(new v("firestore-compat",(e=>{var t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("firestore").getImmediate();return ac(t,n)}),"PUBLIC").setServiceProps(Object.assign({},Qh))),sc.registerVersion("@firebase/firestore-compat","0.3.38")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-firestore-compat.js - be sure to load firebase-app.js first.")}}(n(1675),n(5752))}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}};return t[e].call(s.exports,s,s.exports,r),s.exports}r.m=t,e=[],r.O=(t,n,i,s)=>{if(!n){var a=1/0;for(h=0;h<e.length;h++){for(var[n,i,s]=e[h],o=!0,u=0;u<n.length;u++)(!1&s||a>=s)&&Object.keys(r.O).every((e=>r.O[e](n[u])))?n.splice(u--,1):(o=!1,s<a&&(a=s));if(o){e.splice(h--,1);var c=i();void 0!==c&&(t=c)}}return t}s=s||0;for(var h=e.length;h>0&&e[h-1][2]>s;h--)e[h]=e[h-1];e[h]=[n,i,s]},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={765:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var i,s,[a,o,u]=n,c=0;if(a.some((t=>0!==e[t]))){for(i in o)r.o(o,i)&&(r.m[i]=o[i]);if(u)var h=u(r)}for(t&&t(n);c<a.length;c++)s=a[c],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return r.O(h)},n=self.webpackChunkreactjs_chrome=self.webpackChunkreactjs_chrome||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=r.O(void 0,[675],(()=>r(3478)));i=r.O(i)})();