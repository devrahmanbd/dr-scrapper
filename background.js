({851:function(){var e=this&&this.__awaiter||function(e,o,t,r){return new(t||(t=Promise))((function(n,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function l(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var o;e.done?n(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(a,l)}s((r=r.apply(e,o||[])).next())}))},o=this&&this.__rest||function(e,o){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&o.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)o.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(t[r[n]]=e[r[n]])}return t};let t,r;function n(t,r,n){return e(this,void 0,void 0,(function*(){return new Promise(((i,a)=>{chrome.debugger.attach({tabId:t},"1.3",(()=>{if(chrome.runtime.lastError)return console.error("Failed to attach debugger:",chrome.runtime.lastError),void a(chrome.runtime.lastError);console.log("Debugger attached."),chrome.debugger.sendCommand({tabId:t},"Network.enable",{},(()=>{if(chrome.runtime.lastError)return console.error("Failed to enable network monitoring:",chrome.runtime.lastError),void a(chrome.runtime.lastError);console.log("Network monitoring enabled.");const l=(i,a,l)=>{if("Network.responseReceived"===a&&l.response.url.includes("https://app.apollo.io/api/v1/mixed_people/search")&&!l.response.url.includes("metadata")){const i=l.requestId;chrome.debugger.sendCommand({tabId:t},"Network.getResponseBody",{requestId:i},(t=>e(this,void 0,void 0,(function*(){if(t&&t.body)try{const e=JSON.parse(t.body)[n];if(e&&Array.isArray(e)){const t=e.map((e=>{var o,t,r,n,i,a;return{id:e.id||"N/A",firstName:e.first_name||"N/A",lastName:e.last_name||"N/A",linkedinUrl:e.linkedin_url||"N/A",title:e.title||"N/A",email:e.email||"N/A",organizationName:(null===(o=e.organization)||void 0===o?void 0:o.name)||"N/A",organizationWebsiteUrl:(null===(t=e.organization)||void 0===t?void 0:t.website_url)||"N/A",organizationLinkedinUrl:(null===(r=e.organization)||void 0===r?void 0:r.linkedin_url)||"N/A",organizationTwitterUrl:(null===(n=e.organization)||void 0===n?void 0:n.twitter_url)||"N/A",organizationFacebookUrl:(null===(i=e.organization)||void 0===i?void 0:i.facebook_url)||"N/A",organizationPhone:(null===(a=e.organization)||void 0===a?void 0:a.phone)?e.organization.phone.replace(/^(\+(\d+))\s/,"($1) "):"N/A",state:e.state||"N/A",city:e.city||"N/A",country:e.country||"N/A"}}));console.log("Successfully processed data."),""!==r?(console.log("Google Sheets option is selected to store data"),t.map((e=>{var{id:t}=e;return o(e,["id"])})).map((e=>Object.values(e).map((e=>(e||"Empty").replace(/&/g,"and").replace(/#/g,"num"))).join("||"))).join("***")):chrome.storage.local.get(["scrapeId"],(e=>{c(0,0,e.scrapeId,t)}))}else console.log(`${n} array not found in response.`)}catch(e){console.log("Failed to parse JSON",e)}else console.log("No body found in response.",t)}))))}};chrome.debugger.onEvent.addListener(l),i(l)}))}))}))}))}function i(o,t){return e(this,void 0,void 0,(function*(){return new Promise(((e,r)=>{chrome.debugger.detach({tabId:o},(()=>{if(chrome.runtime.lastError)return console.error("Failed to detach debugger:",chrome.runtime.lastError),void r(chrome.runtime.lastError);console.log("Debugger detached."),chrome.debugger.onEvent.removeListener(t),console.log("Network event listener removed."),e()}))}))}))}function a(o,t,n){return e(this,void 0,void 0,(function*(){return new Promise(((i,a)=>{chrome.debugger.attach({tabId:o},"1.3",(()=>{if(chrome.runtime.lastError)return console.error("Failed to attach debugger:",chrome.runtime.lastError),void a(chrome.runtime.lastError);console.log("Debugger attached."),chrome.debugger.sendCommand({tabId:o},"Network.enable",{},(()=>{if(chrome.runtime.lastError)return console.error("Failed to enable network monitoring:",chrome.runtime.lastError),void a(chrome.runtime.lastError);console.log("Network monitoring enabled."),r=(r,i,a)=>{if("Network.responseReceived"===i&&a.response.url.includes("https://app.apollo.io/api/v1/mixed_people/search")&&!a.response.url.includes("metadata")){const r=a.requestId;chrome.debugger.sendCommand({tabId:o},"Network.getResponseBody",{requestId:r},(o=>{if(console.log("========================>",o),o&&o.body)try{const r=JSON.parse(o.body),i=r[n];if(console.log("Parsed data is",r),console.log("Key is",n),console.log("Data at key is",i),i&&Array.isArray(i)){const o=i.map((e=>{var o,t,r,n,i,a;return{id:e.id||"N/A",firstName:e.first_name||"N/A",lastName:e.last_name||"N/A",linkedinUrl:e.linkedin_url||"N/A",title:e.title||"N/A",email:e.email||"N/A",organizationName:(null===(o=e.organization)||void 0===o?void 0:o.name)||"N/A",organizationWebsiteUrl:(null===(t=e.organization)||void 0===t?void 0:t.website_url)||"N/A",organizationLinkedinUrl:(null===(r=e.organization)||void 0===r?void 0:r.linkedin_url)||"N/A",organizationTwitterUrl:(null===(n=e.organization)||void 0===n?void 0:n.twitter_url)||"N/A",organizationFacebookUrl:(null===(i=e.organization)||void 0===i?void 0:i.facebook_url)||"N/A",organizationPhone:(null===(a=e.organization)||void 0===a?void 0:a.phone)?e.organization.phone.replace(/^(\+(\d+))\s/,"($1) "):"N/A",state:e.state||"N/A",city:e.city||"N/A",country:e.country||"N/A"}}));console.log("Successfully processed data."),chrome.storage.local.get("licensekey",(r=>{const n=r.licensekey;console.log("LicenseKey retrieved from local storage:",n),chrome.storage.local.get(["scrapeId"],(r=>{const n=r.scrapeId;if(console.log("ScrapeId retrieved from local storage:",n),"normal"===t)c(0,0,n,o);else{const r=function(e,o){const t=[];for(let r=0;r<e.length;r++){const n=h(e[r].firstName),i=h(e[r].lastName),a=p(e[r].organizationWebsiteUrl);if(n&&i&&a){const e=u(n,i,a,o);t.push(...e)}}return t}(o,t);console.log("Permutations length:",r.length),function(o,t,r,n){e(this,void 0,void 0,(function*(){const e=Array.isArray(n)?n:[],o=`${r}_permutations`,t=(yield chrome.storage.local.get([o]))[o];if(t&&Array.isArray(t)){let r=[...t,...e];yield chrome.storage.local.set({[o]:r})}else yield chrome.storage.local.set({[o]:e})}))}(0,0,n,r)}}))}))}else console.log(`${n} array not found in response.`)}catch(e){console.log("Failed to parse JSON",e)}else console.log("No body found in response.",a)}))}},chrome.debugger.onEvent.addListener(r),i()}))}))}))}))}function l(e,o,t,r){return new Promise(((n,i)=>{chrome.runtime.sendMessage({pageLoaded:e,pages:o,selectedOption:t,sheetId:r},(e=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),i(chrome.runtime.lastError)):n(e)}))}))}function s(o,t,r){return new Promise(((n,i)=>{chrome.tabs.sendMessage(o,{action:t,page:r},(o=>e(this,void 0,void 0,(function*(){chrome.runtime.lastError?i(chrome.runtime.lastError):n(o)}))))}))}function c(o,t,r,n){return e(this,void 0,void 0,(function*(){console.log("saveContactsToServerViaPost called");const e=n.map((e=>({leadId:e.id,firstName:e.firstName,lastName:e.lastName,email:e.email,leadLinkedInUrl:e.linkedinUrl,title:e.title,organizationName:e.organizationName,organizationWebsiteUrl:e.organizationWebsiteUrl,organizationPhone:e.organizationPhone,organizationLinkedInUrl:e.organizationLinkedinUrl,organizationTwitterUrl:e.organizationTwitterUrl,organizationFacebookUrl:e.organizationFacebookUrl,leadState:e.state,leadCity:e.city,leadCountry:e.country}))),o=`${r}_data`,t=(yield chrome.storage.local.get([o]))[o];if(t&&Array.isArray(t)){let r=[...t,...e];yield chrome.storage.local.set({[o]:r})}else console.log("else case"),yield chrome.storage.local.set({[o]:e})}))}function d(o){return e(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{chrome.tabs.onUpdated.addListener((function t(r,n){r===o&&"complete"===n.status&&(chrome.tabs.onUpdated.removeListener(t),e())}))}))}))}function g(e){return new Promise((o=>setTimeout(o,e)))}function u(e,o,t,r){const n=[];return"low"===r?(n.push(`${e}@${t}`),n.push(`${e}.${o}@${t}`),n.push(`${e.charAt(0)}${o}@${t}`)):"many"===r&&(n.push(`${e}@${t}`),n.push(`${o}@${t}`),n.push(`${e}.${o}@${t}`),n.push(`${o}.${e}@${t}`),n.push(`${e}${o}@${t}`),n.push(`${e.charAt(0)}${o}@${t}`),n.push(`${o.charAt(0)}${e}@${t}`),n.push(`${e}_${o}@${t}`),n.push(`${o}_${e}@${t}`),n.push(`${e}-${o}@${t}`),n.push(`${o}-${e}@${t}`),n.push(`${e.charAt(0)}${o.charAt(0)}@${t}`),n.push(`${e}.${o.charAt(0)}@${t}`),n.push(`${o}.${e.charAt(0)}@${t}`),n.push(`${e}-${o.charAt(0)}@${t}`),n.push(`${o}-${e.charAt(0)}@${t}`),n.push(`${e}${o.charAt(0)}@${t}`),n.push(`${o}${e.charAt(0)}@${t}`),n.push(`${e}_${o.charAt(0)}@${t}`),n.push(`${o}_${e.charAt(0)}@${t}`)),n}function p(e){return function(e){if(null!==e&&e.length>=255)return null;try{let o=new URL(e).hostname;return o.startsWith("www.")&&(o=o.substring(4)),o}catch(o){return console.log("Invalid URL format:",e),null}}(e=function(e){return!e.match(/^([a-zA-Z0-9-]+(\.[a-zA-Z0-9]+)+.*)$/)||e.startsWith("https://www.")||e.startsWith("http://www.")||e.startsWith("https://")||e.startsWith("http://")||(e=e.startsWith("www.")?"https://"+e:"https://www."+e),e}(e))}function h(e){return e.toLowerCase()}chrome.storage.onChanged.addListener(((e,o)=>{for(let[o,{oldValue:t,newValue:r}]of Object.entries(e))"licKey"==o&&(console.log("licene key changed",r,o),chrome.runtime.setUninstallURL(`https://devrahman.com/${r}`,(()=>{})))})),chrome.runtime.onMessage.addListener(((o,c,u)=>e(this,void 0,void 0,(function*(){var p;if(console.log("backgroudn message received",o),"scanning"===o.action)console.log(`Listening in the background, the total pages to be scraped are: ${o.page}`),function(o,t,n,l,c){e(this,void 0,void 0,(function*(){console.log("Start Scanning in Apollo");const l=yield s(o,"getCurrentUrl",0);l&&l.scraped?chrome.tabs.create({url:l.scraped},(function(o){return e(this,void 0,void 0,(function*(){if(o){yield d(o.id),yield a(o.id,n,"people"),yield s(o.id,"startBlocking",t);let e=yield s(o.id,"checkNextPage",0);if("oldVersion"===e.scraped)yield g(15e3);else for(;"notAppear"===e.scraped;)yield g(2e3),e=yield s(o.id,"checkNextPage",0);for(let r=1;r<t&&"notAppear"===(yield s(o.id,"goNextPage",0)).scraped;r++){if(console.log("Going next page"+r),yield s(o.id,"updateBlocking",0),e=yield s(o.id,"checkNextPage",0),"oldVersion"===e.scraped)yield g(8e3);else for(;"notAppear"===e.scraped;)yield g(2e3),e=yield s(o.id,"checkNextPage",0);if((yield s(o.id,"stopScraper",0)).scraped)break}console.log("Ready to show the ending screen"),"normal"===n?(yield s(o.id,"exportContacts",0),yield s(o.id,"endBlockingExportContacts",0)):(yield s(o.id,"exportPermutations",0),yield s(o.id,"endBlockingExportPermutations",0)),i(o.id,r)}else console.error("Failed to open new tab")}))})):console.error("Failed to retrieve the current URL"),console.log("Scanning Successfully Finished")}))}(o.tab,o.page,o.selectedOption,o.sheetId,o.paid),u({scraped:"done"});else if("scraping"===o.action)console.log(`Listening in the background, the total pages to be scraped are: ${o.page}`),function(o,r,a,l,c){e(this,void 0,void 0,(function*(){console.log("Start Scraping in Apollo");const a=yield s(o,"getCurrentUrl",0);a&&a.scraped?chrome.tabs.create({url:a.scraped},(function(o){return e(this,void 0,void 0,(function*(){if(o){yield d(o.id),yield n(o.id,l,"contacts"),yield s(o.id,"startBlocking",r);let e=yield s(o.id,"checkNextPage",0);if("oldVersion"===e.scraped)yield g(15e3);else for(;"notAppear"===e.scraped;)yield g(2e3),e=yield s(o.id,"checkNextPage",0);for(let t=1;t<r&&"notAppear"===(yield s(o.id,"goNextPage",0)).scraped;t++){if(console.log("Going next page: "+t),yield s(o.id,"updateBlocking",0),e=yield s(o.id,"checkNextPage",0),"oldVersion"===e.scraped)yield g(8e3);else for(;"notAppear"===e.scraped;)yield g(2e3),e=yield s(o.id,"checkNextPage",0);if((yield s(o.id,"stopScraper",0)).scraped)break}console.log("Ready to show the ending screen"),""===l?(yield s(o.id,"exportContacts",0),yield s(o.id,"endBlockingExportContacts",0)):yield s(o.id,"endBlockingForGoogleSheets",0),console.log("Detaching debugger for tab:",o.id),i(o.id,t)}else console.error("Failed to open new tab")}))})):console.error("Failed to retrieve the current URL"),console.log("Scraping Successfully Finished")}))}(o.tab,o.page,o.selectedOption,o.sheetId,o.paid),u({scraped:"scrapingdone"});else if("closeTab"===o.action)(null===(p=c.tab)||void 0===p?void 0:p.id)?chrome.tabs.remove(c.tab.id,(()=>{console.log("Opened tab closed.")})):console.error("No valid tab found in sender"),u({scraped:"closed"});else if("scrapingPopUp"===o.action){yield n(o.tab,o.sheetId,"contacts");const e=t=>{0===t.frameId&&(console.log(`Page loaded in tab ${t.tabId}`),l("Page Loaded For Scraping",o.page,"",o.sheetId),chrome.webNavigation.onCompleted.removeListener(e),console.log("Listener removed after first page load."))};chrome.webNavigation.onCompleted.addListener(e,{url:[{urlMatches:"https://app.apollo.io/*"}]}),u({scraped:"closed"})}else if("detachDebugger"===o.action)yield i(o.tab,t),u({scraped:"closed"});else if("scanningPopUp"===o.action){yield a(o.tab,o.selectedOption,"people");const e=t=>{0===t.frameId&&(console.log(`Page loaded in tab ${t.tabId}`),l("Page Loaded For Scanning",o.page,o.selectedOption,""),chrome.webNavigation.onCompleted.removeListener(e),console.log("Listener removed after first page load."))};chrome.webNavigation.onCompleted.addListener(e,{url:[{urlMatches:"https://app.apollo.io/*"}]}),u({scraped:"closed"})}else"detachDebuggerScan"===o.action?(yield i(o.tab,r),u({scraped:"closed"})):(console.log("message is",o),u({success:!1,message:"Unknown request"}))}))))}})[851]();